<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Icebergist</title>
  <meta name="author" content="Orange Iceberg">

  
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://icebergist.com/page/2">
  <link href="http://feeds.feedburner.com/icebergist" rel="alternate" title="Icebergist" type="application/atom+xml">

  <link rel="apple-touch-icon" sizes="57x57" href="/assets/favicons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/assets/favicons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/assets/favicons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/assets/favicons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/assets/favicons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/assets/favicons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/assets/favicons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/assets/favicons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192"  href="/assets/favicons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/assets/favicons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png">
  <link rel="manifest" href="/assets/favicons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/assets/favicons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">

  <link href="/assets/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" type="text/css">
<link href="/assets/bootstrap/dist/css/bootstrap-theme.min.css" rel="stylesheet" type="text/css">
<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">


  <script src="/javascripts/libs/jquery/jquery-2.0.3.min.js"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-4735545-2']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

  <body   >
    <div id="wrap">
      <header role="banner">
        <nav class="navbar navbar-default" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <h1>
              <a href="/">Icebergist</a>
              
                <small>Exploring hidden depths of web development</small>
              
            </h1>
        </div>

        <div class="navbar-collapse collapse">
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a class="subscribe-rss" href="http://feeds.feedburner.com/icebergist" title="subscribe via RSS">
                        <span class="visible-xs">RSS</span>
                        <img class="hidden-xs" src="/images/rss.png" alt="RSS">
                    </a>
                </li>
                
            </ul>
            
                <form class="search navbar-form navbar-right" action="http://google.com/search" method="GET">
                    <input type="hidden" name="q" value="site:icebergist.com">
                    <div class="form-group">
                        <input class="form-control" type="text" name="q" placeholder="Search">
                    </div>
                </form>
            
        </div>
    </div>
</nav>


      </header>
      <div id="main" class="container">
        <div id="content">
          <div class="row">
  <div class="page-content col-md-9">
    <div class="blog-index">
      
      
      
        <article class="post">
          
  <header class="page-header">
    
      <p class="meta text-muted">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2015-06-08T09:12:04+02:00" pubdate data-updated="true">Jun 8<span>th</span>, 2015</time>
        | 
  


  <span class="glyphicon glyphicon-user"></span>
  <span class="byline author vcard">Posted by
    <span class="fn">
      
        <a href="http://orangeiceberg.com/about/">Jovana Dačić</a>
      
    </span>
  </span>


        
           | <a href="/posts/creating-and-publishing-a-ruby-gem/#disqus_thread"
             data-disqus-identifier="http://icebergist.com/posts/creating-and-publishing-a-ruby-gem/">Comments</a>
        
      </p>
    
    
      <h1 class="entry-title"><a href="/posts/creating-and-publishing-a-ruby-gem/">Creating and Publishing a Ruby Gem</a></h1>
    
  </header>


  <div class="entry-content clearfix"><p>A gem is a simple way to distribute functionality, it can be a small plugin, a Ruby library or sometimes a whole program. Thanks to RubyGems, a gem hosting service, developers have a wide range of gems at their disposal allowing them to easily add functionality to their applications.</p>

<p>But what if there is no gem available that will suit the functionality you need, and you find yourself writing the same code over and over again for different projects? Well, in that case you should consider making your own gem.</p>

<p>It&rsquo;s considered a good practice to extract a gem out of an existing application, since that way you will have a better understanding of all the requirements as well as how the gem will be used. This blog post will illustrate just that on a real life example, and will take you through the process of creating a slug_converter gem.</p>

</div>
  
  
    <footer>
      <a class="btn btn-default" rel="full-article" href="/posts/creating-and-publishing-a-ruby-gem/">Read on &rarr;</a>
    </footer>
  


        </article>
      
      
        <article class="post">
          
  <header class="page-header">
    
      <p class="meta text-muted">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2015-06-01T11:03:47+02:00" pubdate data-updated="true">Jun 1<span>st</span>, 2015</time>
        | 
  


  <span class="glyphicon glyphicon-user"></span>
  <span class="byline author vcard">Posted by
    <span class="fn">
      
        <a href="http://orangeiceberg.com/about/">Jovica Šuša</a>
      
    </span>
  </span>


        
           | <a href="/posts/changing-database-starting-id/#disqus_thread"
             data-disqus-identifier="http://icebergist.com/posts/changing-database-starting-id/">Comments</a>
        
      </p>
    
    
      <h1 class="entry-title"><a href="/posts/changing-database-starting-id/">Changing Database Starting Id</a></h1>
    
  </header>


  <div class="entry-content clearfix"><p>For our new project it was necessary to modify the starting id of our database. This can be handled through migration for creating table but we decided to create a rake task that handled this for us.</p>

<p>The rake task that we created detects what database is being used and executes appropriate changes according to that.</p>

</div>
  
  
    <footer>
      <a class="btn btn-default" rel="full-article" href="/posts/changing-database-starting-id/">Read on &rarr;</a>
    </footer>
  


        </article>
      
      
        <article class="post">
          
  <header class="page-header">
    
      <p class="meta text-muted">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2015-05-04T16:07:22+02:00" pubdate data-updated="true">May 4<span>th</span>, 2015</time>
        | 
  


  <span class="glyphicon glyphicon-user"></span>
  <span class="byline author vcard">Posted by
    <span class="fn">
      
        <a href="http://orangeiceberg.com/about/">Jovica Šuša</a>
      
    </span>
  </span>


        
           | <a href="/posts/customize-devise-permitted-parameters/#disqus_thread"
             data-disqus-identifier="http://icebergist.com/posts/customize-devise-permitted-parameters/">Comments</a>
        
      </p>
    
    
      <h1 class="entry-title"><a href="/posts/customize-devise-permitted-parameters/">Customize Devise Permitted Parameters</a></h1>
    
  </header>


  <div class="entry-content clearfix"><p>If you are using Devise gem for authentication and you have been adding custom fields to your model you’ll get in trouble when you try to create a new instance or update an existing one. All your added fields will be treated as unpermitted. The solution for this problem is to customise Devise’s configure_permited_parameters action. All you need to do is to add this action to your Application controller and push parameters that need to be permitted to devise_paremeter_sanitizer array. So let’s say you have a User Model and you have added company_name and website fields to your user’s table, to permit this parameters on sign_up you need to add this to your Application controller:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>def configure_permitted_parameters
</span><span class='line'>  devise_parameter_sanitizer.for(:sign_up).push(:company_name, :website)
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<p>It is the same principle for the :sign_in and :edit_account. You can see what are <a href="https://github.com/plataformatec/devise/blob/master/lib/devise/parameter_sanitizer.rb#L83">default permitted parameters here</a>.</p>
</div>
  
  


        </article>
      
      
        <article class="post">
          
  <header class="page-header">
    
      <p class="meta text-muted">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2014-05-12T19:10:06+02:00" pubdate data-updated="true">May 12<span>th</span>, 2014</time>
        | 
  


  <span class="glyphicon glyphicon-user"></span>
  <span class="byline author vcard">Posted by
    <span class="fn">
      
        <a href="https://plus.google.com/113548610124685160907?rel=author">Slobodan Kovačević</a>
      
    </span>
  </span>


        
           | <a href="/posts/how-to-skip-devise-trackable-updates/#disqus_thread"
             data-disqus-identifier="http://icebergist.com/posts/how-to-skip-devise-trackable-updates/">Comments</a>
        
      </p>
    
    
      <h1 class="entry-title"><a href="/posts/how-to-skip-devise-trackable-updates/">How to Skip Devise Trackable Updates</a></h1>
    
  </header>


  <div class="entry-content clearfix"><p>Devise has a very useful Trackable module used to track user&rsquo;s sign in count, timestamps and IP address. There are some occasions when you need to disable tracking. For example for API requests where user signs in on every request; for instances where admin might sign in as an user; and similar.</p>

<p>To disable Devise Trackable module you need to set <code>request.env["devise.skip_trackable"] = true</code>. You have to do that before trying to authenticate user, so you&rsquo;ll want to put it in a before_filter, or even better prepend_before_filter to make sure it&rsquo;s before authentication.</p>

<p>Add this to your controller in which you want to disable tracking:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>prepend_before_filter :disable_devise_trackable
</span><span class='line'>
</span><span class='line'>protected
</span><span class='line'>  def disable_devise_trackable
</span><span class='line'>    request.env["devise.skip_trackable"] = true
</span><span class='line'>  end</span></code></pre></td></tr></table></div></figure>

</div>
  
  


        </article>
      
      
        <article class="post">
          
  <header class="page-header">
    
      <p class="meta text-muted">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2014-01-06T11:36:43+01:00" pubdate data-updated="true">Jan 6<span>th</span>, 2014</time>
        | 
  


  <span class="glyphicon glyphicon-user"></span>
  <span class="byline author vcard">Posted by
    <span class="fn">
      
        <a href="https://plus.google.com/113548610124685160907?rel=author">Slobodan Kovačević</a>
      
    </span>
  </span>


        
           | <a href="/posts/upgrade-ubuntu-8-dot-04-lts-server/#disqus_thread"
             data-disqus-identifier="http://icebergist.com/posts/upgrade-ubuntu-8-dot-04-lts-server/">Comments</a>
        
      </p>
    
    
      <h1 class="entry-title"><a href="/posts/upgrade-ubuntu-8-dot-04-lts-server/">Upgrade Ubuntu 8.04 LTS Server</a></h1>
    
  </header>


  <div class="entry-content clearfix"><p>Note to self: here is how to upgrade Ubuntu 8.04 LTS (or any other release that is no longer supported) to newer Ubuntu release.</p>

<p>When you are upgrading unsupported release of Ubuntu if you try to do the usual <code>sudo apt-get update</code> it will most likely fail because&hellip; well, it&rsquo;s unsupported. The simple fix for this is to change your <code>/etc/apt/sources.list</code> and replace repository URLs from something like <code>us.archive.ubuntu.com</code> to <code>old-releases.ubuntu.com</code>.</p>

<p>After that you should be able follow normal upgrade procedure (use sudo if you are not root):</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>apt-get update
</span><span class='line'>apt-get install update-manager-core
</span><span class='line'><span class="k">do</span>-release-upgrade
</span></code></pre></td></tr></table></div></figure>


<p>References:</p>

<ul>
<li><a href="http://rimuhosting.com/knowledgebase/linux/distros/ubuntu" title="Rimuhosting's page on upgrading Ubuntu">Rimuhosting&rsquo;s page on upgrading Ubuntu</a></li>
<li><a href="http://askubuntu.com/questions/91815/how-to-install-software-or-upgrade-from-old-unsupported-release" title="Discussion on upgrading unsupported Ubuntu release">Discussion on upgrading unsupported Ubuntu release</a></li>
</ul>

</div>
  
  


        </article>
      
      
        <article class="post">
          
  <header class="page-header">
    
      <p class="meta text-muted">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2013-09-16T10:00:00+02:00" pubdate data-updated="true">Sep 16<span>th</span>, 2013</time>
        | 
  


  <span class="glyphicon glyphicon-user"></span>
  <span class="byline author vcard">Posted by
    <span class="fn">
      
        <a href="https://plus.google.com/113548610124685160907?rel=author">Slobodan Kovačević</a>
      
    </span>
  </span>


        
           | <a href="/posts/quick-virtualboxvagrant-setup-with-heroku-like-box#disqus_thread"
             data-disqus-identifier="http://icebergist.com/posts/quick-virtualboxvagrant-setup-with-heroku-like-box">Comments</a>
        
      </p>
    
    
      <h1 class="entry-title"><a href="/posts/quick-virtualboxvagrant-setup-with-heroku-like-box">Quick VirtualBox/Vagrant Setup With Heroku-like Box</a></h1>
    
  </header>


  <div class="entry-content clearfix"><p>Here is a quick way to setup VirtualBox using Vagrant with Heroku-like box on Mac.</p>

<ol>
<li><p>Install VirtualBox from <a href="https://www.virtualbox.org/wiki/Downloads" target="_blank"><a href="https://www.virtualbox.org/wiki/Downloads">https://www.virtualbox.org/wiki/Downloads</a></a></p></li>
<li><p>Install Vagrant from <a href="http://downloads.vagrantup.com/" target="_blank"><a href="http://downloads.vagrantup.com/">http://downloads.vagrantup.com/</a></a></p></li>
<li><p>Create Vagrantfile for Heroku-like box (based on <a href="https://github.com/ejholmes/vagrant-heroku" target="_blank"><a href="https://github.com/ejholmes/vagrant-heroku">https://github.com/ejholmes/vagrant-heroku</a></a>) that looks something like:</p></li>
</ol>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>    <span class="no">Vagrant</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="s2">&quot;2&quot;</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
</span><span class='line'>        <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">box</span> <span class="o">=</span> <span class="s2">&quot;heroku&quot;</span>
</span><span class='line'>        <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">box_url</span> <span class="o">=</span> <span class="s2">&quot;https://dl.dropboxusercontent.com/s/rnc0p8zl91borei/heroku.box&quot;</span>
</span><span class='line'>      <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">synced_folder</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;/vagrant&quot;</span><span class="p">,</span> <span class="ss">:nfs</span> <span class="o">=&gt;</span> <span class="kp">true</span>
</span><span class='line'>        <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">network</span> <span class="ss">:private_network</span><span class="p">,</span> <span class="ss">ip</span><span class="p">:</span> <span class="s2">&quot;192.168.1.42&quot;</span>  <span class="c1"># required for NFS</span>
</span><span class='line'>    <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Beside telling Vagrant to use Heroku-like box from <a href="https://github.com/ejholmes/vagrant-heroku" target="_blank"><a href="https://github.com/ejholmes/vagrant-heroku">https://github.com/ejholmes/vagrant-heroku</a></a> it also sets up shared dir between host and VM machine. It will mount Vagrantfile dir (.) to /vagrant in VM.</p>

<p><code>vagrant up</code> will setup the VM and start it up.</p>

<p>Now you can use <code>vagrant ssh</code> to login to VM.</p>

<p>Vagrant Heroku-like box comes with Postgresql, but if you want you can easily setup sqlite:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>sudo apt-get install libsqlite3-dev
</span></code></pre></td></tr></table></div></figure>


<p><strong>Bonus tip</strong>: when you are working on multiple projects sometimes you can forget which VMs are running. You can list all running VMs using:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>VBoxManage list runningvms
</span></code></pre></td></tr></table></div></figure>


<p>Further reading:</p>

<ul>
<li><a href="http://docs.vagrantup.com/v2/" target="_blank">Vagrant docs</a></li>
<li><a href="https://github.com/ejholmes/vagrant-heroku" target="_blank">Vagrant Heroku-like box</a> which can be easily customized.</li>
<li><a href="http://loudcoding.com/posts/how-to-use-vagrant-to-run-celadon-cedar-stack-on-heroku/" target="_blank">Another Vagrant setup tutorial</a></li>
<li><a href="https://www.stackmachine.com/blog/web-development-on-a-vm-is-it-slower" target="_blank">VM speed benchmarks</a> in case you doubt in VM speed.</li>
</ul>

</div>
  
  


        </article>
      
      
        <article class="post">
          
  <header class="page-header">
    
      <p class="meta text-muted">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2013-09-10T10:00:00+02:00" pubdate data-updated="true">Sep 10<span>th</span>, 2013</time>
        | 
  


  <span class="glyphicon glyphicon-user"></span>
  <span class="byline author vcard">Posted by
    <span class="fn">
      
        <a href="https://plus.google.com/113548610124685160907?rel=author">Slobodan Kovačević</a>
      
    </span>
  </span>


        
           | <a href="/posts/railsdiff#disqus_thread"
             data-disqus-identifier="http://icebergist.com/posts/railsdiff">Comments</a>
        
      </p>
    
    
      <h1 class="entry-title"><a href="/posts/railsdiff">RailsDiff</a></h1>
    
  </header>


  <div class="entry-content clearfix"><p><a title="RailsDiff - compare Rails default app" href="http://railsdiff.org/" target="_blank">RailsDiff</a>
is a very useful site when upgrading Rails versions (for example, from Rails 3.2 to Rails 4). It will generate default Rails app using two different Rails versions and it will compare them. The result is that you can see all the configuration changes (like in application.rb) and all other changes &#8211; which is really useful when upgrading to new Rails version.</p>
</div>
  
  


        </article>
      
      
        <article class="post">
          
  <header class="page-header">
    
      <p class="meta text-muted">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2013-09-07T10:00:00+02:00" pubdate data-updated="true">Sep 7<span>th</span>, 2013</time>
        | 
  


  <span class="glyphicon glyphicon-user"></span>
  <span class="byline author vcard">Posted by
    <span class="fn">
      
        <a href="https://plus.google.com/113548610124685160907?rel=author">Slobodan Kovačević</a>
      
    </span>
  </span>


        
           | <a href="/posts/rspec-and-factorygirl-setup-for-testing-carrierwave-uploaders#disqus_thread"
             data-disqus-identifier="http://icebergist.com/posts/rspec-and-factorygirl-setup-for-testing-carrierwave-uploaders">Comments</a>
        
      </p>
    
    
      <h1 class="entry-title"><a href="/posts/rspec-and-factorygirl-setup-for-testing-carrierwave-uploaders">RSpec and FactoryGirl Setup for Testing Carrierwave Uploaders</a></h1>
    
  </header>


  <div class="entry-content clearfix"><p>Assume that you have the usual setup with model (MyFile) using simple Carrierwave uploader (MyFileUploader):</p>

<pre># app/models/my_file.rb
class MyFile &lt; ActiveRecord::Base
  mount_uploader :file, MyFileUploader
end</pre>


<p>To be able to test Carrierwave uploaders with RSpec using FactoryGirl factories you need:</p>

<ul>
<li><span style="line-height: 13px;">define factory with uploaded file</span></li>
<li>modify test environment storage so test file uploads are separated from other uploads</li>
<li>turn off image processing to speed up tests</li>
<li>perform cleanup after each test</li>
</ul>


<h2>Define factory</h2>

<pre># spec/factories/my_files.rb
FactoryGirl.define do
 factory :my_file do
   photo Rack::Test::UploadedFile.new(File.open(File.join(Rails.root, '/spec/fixtures/myfiles/myfile.jpg')))
 end
end</pre>


<h2>Setup Carrierwave</h2>

<p>First we need to make sure Carrierwave is using local file system for storage and to disable file processing for testing environments. Disabling file processing will speed up tests considerably. We can do that by adding following to Carrierwave initializer:</p>

<pre>if Rails.env.test? || Rails.env.cucumber?
  CarrierWave.configure do |config|
    config.storage = :file
    config.enable_processing = false
  end
end</pre>


<p>Next we should separate test uploads from any other uploads. We can do that by modifying cache_dir and store_dir methods for all Carrierwave models (i.e. all models that are descendants of CarrierWave::Uploader::Base). So the whole Carrierwave initializer looks something like:</p>

<pre># config/initializers/carrierwave.rb
if Rails.env.test? || Rails.env.cucumber?
  CarrierWave.configure do |config|
    config.storage = :file
    config.enable_processing = false
  end

  # make sure our uploader is auto-loaded
  MyFileUploader

  # use different dirs when testing
  CarrierWave::Uploader::Base.descendants.each do |klass|
    next if klass.anonymous?
    klass.class_eval do
      def cache_dir
        "#{Rails.root}/spec/support/uploads/tmp"
      end

      def store_dir
        "#{Rails.root}/spec/support/uploads/#{model.class.to_s.underscore}/#{mounted_as}/#{model.id}"
      end
    end
  end
end</pre>


<h2>Clean up uploaded files</h2>

<p>Using factory defined above will create uploaded files in cache_dir and store_dir. These are just temporary files and should be removed after each test, so each of them has a clean slate. By adding after :each hook in RSpec configuration block we can remove these files simply by deleting spec/support/uploads dir.</p>

<pre># spec_helper.rb
RSpec.configure do |config|
  config.after(:each) do
    if Rails.env.test? || Rails.env.cucumber?
      FileUtils.rm_rf(Dir["#{Rails.root}/spec/support/uploads"])
    end 
  end
end</pre>

</div>
  
  


        </article>
      
      
        <article class="post">
          
  <header class="page-header">
    
      <p class="meta text-muted">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2013-03-09T09:00:00+01:00" pubdate data-updated="true">Mar 9<span>th</span>, 2013</time>
        | 
  


  <span class="glyphicon glyphicon-user"></span>
  <span class="byline author vcard">Posted by
    <span class="fn">
      
        <a href="https://plus.google.com/113548610124685160907?rel=author">Slobodan Kovačević</a>
      
    </span>
  </span>


        
           | <a href="/posts/random-rails-tips#disqus_thread"
             data-disqus-identifier="http://icebergist.com/posts/random-rails-tips">Comments</a>
        
      </p>
    
    
      <h1 class="entry-title"><a href="/posts/random-rails-tips">Random Rails Tips</a></h1>
    
  </header>


  <div class="entry-content clearfix"><p>Here are some random Rails tips I&#8217;ve found useful:</p>

<ul>
<li><strong>rails console sandbox</strong> &#8211; if you open console like this it will rollback all database changes once you exit. Pretty useful for playing around without making any changes to database.</li>
<li><strong>rake db:migrate:status</strong> &#8211; useful when you want to see the status of current database. It will show the status of all migrations.</li>
<li><strong>User.pluck(:email)</strong> &#8211; since Rails 3.2.1 you can use <a href="http://apidock.com/rails/ActiveRecord/Calculations/pluck">pluck</a> method to get an array of values in one particular column. It&#8217;s the equvivalent of doing User.select(:email).map(&amp;:email)</li>
</ul>

</div>
  
  


        </article>
      
      
        <article class="post">
          
  <header class="page-header">
    
      <p class="meta text-muted">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2011-01-24T09:00:00+01:00" pubdate data-updated="true">Jan 24<span>th</span>, 2011</time>
        | 
  


  <span class="glyphicon glyphicon-user"></span>
  <span class="byline author vcard">Posted by
    <span class="fn">
      
        <a href="https://plus.google.com/113548610124685160907?rel=author">Slobodan Kovačević</a>
      
    </span>
  </span>


        
           | <a href="/posts/paperclip-heroku-and-amazon-s3-credentials#disqus_thread"
             data-disqus-identifier="http://icebergist.com/posts/paperclip-heroku-and-amazon-s3-credentials">Comments</a>
        
      </p>
    
    
      <h1 class="entry-title"><a href="/posts/paperclip-heroku-and-amazon-s3-credentials">Paperclip, Heroku and Amazon S3 Credentials</a></h1>
    
  </header>


  <div class="entry-content clearfix"><p>Setting up Paperclip to use Amazon&#8217;s S3 is as simple as setting :storage => :s3 and providing right credentials to Paperclip by setting :s3_credentials option. Best way to provide S3 credentials is to use an YML file (usually config/s3.yml) which allows you to set different credentials for each environment. For example:</p>

<pre># config/s3.yml
development:
  access_key_id: XYZXYZXYZ
  secret_access_key: XYZXYZXYZ
  bucket: mygreatapp-development
production:
  access_key_id: XYZXYZXYZ
  secret_access_key: XYZXYZXYZ
  bucket: mygreatapp-production
</pre>


<p>Of course you want to treat s3.yml same as database.yml &#8211; i.e. you don&#8217;t want to track it with git and you want for each person/server to have it&#8217;s own.</p>

<p>However, consider this: you are working on Open Source app in a public git repository and you are deploying it on Heroku. Heroku doesn&#8217;t allow you to create files (unless they are in git repository) and you can&#8217;t commit s3.yml with your credentials to public repository.</p>

<p>One solution is to define different :s3_credentials hash in one of the environment files or to load different YML file for each environment and generate hash from it. Downside is that you need to have a separate YML file for each environment and/or you need to convert YML to hash. Other solution could be to have separate local branch from which you will push to Heroku. Problem with this is that you have to have a local branch for deploying. This means if there are multiple developers who deploy to production each should have separate local branch.</p>

<p>Much simpler way to deploy Paperclip with different S3 credentials for each environment (with one of the environment being deployed on Heroku; and repository being public) is to create s3.yml file as usual (and don&#8217;t commit it to git), but define values only for local environment.</p>

<p>For production deployment on Heroku you can write initializer which will set :s3_credentials from ENV variables.</p>

<pre># initializers/s3.rb
if Rails.env == "production"
  # set credentials from ENV hash
  S3_CREDENTIALS = { :access_key_id => ENV['S3_KEY'], :secret_access_key => ENV['S3_SECRET'], :bucket => "sharedearth-production"}
else
  # get credentials from YML file
  S3_CREDENTIALS = Rails.root.join("config/s3.yml")
end

# in your model
has_attached_file :photo, :storage => :s3, :s3_credentials => S3_CREDENTIALS
</pre>


<p>and you can easily set persistant ENV vars on Heroku with:</p>

<pre>$ heroku config:add S3_KEY=XYZXYZ S3_SECRET=XYZXYZ
</pre>


<p>(<a href="http://docs.heroku.com/config-vars#quick-example">according to Heroku docs</a>)</p>
</div>
  
  


        </article>
      
    </div>

    <ul class="pager">
      
        <li class="previous"><a href="/page/3/">&larr;&nbsp;Older</a></li>
      
      <li><a href="/blog/archives">Blog Archives</a></li>
      
        <li class="next"><a href="/">Newer&nbsp;&rarr;</a></li>
      
    </ul>
  </div>

  
    <aside class="sidebar col-md-3">
      
        <section>
  <h2>About us</h2>
  <div>
    <a href="http://orangeiceberg.com">
      <img src="http://orangeiceberg.com/images/oi-logo-footer.png" class="sidebar_avatar" alt="Orange Iceberg web development consultancy" />
    </a>
  </div>
  <div id="sidebar-about">
    <p>
      Hello!
      We are <a href="http://orangeiceberg.com">Orange Iceberg</a> a team of Ruby developers.
    </p>
    <p>
      <strong>Icebergist</strong> is a place where we write about technical challenges we face.
      We build Ruby on Rails web applications, so it&#8217;s mainly about Ruby and Ruby on Rails.
    </p>
    <p class="hire-us-box">
      <strong>We are available for hire.</strong>
      <br />
      <a href="http://orangeiceberg.com/contact">Find out how we can help you.</a>
    </p>
  </div>
</section>
<section class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">Recent Posts</h3>
  </div>
  
  <div id="recent_posts" class="list-group">
    
    <a class="list-group-item " href="/posts/introduction-to-ember-closure-actions/">Introduction to Ember Closure Actions</a>
    
    <a class="list-group-item " href="/posts/copy-sync-files-from-to-remote-server/">Copy and Sync Files From/to Remote Server</a>
    
    <a class="list-group-item " href="/posts/backup-and-restore-a-postresql-database/">Backup and Restore a PostgreSQL Database</a>
    
    <a class="list-group-item " href="/posts/using-ransackers-to-search-for-a-key-in-postgresql-json-column/">Using Ransackers to Search for a Key in PostgreSQL JSON Column</a>
    
    <a class="list-group-item " href="/posts/display-part-of-rails-template-with-different-locale/">Show Part of a Rails Template in Other Locale</a>
    
  </div>
  <div class="panel-heading">
    <a href="/blog/archives/">See more posts</a>
  </div>
</section>
<section class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">Categories</h3>
  </div>
  <div class="list-group">
    
    
    <a class="list-group-item " href="/category/misc/index.html">
        <span class="badge">13</span>
        Misc
      </a>
    
    
    <a class="list-group-item " href="/category/javascript/index.html">
        <span class="badge">1</span>
        Javascript
      </a>
    
    
    <a class="list-group-item " href="/category/ruby-and-rails/index.html">
        <span class="badge">20</span>
        Ruby and Rails
      </a>
    
    
    <a class="list-group-item " href="/category/this-should-be-interesting---weekly/index.html">
        <span class="badge">2</span>
        This should be interesting - weekly
      </a>
    
    
    <a class="list-group-item " href="/category/php/index.html">
        <span class="badge">1</span>
        PHP
      </a>
    
    
    <a class="list-group-item " href="/category/testing/index.html">
        <span class="badge">2</span>
        Testing
      </a>
    
    
    <a class="list-group-item " href="/category/ember/index.html">
        <span class="badge">1</span>
        Ember
      </a>
    
  </div>
</section>
<section class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">Tags</h3>
  </div>
  <div class="tag-cloud">
    <span class='rank-5'><a href='/tag/I18n-locale'>I18n.locale</a></span> <span class='rank-5'><a href='/tag/edge'>edge</a></span> <span class='rank-4'><a href='/tag/linux'>linux</a></span> <span class='rank-5'><a href='/tag/amazon-s3'>amazon s3</a></span> <span class='rank-5'><a href='/tag/devise'>devise</a></span> <span class='rank-5'><a href='/tag/selenium-webdriver'>selenium-webdriver</a></span> <span class='rank-5'><a href='/tag/rest'>rest</a></span> <span class='rank-5'><a href='/tag/factory-girl'>factory_girl</a></span> <span class='rank-4'><a href='/tag/ubuntu'>ubuntu</a></span> <span class='rank-5'><a href='/tag/erkanaauth'>erkanaauth</a></span> <span class='rank-5'><a href='/tag/postgres'>postgres</a></span> <span class='rank-5'><a href='/tag/hosting'>hosting</a></span> <span class='rank-5'><a href='/tag/rspec'>rspec</a></span> <span class='rank-5'><a href='/tag/codeigniter'>codeigniter</a></span> <span class='rank-5'><a href='/tag/weekly'>weekly</a></span> <span class='rank-5'><a href='/tag/rails3'>rails3</a></span> <span class='rank-5'><a href='/tag/ransack'>ransack</a></span> <span class='rank-5'><a href='/tag/virtualbox'>virtualbox</a></span> <span class='rank-5'><a href='/tag/restful'>restful</a></span> <span class='rank-5'><a href='/tag/rake-task'>rake task</a></span> <span class='rank-5'><a href='/tag/heroku'>heroku</a></span> <span class='rank-5'><a href='/tag/sqlite'>sqlite</a></span> <span class='rank-5'><a href='/tag/javascript'>javascript</a></span> <span class='rank-5'><a href='/tag/cloud-computing'>cloud computing</a></span> <span class='rank-5'><a href='/tag/carrierwave'>carrierwave</a></span> <span class='rank-5'><a href='/tag/mac'>mac</a></span> <span class='rank-5'><a href='/tag/deployment'>deployment</a></span> <span class='rank-5'><a href='/tag/tdd'>tdd</a></span> <span class='rank-5'><a href='/tag/ember'>ember</a></span> <span class='rank-5'><a href='/tag/factorygirl'>factorygirl</a></span> <span class='rank-5'><a href='/tag/admin'>admin</a></span> <span class='rank-4'><a href='/tag/links'>links</a></span> <span class='rank-5'><a href='/tag/tutorial'>tutorial</a></span> <span class='rank-5'><a href='/tag/rails4'>rails4</a></span> <span class='rank-5'><a href='/tag/Javascript'>Javascript</a></span> <span class='rank-5'><a href='/tag/vagrant'>vagrant</a></span> <span class='rank-5'><a href='/tag/postgreSQL'>postgreSQL</a></span> <span class='rank-5'><a href='/tag/capistrano-rails'>capistrano-rails</a></span> <span class='rank-5'><a href='/tag/globalize'>globalize</a></span> <span class='rank-5'><a href='/tag/PHP'>PHP</a></span> <span class='rank-5'><a href='/tag/css'>css</a></span> <span class='rank-2'><a href='/tag/ruby'>ruby</a></span> <span class='rank-5'><a href='/tag/capistrano-3'>capistrano 3</a></span> <span class='rank-1'><a href='/tag/rails'>rails</a></span> <span class='rank-5'><a href='/tag/scaffold'>scaffold</a></span> <span class='rank-3'><a href='/tag/howto'>howto</a></span> <span class='rank-5'><a href='/tag/cucumber'>cucumber</a></span> <span class='rank-5'><a href='/tag/capistrano-rbenv'>capistrano-rbenv</a></span> <span class='rank-5'><a href='/tag/password-protected'>password protected</a></span> <span class='rank-3'><a href='/tag/tips'>tips</a></span> <span class='rank-5'><a href='/tag/resources'>resources</a></span> <span class='rank-5'><a href='/tag/apprenticeship'>apprenticeship</a></span> <span class='rank-5'><a href='/tag/paperclip'>paperclip</a></span> <span class='rank-5'><a href='/tag/mysql'>mysql</a></span> 
  </div>
</section>


      
    </aside>
  
</div>

        </div>
      </div>
    </div>
    <footer role="contentinfo"><div class="container">
    <p class="text-muted credits">
  <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/">
    <img alt="Creative Commons License" style="border-width:0;float:left;padding-right:5px;" src="http://i.creativecommons.org/l/by-sa/3.0/88x31.png" />
  </a>
  <span xmlns:dc="http://purl.org/dc/elements/1.1/">icebergist.com</span> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons Attribution-Share Alike 3.0 Unported License</a>.

  <!-- Copyright &copy; 2017 - Orange Iceberg<br> -->
  <br />
  <small>
      <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>,
      <span class="credit">customized with <a href="https://github.com/kAworu/octostrap3">octostrap3</a></span>.
  </small>
</p>

</div>
</footer>
    <script src="/assets/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="/javascripts/modernizr-2.0.js"></script>


<script type="text/javascript">
      var disqus_shortname = 'icebergist';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





  </body>
</html>
