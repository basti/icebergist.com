<!DOCTYPE html>


<html class="no-js" lang="en">
<head>
  <meta charset="utf-8">
  <title>
    
    Icebergist
  </title>
  <meta name="author" content="Orange Iceberg">

  <meta name="description" content="Icebergist is a place where Orange Iceberg team writes about Ruby and Ruby on Rails.">
  

  
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="canonical" href="http://blog.orangeiceberg.com/">
  <link href="http://blog.orangeiceberg.com//favicon.ico" rel="icon">

  
  <link href="http://blog.orangeiceberg.com/index.xml" rel="alternate" title="Icebergist" type="application/atom+xml">
  
  <link rel="apple-touch-icon" sizes="57x57" href="http://blog.orangeiceberg.com//assets/favicons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="http://blog.orangeiceberg.com//assets/favicons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="http://blog.orangeiceberg.com//assets/favicons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="http://blog.orangeiceberg.com//assets/favicons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="http://blog.orangeiceberg.com//assets/favicons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="http://blog.orangeiceberg.com//assets/favicons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="http://blog.orangeiceberg.com//assets/favicons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="http://blog.orangeiceberg.com//assets/favicons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="http://blog.orangeiceberg.com//assets/favicons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192"  href="http://blog.orangeiceberg.com//assets/favicons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="http://blog.orangeiceberg.com//assets/favicons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="http://blog.orangeiceberg.com//assets/favicons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="http://blog.orangeiceberg.com//assets/favicons/favicon-16x16.png">
  <link rel="manifest" href="http://blog.orangeiceberg.com//assets/favicons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="http://blog.orangeiceberg.com//assets/favicons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <script src="http://blog.orangeiceberg.com//js/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="http://blog.orangeiceberg.com//js/octopress.js" type="text/javascript"></script>

  <script src="http://blog.orangeiceberg.com//js/libs/jquery/jquery-2.0.3.min.js"></script>

  <link href="http://blog.orangeiceberg.com//assets/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" type="text/css">
<link href="http://blog.orangeiceberg.com//assets/bootstrap/dist/css/bootstrap-theme.min.css" rel="stylesheet" type="text/css">
<link href="http://blog.orangeiceberg.com//css/screen.css" media="screen, projection" rel="stylesheet" type="text/css">


  

</head>






<body>
  <div id="wrap">
    <header role="banner">
      <nav class="navbar navbar-default" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <h1>
              <a href="http://blog.orangeiceberg.com//">Icebergist</a>
              
                <small>Exploring hidden depths of web development</small>
              
            </h1>
        </div>

        <div class="navbar-collapse collapse">
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a class="subscribe-rss" href="http://feeds.feedburner.com/icebergist" title="subscribe via RSS">
                        <span class="visible-xs">RSS</span>
                        <img class="hidden-xs" src="http://blog.orangeiceberg.com//images/rss.png" alt="RSS">
                    </a>
                </li>
                
            </ul>
            
                <form class="search navbar-form navbar-right" action="http://google.com/search" method="GET">
                    <input type="hidden" name="q" value="site:http://blog.orangeiceberg.com/">
                    <div class="form-group">
                        <input class="form-control" type="text" name="q" placeholder="Search">
                    </div>
                </form>
            
        </div>
    </div>
</nav>

    </header>
    <div id="main" class="container">
      <div id="content">
        
          <h1><a href="http://blog.orangeiceberg.com/posts/rake-dbschemaload-vs-rake-dbmigrate">rake db:schema:load vs rake db:migrate</a></h1>
          <h2>Thu, Mar 24, 2016</h2>
          

<p>Sooner or later every new Ruby developer needs to understand  differences between this two common rake tasks. Basically, these simple definition tells us everything we need to know:</p>

<ul>
<li><code>rake db:migrate</code> runs migrations that have not run yet</li>
<li><code>rake db:schema:load</code> loads the schema.db file into database.</li>
</ul>

<p>but the real question is when to use one or the other.</p>

<p><strong>Advice:</strong> <a id="advice"></a> when you are adding a new migration to an existing app then you need to run <code>rake db:migrate</code>, but when you join to existing application (<em>especially some old application</em>), or when you drop your applications database and you need to create it again, always run <code>rake db:schema:load</code> to load schema.</p>

<h3 id="example:bb0863f1c1f426893f44d7c5e616b367">Example</h3>

<p>I am working on application which use <a href="https://github.com/globalize/globalize">globalize gem</a> for ActiveRecord model/data translations. Globalize work this way:</p>

<ul>
<li>first specify attributes which need to be translatable</li>
</ul>

<pre><code class="language-ruby">class Post &lt; ActiveRecord::Base
  translates :title, :text
end
</code></pre>

<ul>
<li>then create translation tables</li>
</ul>

<pre><code>class CreatePosts &lt; ActiveRecord::Migration
  def up
    create_table :posts do |t|
      t.timestamps
    end
    Post.create_translation_table! title: :string, text: :text
  end
  def down
    drop_table :posts
    Post.drop_translation_table!
  end
end
</code></pre>

<p><strong>Note</strong> <em>that the ActiveRecord model Post must already exist and have listed attributes for translations</em>.</p>

<ul>
<li>and run <code>rake db:migrate</code> .</li>
</ul>

<p>Problem comes when you change your mind and decide to leave title to be untranslatable.</p>

<ul>
<li>remove title from post translations table</li>
</ul>

<pre><code>class RemoveTitleFromPostTranslations &lt; ActiveRecord::Migration
  def up
    remove_column :post_translations, :title, :string
  end

  def down
    Entry.add_translation_fields! title: :string
  end
end
</code></pre>

<ul>
<li>add title to posts table</li>
</ul>

<pre><code>class AddTitleToPosts &lt; ActiveRecord::Migration
  def change
    add_column :posts, :title, :string
  end
end
</code></pre>

<ul>
<li>remove title attribute from model translations</li>
</ul>

<pre><code>class Post &lt; ActiveRecord::Base
  translates :text
end
</code></pre>

<ul>
<li>and run <code>rake db:migrate</code>.</li>
</ul>

<p>Everything looking good, so where is the problem?</p>

<p>Here it is! If you decide to delete your database and create it again you need to use:</p>

<ul>
<li><code>rake db:drop</code></li>
<li><code>rake db:create</code></li>
<li><code>rake db:schema:load</code></li>
</ul>

<p>Because, if you try to use <code>rake db:migrate</code> instead of <code>rake db:schema:load</code> you will get <strong>BIG ERROR!</strong>, because for your first migration &ldquo;create_posts&rdquo; it is necessary that you have defined translatable attributes :title and :text in Post model, but you removed :title from Post model translations.</p>

<p>So just follow <a href="#advice">advice</a> above, and good luck.</p>

        
          <h1><a href="http://blog.orangeiceberg.com/posts/headless-firefox-in-ubuntu-on-virtualbox-for-cucumber-testing">Headless Firefox in Ubuntu on VirtualBox for Cucumber testing</a></h1>
          <h2>Thu, Dec 3, 2015</h2>
          

<p>If you use <a href="http://www.vagrantup.com/downloads.html">Vagrant</a>, <a href="https://www.virtualbox.org/">VirtualBox</a> and Ubuntu to build your Rails apps and you want to test it with Cucumber scenarios, this is the right post for you. By default Vagrant and VirtualBox use Ubuntu without an X server and GUI.</p>

<p>Everything goes well until you need <code>@javascript</code> flag for your cucumber scenario. <code>@javascript</code> uses a javascript-aware system to process web requests (e.g. Selenium) instead of the default (non-javascript-aware) webrat browser.</p>

<h3 id="install-mozilla-firefox:e440c2a4f60085f5f973ab25c52a888b">Install Mozilla Firefox</h3>

<p>Selenium WebDriver is flexible and lets you run selenium headless in servers with no display. But in order to run, Selenium needs to launch a browser. If there is no display to the machine, the browsers are not launched. So in order to use selenium, you need to fake a display and let selenium and the browser think they are running in a machine with a display.</p>

<p>Install latest version of Mozilla Firefox:</p>

<p><code>sudo apt-get install firefox</code></p>

<p>Since Ubuntu is running without a X server Selenium cannot start Firefox because it requires an X server.</p>

<h3 id="setting-up-virtual-x-server:e440c2a4f60085f5f973ab25c52a888b">Setting up virtual X server</h3>

<p>Virtual X server is required to make browsers run normally by making them believe there is a display available, although it doesn&rsquo;t create any visible windows.</p>

<p>Xvfb (X Virtual FrameBuffer) works fine for this. Xvfb lets you run X-Server in machines with no display devices.</p>

<p>Install xvfb on ubuntu:</p>

<p><code>sudo apt-get install xvfb</code></p>

<p>Lets run the Xvfb service in a display number which is less likely to clash even if you add a display at a later stage. Display 10 will do fine.</p>

<p><code>sudo Xvfb :10 -ac</code></p>

<p>The parameter -ac makes xvfb run with access control off. The server should be running now.</p>

<h3 id="headless-firefox:e440c2a4f60085f5f973ab25c52a888b">Headless Firefox</h3>

<p>Before you can run a browser, you need to set the environment variable DISPLAY with the display number at which xvfb is running.</p>

<p>Open new tab in terminal and set the DISPLAY variable:</p>

<p><code>export DISPLAY=:10</code></p>

<p>and start mozilla firefox:</p>

<p><code>firefox</code></p>

<p>Now you run firefox headlessly in Ubuntu, and you can run your cucumber scenarios with <code>@javascript</code> flag.</p>

<h3 id="start-virtual-x-server-automatically:e440c2a4f60085f5f973ab25c52a888b">Start virtual X server automatically</h3>

<p>To run your X server automatically, after installing Xvfb, you will need to:</p>

<ul>
<li>put content of <a href="https://gist.github.com/basti/2db0b71e893ee4d6d015">this gist</a> in <code>/etc/init.d/xvfb</code> (hint use <code>sudo wget</code> command to do that)</li>
<li>make it executable <code>sudo chmod a+x /etc/init.d/xvfb</code></li>
<li>start xvfb on display number 10 <code>export DISPLAY=:10</code></li>
<li>run X server <code>sudo /etc/init.d/xvfb start</code></li>
<li>when you want to stop X server <code>sudo /etc/init.d/xvfb stop</code></li>
</ul>

<p>This is my way to run firefox headlessly in Virtual box Ubuntu, and to run cucumber scenarios with <code>@javascript</code> flag.</p>

<p>References:</p>

<ul>
<li><a href="http://www.installationpage.com/selenium/how-to-run-selenium-headless-firefox-in-ubuntu/">Selenium Headless Automated Testing in Ubuntu</a></li>
<li><a href="https://gist.github.com/jterrace/2911875">Xvfb init script for Ubuntu</a></li>
</ul>

        
          <h1><a href="http://blog.orangeiceberg.com/posts/import-and-export-mysql-dump">Import and export MySQL dump</a></h1>
          <h2>Wed, Dec 2, 2015</h2>
          <p>Another simple task that&rsquo;s often hard for beginners is importing and exporting MySQL dumps. Here is quick rundown on how to do it.</p>

<p>To export data you need to use <code>mysqldump</code>:</p>

<pre><code class="language-sh">mysqldump -u db_user -p db_name &gt; dump_name.sql
</code></pre>

<p>Options given to <code>mysqldump</code> are:</p>

<ul>
<li><code>-u db_user</code> - connect as user <code>db_user</code> to database</li>
<li><code>-p</code> - use password, it will ask you to enter your password</li>
<li><code>db_name</code> is the name of MySQL database you want to dump</li>
<li><code>&gt; dump_name.sql</code> - by default <code>mysqldump</code> will print out the dump to terminal, but simple output redirect with <code>&gt;</code> will instead write it to given filename, in this case <code>dump_name.sql</code></li>
</ul>

<p>Now that you have <code>dump_name.sql</code> file with all SQL queries needed to replicate your database you can import it using general-purpose <code>mysql</code> client:</p>

<pre><code class="language-sh">mysql -u db_user -p db_name &lt; dump_name.sql
</code></pre>

<p>User, password, and database name options are the same as for <code>mysqldump</code>. Since <code>mysql</code> reads input from terminal this time we can use <code>&lt;</code> to read input from given file instead.</p>

<p>As always for more information you can consult manual using <code>man mysqldump</code> and <code>man mysql</code>.</p>

        
          <h1><a href="http://blog.orangeiceberg.com/posts/create-and-extract-archives-using-tar-and-gzip">Create and extract archives using tar and gzip</a></h1>
          <h2>Fri, Nov 13, 2015</h2>
          <p>One of the simplest tasks is creating and extracting files using <code>tar</code> and <code>gzip</code>. Yet for most new developers this is a daunting task. These days <code>tar</code> is mostly used to simply combine a few files into a single file and then <code>gzip</code> is used to compress that file.</p>

<p>Here is a quick overview how to use <code>tar</code> and <code>gzip</code> to create and compress an archive:</p>

<pre><code class="language-sh"># archive individual files
tar -cvzf myarchive.tar.gz /path/to/file1 /path/to/file2

# archive whole directory
tar -cvzf myarchive.tar.gz /path/to/dir

# archive whole directory but don't store full path
tar -cvzf myarchive.tar.gz -C /path/to/dir ./
</code></pre>

<p>Options give to tar are: <code>c</code> to create new archive, <code>v</code> to be verbose, <code>z</code> to compress resulting archive with <code>gzip</code>, and <code>f</code> to write the archive to specified file. After options you can list files and dirs you want to archive.</p>

<p>In all examples we provide a full path to a file or dir we want to archive. In this case <code>tar</code> will store files in the archive using the full path. This means once you extract the files you&rsquo;ll have a complete directory structure from root dir onwards.</p>

<p>The way to avoid this is either to manually <code>cd</code> to dir in which files are stored, or to tell <code>tar</code> using <code>C</code> option to change dir before archiving files.</p>

<p>Finally to extract an archive:</p>

<pre><code class="language-sh">tar -xvzf myarchive.tar.gz
</code></pre>

<p>The <code>x</code> option tells <code>tar</code> to extract the archive into current directory.</p>

<p>For more information you can consult manual using <code>man tar</code>.</p>

        
          <h1><a href="http://blog.orangeiceberg.com/posts/creating-and-publishing-a-ruby-gem">Creating and publishing a ruby gem</a></h1>
          <h2>Mon, Jun 8, 2015</h2>
          

<p>A gem is a simple way to distribute functionality, it can be a small plugin, a Ruby library or sometimes a whole program. Thanks to RubyGems, a gem hosting service, developers have a wide range of gems at their disposal allowing them to easily add functionality to their applications.</p>

<p>But what if there is no gem available that will suit the functionality you need, and you find yourself writing the same code over and over again for different projects? Well, in that case you should consider making your own gem.</p>

<p>It&rsquo;s considered a good practice to extract a gem out of an existing application, since that way you will have a better understanding of all the requirements as well as how the gem will be used. This blog post will illustrate just that on a real life example, and will take you through the process of creating a slug_converter gem.</p>

<h3 id="slug-converter-gem:26b86b95592661b7092ab782e8d51bcd">Slug converter gem</h3>

<p>Source code for slug_converter gem was developed while working on a link shortener application, in order to generate a string consisting of predefined characters, based on a given id number of a link. As it will be described in this blog post, this code was easily extracted from the application into an independent gem that was released on  RubyGems.</p>

<p>Although it may seem like a complex task at first, creating a gem is not that difficult, if you have RubyGems and Bundler installed you are good to go. We already know what RubyGems is, and Bundler is a package manager that determines a full set of direct dependencies needed by your application.</p>

<p>Now let&rsquo;s build a gem!</p>

<h3 id="creating-a-gem:26b86b95592661b7092ab782e8d51bcd">Creating a gem</h3>

<p>First step is to make sure that bundler gem is installed.</p>

<pre><code class="language-sh">$ gem install bundler
</code></pre>

<p>once bundler is installed creating a structure for your new gem is easy,</p>

<pre><code class="language-sh">	$ bundle gem slug_converter
</code></pre>

<p>The first time you use bundler to create a gem you will be prompted to answer a couple of questions:</p>

<pre><code class="language-sh">	Do you want to include code of conduct in your gems you generate?
	Do you want to licence your code permissively under the MIT licence?
	Do you want to generate tests with your gem? 
	Type rspec or minitest to generate those tests files now and in the future:
</code></pre>

<p>Answering these questions will help bundler configure and setup files that are being generated now and in the future. Here we answered yes to first 4 qestions and choose rspec for testing.</p>

<p>Running <code>$ bundle gem slug_converter</code> command resulted with &ldquo;slug_converter&rdquo; directory with essential gem file structure being created, and git repository initialized, assuming that you are using git for version management (as you should).</p>

<pre><code class="language-sh">Creating gem 'slug_converter'...
 create  slug_converter/Gemfile
 create  slug_converter/.gitignore
 create  slug_converter/lib/slug_converter.rb
 create  slug_converter/lib/slug_converter/version.rb
 create  slug_converter/slug_converter.gemspec
 create  slug_converter/Rakefile
 create  slug_converter/README.md
 create  slug_converter/bin/console
 create  slug_converter/bin/setup
 create  slug_converter/LICENSE.txt
 create  slug_converter/.travis.yml
 create  slug_converter/.rspec
 create  slug_converter/spec/spec_helper.rb
 create  slug_converter/spec/slug_converter_spec.rb
</code></pre>

<p>Let&rsquo;s go through files that bundler generated for us, .gemspec file is the &ldquo;heart&rdquo; of your gem so lets start with <code>slug_converter.gemspec</code></p>

<pre><code class="language-ruby">lib = File.expand_path('../lib', __FILE__)
$LOAD_PATH.unshift(lib) unless $LOAD_PATH.include?(lib)
require 'slug_converter/version'

Gem::Specification.new do |spec|
  spec.name         = &quot;slug_converter&quot;
  spec.version      = SlugConverter::VERSION
  spec.authors      = [&quot;Your Name&quot;]
  spec.email        = [&quot;youremail@example.com&quot;]

  # if spec.respond_to?(:metadata)
  #   spec.metadata['allowed_push_host'] = &quot;TODO: Set to 'http://mygemserver.com' to prevent pushes to rubygems.org, or delete to allow pushes to any server.&quot;
  # end

  spec.summary      = %q{Number &lt;-&gt; Slug converter}
  spec.description  = %q{Generates a slug based on the given number and the other way around}
  spec.homepage     = &quot;https://github.com/orangeiceberg/slug_converter&quot;
  spec.license      = &quot;MIT&quot;

  spec.files        = `git ls-files -z`.split(&quot;\x0&quot;).reject { |f| f.match(%r{^(test|spec|features)/}) }
  spec.bindir       = &quot;exe&quot;
  spec.executables  = spec.files.grep(%r{^exe/}) { |f| File.basename(f) }
  spec.require_paths= [&quot;lib&quot;]

  spec.add_development_dependency &quot;bundler&quot;, &quot;~&gt; 1.8&quot;
  spec.add_development_dependency &quot;rake&quot;, &quot;~&gt; 10.0&quot;
end
</code></pre>

<p>This file contains metadata about your gem and it can be populated directly, so here you can enter all the data such as name, description, licence&hellip; This file also contains information about what files should be packaged in your gem, as well as the load path to include the gem directory when the gem is first loaded. Most of these default settings will work for the majority of gems but you can always edit them if you want different behavior. At the bottom of the file add any gem dependencies that are required.</p>

<p>The version number of the gem is set in <code>SlugConverter::VERSION</code> constant which is kept in a separate version.rb file, and you can change it there for every new version of your gem.</p>

<pre><code>lib
 |--slug_converter
         |--version.rb
</code></pre>

<p>A very important part of every gem is the <code>README</code> file, where you can describe how to install and use the gem, and the <code>LICENCE</code> file where you can define the terms and conditions under which the gem can be used.</p>

<p>In the lib directory there is a file which has the same name as your gem (recommended), and that file will be loaded when someone requires your gem. If the gem you are writing is simple all the code can be placed in this single file, or in case of more complex gems all the other files from the lib directory are required in this file.</p>

<p>There is also a <code>Gemfile</code> generated, but this file doesn&rsquo;t have to be managed directly since all it does is look in <code>.gemspec</code> for required dependencies and then loads them through bundler. All the dependencies required by the gem should be specified in the <code>.gemspec</code> file.</p>

<p>Another file that is generated by the bundler is <code>Rakefile</code> which just adds some gem tasks from bundler, and we can see those tasks with explanation by running</p>

<pre><code class="language-sh">	rake -T
	rake build    # Build slug_converter-0.0.1.gem into the pkg directory
	rake install  # Build and install slug_converter-0.0.1.gem into system gems
	rake release  # Create tag v0.0.1 and build and push slug_converter-0.1.0.gem to Rubygems
</code></pre>

<h3 id="writing-tests:26b86b95592661b7092ab782e8d51bcd">Writing tests</h3>

<p>If you are following the principles of Test Driven Development you will probably like to start by writing tests for you gem, for that purpose I would suggest using RSpec.
To do that you will need to add rspec as a development dependency to you gemspec file:
    spec.add_development_dependency &lsquo;rspec&rsquo;</p>

<p>As mentioned in the beginning, when running bundle gem for the first time, bundler will asks if you would like to generate test files for your gem and to choose if you want to use rspec or minitest. If you answer with yes, and choose rspec, bundler will generate a spec directory with two files:</p>

<pre><code>|-- spec
      |-- slug_converter_spec.rb
      |-- spec_helper.rb
</code></pre>

<p>In the <code>spec_helper.rb</code> file you can reference any test globals or configuration.</p>

<p>Since we are extracting code from an existing application we already have all the tests written so we just need to copy them into the generated <code>spec/slug_converter_spec.rb</code> file.</p>

<pre><code class="language-ruby">require 'spec_helper'
describe SlugConverter do
  it 'has a version number' do
    expect(SlugConverter::VERSION).not_to be nil
  end
  describe &quot;.number&quot; do
  
    it &quot;returns number when number is set&quot; do
      converted_slug= SlugConverter.new(111)
      expect(converted_slug.number).to eq(111)
    end
    
    it &quot;returns decoded number for existing slug&quot; do
      converted_slug = SlugConverter.new(&quot;vg&quot;)
      expect(converted_slug.number).to eq(363)
    end
    
  end
  
  describe &quot;.number&quot; do
  
    it &quot;sets number to given value&quot; do
      converted_slug = SlugConverter.new(211)
      expect(converted_slug.number=210).to eq(210)
    end
    
    it &quot;sets slug to encoded value of number&quot; do
      converted_slug = SlugConverter.new(211)
      converted_slug.number=210
      expect(converted_slug.slug).to eq(&quot;pb&quot;)
    end
    
    it &quot;sets number to integer value of given number passed as string&quot; do
      converted_slug = SlugConverter.new(&quot;210&quot;)
      expect(converted_slug.number).to eq(210)
    end
    
    it &quot;sets slug to encoded value of given number passed as string&quot; do
      converted_slug = SlugConverter.new(&quot;210&quot;)
      expect(converted_slug.slug).to eq(&quot;pb&quot;)
    end
    
    it &quot;sets number to integer value of argument that starts with a number but also contains letters&quot; do
      converted_slug = SlugConverter.new(&quot;210jj&quot;)
      expect(converted_slug.number).to eq(210)
    end
    
    it &quot;sets slug to encoded value of argument that starts with a number but also contains letters&quot; do
      converted_slug = SlugConverter.new(&quot;210jj&quot;)
      expect(converted_slug.slug).to eq(&quot;pb&quot;)
    end
    
  end
  
  describe &quot;.slug&quot; do
  
     it &quot;returns slug when slug is set&quot; do
        converted_slug = SlugConverter.new(&quot;hy&quot;)
        expect(converted_slug.slug).to eq(&quot;hy&quot;)
     end
     
     it &quot;returns encoded slug when link id is set&quot; do
        converted_id = SlugConverter.new(113)
        expect(converted_id.slug).to eq(&quot;hy&quot;)
     end
     
  end
  
  describe &quot;.slug&quot; do
  
    it &quot;sets slug to given value&quot; do
      converted_slug = SlugConverter.new(&quot;ezk&quot;)
      expect(converted_slug.slug=(&quot;ebk&quot;)).to eq(&quot;ebk&quot;)
    end
    
    it &quot;sets number to decoded value of slug&quot; do
      converted_slug = SlugConverter.new(&quot;pb&quot;)
      converted_slug.slug=(&quot;ezk&quot;)
      expect(converted_slug.number).to eq(1483)
    end
    
    it &quot;raises Arrgument Error exception if given value is an empty string&quot; do
      expect { SlugConverter.new(&quot;&quot;) }.to raise_error(ArgumentError)
    end
    
    it &quot;raises Arrgument Error exception if given value is nil&quot; do
      expect { SlugConverter.new(nil) }.to raise_error(ArgumentError)
    end
    
    it &quot;raises Arrgument Error exception if given value contains unpermitted letters&quot; do
      expect { SlugConverter.new(&quot;iiii&quot;) }.to raise_error(ArgumentError)
    end
    
    it &quot;raises Arrgument Error exception if given value starts with letter but contains numbers&quot; do
      expect { SlugConverter.new(&quot;bb12&quot;) }.to raise_error(ArgumentError)
    end
    
  end
end
</code></pre>

<p>To make rspec rake task available we will setup tasks folder where we&rsquo;ll place our <code>rspec.rake</code> file containing only 2 lines:</p>

<pre><code class="language-ruby">	require 'rspec/core/rake_task'
	RSpec::Core::RakeTask.new(:spec)
</code></pre>

<p>and then we will import this file in our Rakefile that bundler provided automatically:</p>

<pre><code class="language-ruby">	Dir.glob('tasks/**/*.rake').each(&amp;method(:import))
</code></pre>

<p>Now run:</p>

<pre><code class="language-sh">bundle exec rake spec 
</code></pre>

<p>And watch your tests fail. :)</p>

<h3 id="add-gem-functionality:26b86b95592661b7092ab782e8d51bcd">Add gem functionality</h3>

<p>Now we need to make those test go green. To do that we will again copy the existing code from our application in the main gem file <code>lib/slug_converter.rb</code>:</p>

<pre><code class="language-ruby">require &quot;slug_converter/version&quot;
require 'set'
require 'gem_config'

class SlugConverter
  include GemConfig::Base
  with_configuration do
    has :alphabet, default: &quot;qjeghxtrpnfmdzwvsybkuoca&quot;
  end

  def initialize(number_or_slug)
     @alphabet = SlugConverter.configuration.alphabet.split(//)
    if number_or_slug.to_i != 0
      @number = number_or_slug.to_i
    elsif validate_string(number_or_slug)
      @slug = number_or_slug.downcase
    else
      raise ArgumentError, 'Argument must be integer value or non-empty string consisting of predefined letters'
    end
  end
  
  def number
    if @number.nil?
      @number = bijective_decode
    else
      @number
    end
  end
  
  def number=(new_number)
    @number = new_number
    @slug = bijective_encode
    @number
  end
  
  def slug
    if @slug.nil?
      @slug = bijective_encode
    else
      @slug
    end
  end
  
  def slug=(new_slug)
    @slug = new_slug
    @number = bijective_decode
    @slug
  end

  private
  
    def bijective_encode
      id = @number
      return @alphabet[0] if id == 0
      s = ''
      base = @alphabet.length
      while id &gt; 0
        s &lt;&lt; @alphabet[id.modulo(base)]
        id /= base
      end
      s.reverse
    end
    
    def bijective_decode
      i = 0
      base = @alphabet.length
      @slug.each_char { |c| i = i * base + @alphabet.index(c) }
      i
    end
    
    def validate_string(slug)
      unless slug.nil?
        alphabet = Set.new @alphabet
        slug_letters = Set.new slug.downcase().split(//)
        slug != &quot;&quot; &amp;&amp; (slug_letters.subset? alphabet)
      end
    end
end
</code></pre>

<p>Now when we run the tests again, they should all pass.</p>

<p>###Making your gem configurabile</p>

<p>In order to allow users to set their own alphabet that will be used by the SlugConverter, we needed to make our gem configurabile. To do this we used <a href="https://github.com/krautcomputing/gem_config">https://github.com/krautcomputing/gem_config</a> gem.</p>

<p>You will notice this code at the begining of the SlugConverter class:</p>

<pre><code class="language-ruby">class SlugConverter
  include GemConfig::Base
  
  with_configuration do
    has :alphabet, default: &quot;qjeghxtrpnfmdzwvsybkuoca&quot;
  end

  def initialize(number_or_slug)
     @alphabet = SlugConverter.configuration.alphabet.split(//)
     # ...
  end	  
  
  # rest of the code omitted    
end
</code></pre>

<p>this code along with <code>spec.add_runtime_dependency 'gem_config'</code> added as a dependency in <code>slug_converter.gemspec</code> file, alows us to make the gem configureabile.</p>

<p>Custom aphabet can than be defined by adding <code>config/initializers/slug_converter.rb</code> to your application, and defining the alphabet like this:</p>

<pre><code class="language-ruby">SlugConverter.configuration.alphabet = &quot;your_custom_alphabet_here&quot;
</code></pre>

<h3 id="releasing-your-gem:26b86b95592661b7092ab782e8d51bcd">Releasing your gem</h3>

<p>Now that we have the test passing and all the code in place it&rsquo;s time to make the gem available for everyone to use by releasing it on RubyGems, to do that you will need to have a RubyGems account. If this is the first time you release a gem you will be prompted to enter your RubyGems username and password. You will also need to have your repository setup on Github.</p>

<p>Then with just one comand:</p>

<pre><code class="language-sh">	$ bundle exec rake release
</code></pre>

<ul>
<li>your code will be pushed to your Github repository,</li>
<li>your git repository will be tagged with the version number using a name like &ldquo;v1.0.0&rdquo;.</li>
<li>your gem released on RubyGems.</li>
</ul>

<p>The ruby gem described in this blog post can be found here <a href="https://rubygems.org/gems/slug_converter">https://rubygems.org/gems/slug_converter</a>, and all the code is in this GitHub repository <a href="https://github.com/orangeiceberg/slug_converter">https://github.com/orangeiceberg/slug_converter</a> .</p>

        
          <h1><a href="http://blog.orangeiceberg.com/posts/changing-database-starting-id">changing database starting id</a></h1>
          <h2>Mon, Jun 1, 2015</h2>
          <p>For our new project it was necessary to modify the starting id of our database. This can be handled through migration for creating table but we decided to create a rake task that handled this for us.</p>

<p>The rake task that we created detects what database is being used and executes appropriate changes according to that.</p>

<p>You can create a rake task using rails generate command for rake task:</p>

<pre><code>rails g task namespace task_name
</code></pre>

<p>This will create your task in lib/tasks with chosen namespace and task name.</p>

<p>Here is our task and an explanation that follows.</p>

<pre><code class="language-ruby">namespace :database do
  desc &quot;Detect database that's being used and then increment its id&quot;
  task autoincrement: :environment do
  
    db_name_downcase = ActiveRecord::Base.connection.adapter_name.downcase

    if Link.maximum(:id).to_i &lt; 1000
      if db_name_downcase.start_with? &quot;mysql&quot;
        ActiveRecord::Base.connection.execute(&quot;ALTER TABLE links AUTO_INCREMENT = 1000&quot;)
      end
      if db_name_downcase.start_with? &quot;postgres&quot;
        ActiveRecord::Base.connection.execute(&quot;ALTER SEQUENCE links_id_seq START with 1000 RESTART;&quot;)
      end
      if db_name_downcase.start_with? &quot;sqlite&quot;
        ActiveRecord::Base.connection.execute(&quot;insert into sqlite_sequence(name,seq) values('links', 1000)&quot;)
      end
    else
      puts &quot;To perform this task your database shouldn't have records with id number higher than 1000&quot;
    end
    
  end
end
</code></pre>

<p>We need to change the starting id of our database to 1000 so we check that we don&rsquo;t have a record with id higher than 1000. Link is our Active Record model and links is the name of our table.</p>

<p>ActiveRecord::Base.connection returns the connection currently associated with the class. We use it to detect the name of database and execute appropriate changes.
###MySQL
For MySQL we need to set AUTO_INCREMENT value to 1000, Auto-increment allows a unique number to be generated when a new record is inserted into a table. When first record is created it sets its primary key to 1 by default  and it will auto increment by 1 for each new record.
###PostgreSQL
For Postgres we have to explain what a sequence is. A sequence is a special kind of a database object designed for generating unique numeric identifiers. It is typically used to generate artificial primary keys. Sequences are similar to the Auto-increment concept in MySQL.
###SQLite
For SQlite we altered sqlite_sequence table, which is an internal table used to implement AUTOINCREMENT. It is created automatically whenever any ordinary table with an AUTOINCREMENT integer primary key is created.</p>

<p>You can check <a href="http://stackoverflow.com/questions/2075331/change-starting-id-number">this Stack Overflow discussion</a> that was very helpful to me.</p>

        
          <h1><a href="http://blog.orangeiceberg.com/posts/customize-devise-permitted-parameters">Customize Devise permitted parameters</a></h1>
          <h2>Mon, May 4, 2015</h2>
          <p>If you are using Devise gem for authentication and you have been adding custom fields to your model you’ll get in trouble when you try to create a new instance or update an existing one. All your added fields will be treated as unpermitted. The solution for this problem is to customise Devise’s configure_permited_parameters action. All you need to do is to add this action to your Application controller and push parameters that need to be permitted to devise_paremeter_sanitizer array. So let’s say you have a User Model and you have added company_name and website fields to your user’s table, to permit this parameters on sign_up you need to add this to your Application controller:</p>

<pre><code>def configure_permitted_parameters
  devise_parameter_sanitizer.for(:sign_up).push(:company_name, :website)
end
</code></pre>

<p>It is the same principle for the :sign_in and :edit_account. You can see what are <a href="https://github.com/plataformatec/devise/blob/master/lib/devise/parameter_sanitizer.rb#L83">default permitted parameters here</a>.</p>

        
          <h1><a href="http://blog.orangeiceberg.com/posts/how-to-skip-devise-trackable-updates">How to skip Devise trackable updates</a></h1>
          <h2>Mon, May 12, 2014</h2>
          <p>Devise has a very useful Trackable module used to track user&rsquo;s sign in count, timestamps and IP address. There are some occasions when you need to disable tracking. For example for API requests where user signs in on every request; for instances where admin might sign in as an user; and similar.</p>

<p>To disable Devise Trackable module you need to set <code>request.env[&quot;devise.skip_trackable&quot;] = true</code>. You have to do that before trying to authenticate user, so you&rsquo;ll want to put it in a before_filter, or even better prepend_before_filter to make sure it&rsquo;s before authentication.</p>

<p>Add this to your controller in which you want to disable tracking:</p>

<pre><code>prepend_before_filter :disable_devise_trackable

protected
  def disable_devise_trackable
    request.env[&quot;devise.skip_trackable&quot;] = true
  end
</code></pre>

        
          <h1><a href="http://blog.orangeiceberg.com/posts/upgrade-ubuntu-8.04-lts-server">Upgrade Ubuntu 8.04 LTS server</a></h1>
          <h2>Mon, Jan 6, 2014</h2>
          <p>Note to self: here is how to upgrade Ubuntu 8.04 LTS (or any other release that is no longer supported) to newer Ubuntu release.</p>

<p>When you are upgrading unsupported release of Ubuntu if you try to do the usual <code>sudo apt-get update</code> it will most likely fail because&hellip; well, it&rsquo;s unsupported. The simple fix for this is to change your <code>/etc/apt/sources.list</code> and replace repository URLs from something like <code>us.archive.ubuntu.com</code> to <code>old-releases.ubuntu.com</code>.</p>

<p>After that you should be able follow normal upgrade procedure (use sudo if you are not root):</p>

<pre><code class="language-sh">apt-get update
apt-get install update-manager-core
do-release-upgrade
</code></pre>

<p>References:</p>

<ul>
<li><a href="http://rimuhosting.com/knowledgebase/linux/distros/ubuntu" title="Rimuhosting's page on upgrading Ubuntu">Rimuhosting&rsquo;s page on upgrading Ubuntu</a></li>
<li><a href="http://askubuntu.com/questions/91815/how-to-install-software-or-upgrade-from-old-unsupported-release" title="Discussion on upgrading unsupported Ubuntu release">Discussion on upgrading unsupported Ubuntu release</a></li>
</ul>

        
          <h1><a href="http://blog.orangeiceberg.com/posts/quick-virtualbox/vagrant-setup-with-heroku-like-box">Quick VirtualBox/Vagrant setup with Heroku-like box</a></h1>
          <h2>Mon, Sep 16, 2013</h2>
          <p>Here is a quick way to setup VirtualBox using Vagrant with Heroku-like box on Mac.</p>

<ol>
<li><p>Install VirtualBox from <a href="https://www.virtualbox.org/wiki/Downloads" target="_blank"><a href="https://www.virtualbox.org/wiki/Downloads">https://www.virtualbox.org/wiki/Downloads</a></a></p></li>

<li><p>Install Vagrant from <a href="http://downloads.vagrantup.com/" target="_blank"><a href="http://downloads.vagrantup.com/">http://downloads.vagrantup.com/</a></a></p></li>

<li><p>Create Vagrantfile for Heroku-like box (based on <a href="https://github.com/ejholmes/vagrant-heroku" target="_blank"><a href="https://github.com/ejholmes/vagrant-heroku">https://github.com/ejholmes/vagrant-heroku</a></a>) that looks something like:</p></li>
</ol>

<pre><code class="language-ruby">        Vagrant.configure(&quot;2&quot;) do |config|        
	        config.vm.box = &quot;heroku&quot;
	        config.vm.box_url = &quot;https://dl.dropboxusercontent.com/s/rnc0p8zl91borei/heroku.box&quot;
          config.vm.synced_folder &quot;.&quot;, &quot;/vagrant&quot;, :nfs =&gt; true
	        config.vm.network :private_network, ip: &quot;192.168.1.42&quot;  # required for NFS
        end
</code></pre>

<p>Beside telling Vagrant to use Heroku-like box from <a href="https://github.com/ejholmes/vagrant-heroku" target="_blank"><a href="https://github.com/ejholmes/vagrant-heroku">https://github.com/ejholmes/vagrant-heroku</a></a> it also sets up shared dir between host and VM machine. It will mount Vagrantfile dir (.) to /vagrant in VM.</p>

<p><code>vagrant up</code> will setup the VM and start it up.</p>

<p>Now you can use <code>vagrant ssh</code> to login to VM.</p>

<p>Vagrant Heroku-like box comes with Postgresql, but if you want you can easily setup sqlite:</p>

<pre><code class="language-sh">sudo apt-get install libsqlite3-dev
</code></pre>

<p><strong>Bonus tip</strong>: when you are working on multiple projects sometimes you can forget which VMs are running. You can list all running VMs using:</p>

<pre><code class="language-sh">VBoxManage list runningvms
</code></pre>

<p>Further reading:</p>

<ul>
<li><a href="http://docs.vagrantup.com/v2/" target="_blank">Vagrant docs</a></li>
<li><a href="https://github.com/ejholmes/vagrant-heroku" target="_blank">Vagrant Heroku-like box</a> which can be easily customized.</li>
<li><a href="http://loudcoding.com/posts/how-to-use-vagrant-to-run-celadon-cedar-stack-on-heroku/" target="_blank">Another Vagrant setup tutorial</a></li>
<li><a href="https://www.stackmachine.com/blog/web-development-on-a-vm-is-it-slower" target="_blank">VM speed benchmarks</a> in case you doubt in VM speed.</li>
</ul>

        
          <h1><a href="http://blog.orangeiceberg.com/posts/railsdiff">RailsDiff</a></h1>
          <h2>Tue, Sep 10, 2013</h2>
          <p><a title="RailsDiff - compare Rails default app" href="http://railsdiff.org/" target="_blank">RailsDiff</a>
is a very useful site when upgrading Rails versions (for example, from Rails 3.2 to Rails 4). It will generate default Rails app using two different Rails versions and it will compare them. The result is that you can see all the configuration changes (like in application.rb) and all other changes &#8211; which is really useful when upgrading to new Rails version.</p>

        
          <h1><a href="http://blog.orangeiceberg.com/posts/rspec-and-factorygirl-setup-for-testing-carrierwave-uploaders">RSpec and FactoryGirl setup for testing Carrierwave uploaders</a></h1>
          <h2>Sat, Sep 7, 2013</h2>
          

<p>Assume that you have the usual setup with model (MyFile) using simple Carrierwave uploader (MyFileUploader):</p>

<pre># app/models/my_file.rb
class MyFile &lt; ActiveRecord::Base
  mount_uploader :file, MyFileUploader
end</pre>

<p>To be able to test Carrierwave uploaders with RSpec using FactoryGirl factories you need:</p>

<ul>
<li><span style="line-height: 13px;">define factory with uploaded file</span></li>
<li>modify test environment storage so test file uploads are separated from other uploads</li>
<li>turn off image processing to speed up tests</li>
<li>perform cleanup after each test</li>
</ul>

<h2 id="define-factory:f55ec0979c7942ed3400c6817da421f3">Define factory</h2>

<pre># spec/factories/my_files.rb
FactoryGirl.define do
 factory :my_file do
   photo Rack::Test::UploadedFile.new(File.open(File.join(Rails.root, '/spec/fixtures/myfiles/myfile.jpg')))
 end
end</pre>

<h2 id="setup-carrierwave:f55ec0979c7942ed3400c6817da421f3">Setup Carrierwave</h2>

<p>First we need to make sure Carrierwave is using local file system for storage and to disable file processing for testing environments. Disabling file processing will speed up tests considerably. We can do that by adding following to Carrierwave initializer:</p>

<pre>if Rails.env.test? || Rails.env.cucumber?
  CarrierWave.configure do |config|
    config.storage = :file
    config.enable_processing = false
  end
end</pre>

<p>Next we should separate test uploads from any other uploads. We can do that by modifying cache_dir and store_dir methods for all Carrierwave models (i.e. all models that are descendants of CarrierWave::Uploader::Base). So the whole Carrierwave initializer looks something like:</p>

<pre># config/initializers/carrierwave.rb
if Rails.env.test? || Rails.env.cucumber?
  CarrierWave.configure do |config|
    config.storage = :file
    config.enable_processing = false
  end

  # make sure our uploader is auto-loaded
  MyFileUploader

  # use different dirs when testing
  CarrierWave::Uploader::Base.descendants.each do |klass|
    next if klass.anonymous?
    klass.class_eval do
      def cache_dir
        "#{Rails.root}/spec/support/uploads/tmp"
      end

      def store_dir
        "#{Rails.root}/spec/support/uploads/#{model.class.to_s.underscore}/#{mounted_as}/#{model.id}"
      end
    end
  end
end</pre>

<h2 id="clean-up-uploaded-files:f55ec0979c7942ed3400c6817da421f3">Clean up uploaded files</h2>

<p>Using factory defined above will create uploaded files in cache_dir and store_dir. These are just temporary files and should be removed after each test, so each of them has a clean slate. By adding after :each hook in RSpec configuration block we can remove these files simply by deleting spec/support/uploads dir.</p>

<pre># spec_helper.rb
RSpec.configure do |config|
  config.after(:each) do
    if Rails.env.test? || Rails.env.cucumber?
      FileUtils.rm_rf(Dir["#{Rails.root}/spec/support/uploads"])
    end 
  end
end</pre>

        
          <h1><a href="http://blog.orangeiceberg.com/posts/random-rails-tips">Random Rails tips</a></h1>
          <h2>Sat, Mar 9, 2013</h2>
          <p>Here are some random Rails tips I&#8217;ve found useful:</p>

<ul>
<li><strong>rails console sandbox</strong> &#8211; if you open console like this it will rollback all database changes once you exit. Pretty useful for playing around without making any changes to database.</li>
<li><strong>rake db:migrate:status</strong> &#8211; useful when you want to see the status of current database. It will show the status of all migrations.</li>
<li><strong>User.pluck(:email)</strong> &#8211; since Rails 3.2.1 you can use [pluck][1] method to get an array of values in one particular column. It&#8217;s the equvivalent of doing User.select(:email).map(&amp;:email)</li>
</ul>

<p>[1]: <a href="http://apidock.com/rails/ActiveRecord/Calculations/pluck">http://apidock.com/rails/ActiveRecord/Calculations/pluck</a></p>

        
          <h1><a href="http://blog.orangeiceberg.com/posts/paperclip-heroku-and-amazon-s3-credentials">Paperclip, Heroku and Amazon S3 credentials</a></h1>
          <h2>Mon, Jan 24, 2011</h2>
          <p>Setting up Paperclip to use Amazon&#8217;s S3 is as simple as setting :storage =&gt; :s3 and providing right credentials to Paperclip by setting :s3_credentials option. Best way to provide S3 credentials is to use an YML file (usually config/s3.yml) which allows you to set different credentials for each environment. For example:</p>

<pre># config/s3.yml
development:
  access_key_id: XYZXYZXYZ
  secret_access_key: XYZXYZXYZ
  bucket: mygreatapp-development
production:
  access_key_id: XYZXYZXYZ
  secret_access_key: XYZXYZXYZ
  bucket: mygreatapp-production
</pre>

<p>Of course you want to treat s3.yml same as database.yml &#8211; i.e. you don&#8217;t want to track it with git and you want for each person/server to have it&#8217;s own.</p>

<p>However, consider this: you are working on Open Source app in a public git repository and you are deploying it on Heroku. Heroku doesn&#8217;t allow you to create files (unless they are in git repository) and you can&#8217;t commit s3.yml with your credentials to public repository.</p>

<p>One solution is to define different :s3_credentials hash in one of the environment files or to load different YML file for each environment and generate hash from it. Downside is that you need to have a separate YML file for each environment and/or you need to convert YML to hash. Other solution could be to have separate local branch from which you will push to Heroku. Problem with this is that you have to have a local branch for deploying. This means if there are multiple developers who deploy to production each should have separate local branch.</p>

<p>Much simpler way to deploy Paperclip with different S3 credentials for each environment (with one of the environment being deployed on Heroku; and repository being public) is to create s3.yml file as usual (and don&#8217;t commit it to git), but define values only for local environment.</p>

<p>For production deployment on Heroku you can write initializer which will set :s3_credentials from ENV variables.</p>

<pre># initializers/s3.rb
if Rails.env == "production"
  # set credentials from ENV hash
  S3_CREDENTIALS = { :access_key_id => ENV['S3_KEY'], :secret_access_key => ENV['S3_SECRET'], :bucket => "sharedearth-production"}
else
  # get credentials from YML file
  S3_CREDENTIALS = Rails.root.join("config/s3.yml")
end

# in your model
has_attached_file :photo, :storage => :s3, :s3_credentials => S3_CREDENTIALS
</pre>

<p>and you can easily set persistant ENV vars on Heroku with:</p>

<pre>$ heroku config:add S3_KEY=XYZXYZ S3_SECRET=XYZXYZ
</pre>

<p>(<a href="http://docs.heroku.com/config-vars#quick-example">according to Heroku docs</a>)</p>

        
          <h1><a href="http://blog.orangeiceberg.com/posts/rails-3-reading-list">Rails 3 reading list</a></h1>
          <h2>Mon, Mar 29, 2010</h2>
          <p>I&#8217;ve been planning to catchup with all the new Rails 3 stuff. To get me started I&#8217;ve compiled a small Rails 3 related reading list.</p>

<ol>
<li><a href="http://guides.rails.info/3_0_release_notes.html">Ruby on Rails 3.0 Release Notes</a></li>
<li><a href="http://m.onkey.org/2010/1/22/active-record-query-interface">Active Record Query Interface 3.0</a></li>
<li><a href="http://edgerails.info/articles/what-s-new-in-edge-rails/2010/02/23/the-skinny-on-scopes-formerly-named-scope/">The Skinny on Scopes (Formerly named_scope)</a></li>
<li><a href="http://blog.envylabs.com/2010/02/rails-3-beautiful-code/">Rails 3 Beautiful Code</a></li>
<li><a href="http://railscasts.com/tags/27">Railscasts &#8211; rails-3.0 episodes</a></li>
<li><a href="http://joshhuckabee.com/jquery-rails-3">jQuery with Rails 3</a></li>
<li><a href="http://litanyagainstfear.com/blog/2010/02/03/the-rails-module/">The Rails Module (in Rails 3)</a></li>
</ol>

<p>Once I&#8217;m done with it I plan to get even more from:</p>

<ul>
<li><a href="http://edgerails.info/articles/what-s-new-in-edge-rails/2010/02/10/rails-3-resources/">Rails 3 Resources</a></li>
<li><a href="http://www.rubyinside.com/rails-3-0-beta-links-2966.html">Rails 3.0 Beta: 36 Links and Resources To Get You Going</a></li>
</ul>

        
          <h1><a href="http://blog.orangeiceberg.com/posts/expected-x.rb-to-define-x-loaderror">Expected x.rb to define X (LoadError)</a></h1>
          <h2>Wed, Apr 15, 2009</h2>
          <p>I have been working on extending Rails&#8217; I18n Simple backend to make it work with Serbian grammar (post on that will follow soon), but I kept getting an error:</p>

<p><code>Expected ./lib/serbian_simple.rb to define SerbianSimple (LoadError)</code></p>

<p>I&#8217;ve just spent an hour trying to figure out why this keeps happening and I found that there&#8217;s a lot of people with similar problem.</p>

<p>It seems that the problem appears when Rails tries to autoload files. In my case there was a simple solution &#8211; I just added require &#8216;serbian_simple.rb&#8217; in environment.rb to manually load the file.</p>

        
          <h1><a href="http://blog.orangeiceberg.com/posts/simple-password-protected-administration-with-codeigniter">Simple password protected administration with CodeIgniter</a></h1>
          <h2>Sun, Mar 8, 2009</h2>
          <p>Last week I&#8217;ve taken a break from Ruby/Rails development and I&#8217;ve worked on a site that uses PHP with <a href="http://codeigniter.com/">CodeIgniter</a> framework.</p>

<p>Despite the fact that CodeIgniter has a very nice documentation I found it very difficult to find a way to do some simple things, that are more or less obvious, but which can be a problem for someone who hasn&#8217;t worked with CodeIgniter before. (for example, I found myself more than once looking at CI code to figure out how it works, so I can use it)</p>

<p>I had to make a simple password protected administration section. One admin user, one password, no user registrations, no roles &#8211; simple as possible. As I was using CI framework I decided to find a plugin/library that does this. Unfortunately most CI authorization plugins/libraries are very bloated and too complicated for this simple task. I tried to find some examples how to handle this simple use case, but nothing came up.</p>

<p>Finally I&#8217;ve found a small authorization plugin: <a href="http://codeigniter.com/wiki/Erkana/">Erkanaauth</a>.</p>

<p>First you need a user table (must be named &#8216;users&#8217;) which only needs to have an id field and all other fields are optional because you will manually specify what other columns will be used. I opted for simple id, username, password:</p>

<pre>CREATE TABLE IF NOT EXISTS `users` (
  `id` int(11) NOT NULL auto_increment,
  `username` varchar(255) NOT NULL,
  `password` varchar(255) NOT NULL,
  PRIMARY KEY  (`id`)
);</pre>

<p>We will need to &#8220;install&#8221; ErkanaAuth library. You should <a href="http://codeigniter.com/wiki/File:erkanaauth.zip/">download it</a> and unzip it.</p>

<p>Next we should create an Admin controller which will handle all administration tasks (remember I&#8217;m making simple admin here, so I don&#8217;t need to protect multiple controllers).</p>

<pre>&lt;?php
class Admin extends Controller {
  function Admin()
  {
    parent::Controller();   
    $this->load->database();
    $this->load->helper(array('url', 'form', 'date'));
    $this->load->library(array('form_validation', 'upload', 'Erkanaauth', 'session'));
  }
}
?&gt;</pre>

<p>Constructor just connects to database and loads some standard helpers and libraries (including Erkanaauth) that are usually used.</p>

<p>Next step is to add a function which we can call to verify if user is logged in:</p>

<pre>private
  function authorize()
  {
      if($this->erkanaauth->try_session_login())
          return true;
  
      redirect('admin/login');
  }
</pre>

<p>Function uses Erkanaauth&#8217;s try_session_login which checks if user is already logged in (checks session for user id). If user isn&#8217;t logged in we&#8217;ll redirect him to our login page:</p>

<pre>function login()
  {
    $username = $this->input->post('username', true);
    $password = $this->input->post('password', true);
    if($username || $password)
    {
      if($this->erkanaauth->try_login(array('username' => $username, 'password' => $password)))
        redirect('admin');
    }
    
    $this->load->view('admin_login');
  }

  function logout()
  {
    $this->erkanaauth->logout();
    redirect('admin');
  }
</pre>

<p>Key command here is try_login in login function which tries to find an entry in users table that fulfills given conditions. If you have different users table than the one I made this is the place where you should enter your column names.</p>

<p>Logout function is has just a simple call to Erkana&#8217;s logout function. Nothing special there.</p>

<p>Of course we also need a login page template which should contain a simple user/pass form. It&#8217;s pretty basic and you can see it if you get the complete code (see at the end).</p>

<p>Finally we have everything needed to protect any page in Admin controller. In order to protect a page all you need to do is to add a call to authorize function to any function you want to protect. Like this:</p>

<pre>function index()
  {
    $this->authorize();
    echo "Do something useful... For now just display logout link: ";
    echo anchor('admin/logout', "Logout");
  }
</pre>

<p>That&#8217;s it. Now you have fully functional administration section which requires username and password authorization.</p>

<p>You can get the complete sample application from <a href="http://github.com/basti/ci-admin-section/tree/master">Github repository</a>. Feel free to expand on it or use it any way you like.</p>

        
          <h1><a href="http://blog.orangeiceberg.com/posts/restoring-superblock-on-ubutnu">Restoring superblock on Ubutnu</a></h1>
          <h2>Sun, Nov 9, 2008</h2>
          <p>Recently I had a problem on my Torrent box (an old PC that I use as dedicated torrent client) that runs Ubuntu. For some reason my root partition was being mounted as read-only. Everything else seemed to work (all other partitions were mounted properly), but I couldn&#8217;t change any of my config or do anything on root partition.</p>

<p>I did the usual stuff:</p>

<ul>
<li>Run fsck checks and it said that everything is fine</li>
<li>Used Ubuntu&#8217;s live CD to boot, which got me read-write access to root partition. I changed some things in fstab, tried to get it to be rw permanently. No matter what I did as soon as I rebooted the root partition was once again read-only.</li>
<li>I tried booting from some repair disks I have, but all checks passed and no problem was detected. <img src='http://icebergist.com/wp-includes/images/smilies/icon_sad.gif' alt=':(' class='wp-smiley' /></li>
</ul>

<p>Finally, I read somewhere that a similar problem was caused by faulty superblock on hard drive. Fortunately Ubuntu stores superblock backups in different places around disk, so I decided to try to restore it from one of those backups.</p>

<p>It turned out that all I needed was a single command (this <a href="http://ubuntuforums.org/showpost.php?s=72da065bbe1506b27f41a8cfc252c732&amp;p=1424786&amp;postcount=5" title="Bad superblock">Ubuntu forum post helped</a>) to restore superblock:</p>

<p><code>e2fsck -b 32768 /dev/hdc1</code></p>

<p>After that my root partition was back to read-write mode. <img src='http://icebergist.com/wp-includes/images/smilies/icon_smile.gif' alt=':)' class='wp-smiley' /></p>

<p>Before you do stuff like that to your computer I suggest that you read man pages for <a href="http://linux.die.net/man/8/mke2fs" title="mke2fs">mke2fs</a> and <a href="http://linux.die.net/man/8/e2fsck" title="e2fsck">e2fsck</a>. It will prevent you from doing something foolish like deleting your whole hard drive. <img src='http://icebergist.com/wp-includes/images/smilies/icon_smile.gif' alt=':)' class='wp-smiley' /></p>

        
          <h1><a href="http://blog.orangeiceberg.com/posts/mosso-hosting-cloud">Mosso hosting cloud</a></h1>
          <h2>Wed, Sep 17, 2008</h2>
          <p><a class="external" href="http://www.mosso.com/">Mosso&#8217;s hosting cloud</a>
at $100 / month seems like a good solution to get a scalable server. However one thing bugs me, actually two things&#8230;</p>

<p>First one: they offer <strong>FTP only access</strong>. Meaning you cannot deploy sites directly from code repositories (i.e. git or svn). That sucks.</p>

<p>Second thing that bugs me: for $100 you get quite a lot of computing power which can be used to run multiple sites &#8211; but <strong>you are only allowed to have one Rails app running</strong>. Only one. If you want additional Rails apps (for example to have a test server) you need to pay an extra fee.</p>

<p>I know it&#8217;s cloud computing and that you have to be able to run it with any additional configuration (that&#8217;s why I think it&#8217;s ok that you have to freeze your gems in Rails apps, because you cannot install any gems yourself)&#8230; but not being able to checkout my code from repository and having to upload the whole app each time you make changes <strong>is really annoying</strong>.</p>

<p>In their defense, the support guy said that they are working on it, but he could give me an ETA when they&#8217;ll allow something like that.</p>

        
          <h1><a href="http://blog.orangeiceberg.com/posts/restful-admin-namespaced-controller-using-scaffolding">RESTful admin namespaced controller using scaffolding</a></h1>
          <h2>Wed, Sep 17, 2008</h2>
          <p>Most of my clients prefer to have a separate admin section. In turn, I like to have separate controllers for admin section and front-end in my Rails app. This is not as straightforward as it might seem, especially if you like to use scaffolding for admin controller.</p>

<p>The goal is to get 2 separate RESTful controllers, admin &amp; front-end controller, one model and for admin pages to have scaffolding.</p>

<p>Here is the easiest way I found so far to accomplish this. This example generates categories model and controllers for it.</p>

<p><code>./script/generate controller admin/categories&lt;br /&gt;
./script/generate scaffold category name:string</code></p>

<p>This will generate an empty controller in admin namespace and a scaffolded resource for front-end controller.</p>

<p>Now we have everything generated we just need to make it work with admin controller and not with front-end.</p>

<ul>
<li>move all templates from app/views/categories to app/views/<strong>admin</strong>/categories</li>
<li>copy all functions from categories_controller.rb to admin/categories_controller.rb</li>
<li>add namespace for admin controller in routes.rb:<code>map.namespace :admin do |admin|&lt;br /&gt;
admin.resources :categories&lt;br /&gt;
end</code></li>
<li>in admin/categories_controller.rb replace in 3 places redirect_to calls to work with admin namespace. It will have something like redirect_to(@category), but to work with namespace it needs to have redirect_to([:admin, @category])</li>
<li>make similar changes in all templates, i.e. make it work within an admin namespace. You need to make following changes:

<ul>
<li>form_for(@category) =&gt; <strong>form_for([:admin, @category])</strong></li>
<li>&lt;%= link_to &#8216;Show&#8217;, @category %&gt; =&gt; <strong>&lt;%= link_to &#8216;Show&#8217;, [:admin, @category] %&gt;</strong></li>
<li>categories_path =&gt; <strong>admin_categories_path</strong></li>
<li>edit_category_path(@category) =&gt; <strong>edit_admin_category_path(@category)</strong></li>
<li>new_category_path =&gt; <strong>new_admin_category_path</strong></li>
</ul></li>
</ul>

<p>That&#8217;s it. Now you&#8217;ll have /admin/categories for all administrative tasks and you have a free controller for front-end actions.</p>

<p>You might wonder why not just generate scaffold for admin/categories&#8230; The reason is that you&#8217;ll also get a model that is namespaced in admin (i.e. model would be Admin::Category). Scaffolded views also wouldn&#8217;t work as it seems that generator doesn&#8217;t take into account the fact that you are using a namespace.</p>

        
          <h1><a href="http://blog.orangeiceberg.com/posts/innodb-per-table-tablespaces-">InnoDB per-table tablespaces &amp;#8211; split ibdata1 to smaller chunks</a></h1>
          <h2>Thu, Jul 24, 2008</h2>
          <p>Today I had to import 3GB of InnoDB tables in MySQL. Unfortunately, while importing the server run out of disk space &#8211; which caused whole server to grind to a halt. Naively I tried to delete imported data to free up space&#8230; I was in for an unpleasant surprise.</p>

<p>By default when MySQL uses InnoDB engine it stores most of the information in single file called ibdata1. One downside is that once ibdata1 file grows it cannot shrink &#8211; even if you delete all InnoDB tables. For some reason MySQL is set to use single file instead of per-table tablespaces similar to MyISAM.</p>

<p>Enabling per-table tablespaces is easy just add <a href="http://dev.mysql.com/doc/refman/5.0/en/multiple-tablespaces.html" title="InnoDB Per-table tablespaces">innodb_file_per_table</a> to my.cnf file. Problem is that <strong>all newly created tables</strong>, only new tables, will be in separate files. It seems that there&#8217;s no easy way to convert old tables and reclaim the space taken by ibdata1.</p>

<p>There are 3 ways and two are basically export-drop-delete-import type of solutions:</p>

<ol>
<li>Convert all InnoDB tables to MyISAM</li>
<li>Export only InnoDB tables, drop them, delete ibdata1 and import InnoDB tables.</li>
<li>Export all databases, delete ibdata1 and import everything back.</li>
</ol>

<p>I choose option 2 because I luckily had only 40 InnoDB tables and much more using MyISAM. For details on how to apply each solution and down/up sides of each read <a href="http://vdachev.net/blog/2007/02/22/mysql-reducing-ibdata1/en/" title="MySQL Reducing ibdata1">MySQL: Reducing ibdata1</a>.</p>

        
          <h1><a href="http://blog.orangeiceberg.com/posts/this-should-be-interesting-weekly-">This should be interesting weekly &amp;#8211; week 28</a></h1>
          <h2>Sun, Jul 13, 2008</h2>
          <ul>
<li>What&#8217;s New in Edge Rails: <a href="http://tumblelog.slobodankovacevic.com/post/41430445/whats-new-in-edge-rails-easy-join-table-conditions">Easy Join Table Conditions.</a></li>
<li><a href="http://tumblelog.slobodankovacevic.com/post/41483353/faces-of-millions">Faces of Millions</a> &#8211; Art project which aims to gather one million photos of people faces and create 10m x 10m photo mosaic.</li>
<li><a href="http://tumblelog.slobodankovacevic.com/post/41727168/uni-form">Uni-Form</a> is an attempt to standardize form markup (xhtml) and css.</li>
<li><a href="http://tumblelog.slobodankovacevic.com/post/41886839/mac-fullscreen-quicklook-a-k-a-slideshow">Mac OS X full screen QuickLook shortcut.</a></li>
<li>A guide to <a href="http://tumblelog.slobodankovacevic.com/post/41978415/a-guide-to-css-support-in-email">CSS support in Email</a>.</li>
</ul>

<p>condensed from &lsquo;<a href="http://tumblelog.slobodankovacevic.com/">this should be interesting</a>&rsquo; tumblelog</p>

        
          <h1><a href="http://blog.orangeiceberg.com/posts/collection-partial-variable-naming-">Collection partial variable naming &amp;#8211; new in edge rails</a></h1>
          <h2>Mon, Jul 7, 2008</h2>
          <p>One thing that always annoyed me when rendering collection partials is that a local var in partial is named same as a partial template name. So, to go around this I always created another local variable in partial and gave it a more meaningful name.</p>

<p>No longer&#8230; As the <a href="http://ryandaigle.com/articles/2008/7/7/what-s-new-in-edge-rails-collection-partial-variable-naming" title="What's New in Edge Rails: Collection Partial Variable Naming ">Ryan says</a> from now on in the Edge Rails you can specify the name of the local variable in which each collection element will be exposed within a partial. You will can do this:</p>

<pre>render :partial =&gt; 'employees', :collection =&gt; @workers, :as =&gt; :person</pre>

<p>It&#8217;s a simple thing, but it&#8217;s just one of the things that bugged me. I am glad it&#8217;s gone now.</p>

        
          <h1><a href="http://blog.orangeiceberg.com/posts/this-should-be-interesting-weekly-">This should be interesting weekly &amp;#8211; week 27</a></h1>
          <h2>Sun, Jul 6, 2008</h2>
          <p>This is the first weekly condensed edition of my <a href="http://tumblelog.slobodankovacevic.com/" title="Tumblelog by Slobodan Kovacevic">&#8220;This should be interesting&#8221; tumblelog</a>. Every Sunday I will re-post most interesting posts here on the Icebergist.</p>

<ul>
<li><a href="http://tumblelog.slobodankovacevic.com/post/40966961/new-free-book-ruby-on-rails-2-1-whats-new" title="Free Book: &quot;Ruby on Rails 2.1 - What’s new&quot;">Free Book: &#8220;Ruby on Rails 2.1 &#8211; What’s new&#8221;</a></li>
<li><a href="http://tumblelog.slobodankovacevic.com/post/40888615/better-blockquotes-blockquotes-examples" title="Better Blockquotes - Blockquotes examples">Better Blockquotes</a> &#8211; blockquotes CSS styling examples</li>
<li><a href="http://tumblelog.slobodankovacevic.com/post/39785793/slife-free-automatic-time-tracking-for-mac" title="Slife - free automatic time tracking for Mac">Slife</a> &#8211; free automatic time tracking for Mac</li>
<li><a href="http://tumblelog.slobodankovacevic.com/post/39263529/unfocus-history-keeper-back-button-enabling-deep" title="unfocus-history-keeper">unfocus-history-keeper</a> &#8211; back button enabling, deep linking, event driven Javascrpt/DHTML/Ajax Library (works for Flash too)</li>
</ul>

        
          <h1><a href="http://blog.orangeiceberg.com/posts/mac-os-x-problems-upgrading-from-10.5.3-to-10.5.4">Mac OS X problems upgrading from 10.5.3 to 10.5.4</a></h1>
          <h2>Fri, Jul 4, 2008</h2>
          <p>Today I tried to upgrade my Mac from 10.5.3 to 10.5.4 using normal Software Update. That didn&#8217;t go as planned as installation hanged at &#8220;Configuring Installation&#8221; and only thing I could do is shutdown the computer.</p>

<p>After some research and few unsuccessful retries I have finally managed to solve the upgrade problem by downloading standalone 10.5.4 update from <a href="http://www.apple.com/support/downloads/" title="Download Apple Mac OS X update">Apple download section</a>; booting in safe mode (hold shift key when booting) and then installing the update.</p>

        
          <h1><a href="http://blog.orangeiceberg.com/posts/sproutcore-">SproutCore &amp;#8211; a javascript framework</a></h1>
          <h2>Thu, Jul 3, 2008</h2>
          <p><a href="http://www.sproutcore.com" title="SproutCore - Javascript Framework">SproutCore</a> is a javascript framework which tries to enable developers to build web apps that look and act more like a desktop apps.</p>

<p>It steps away from a classic web app model by moving a lot of app into the browser itself, which then interacts with server via AJAX. As it says on the <a href="http://www.sproutcore.com/about/" title="About SproutCore">SproutCore site</a>:</p>

<blockquote>
<p>After lots of testing, we have found that the most efficient way to server a SproutCore application is as a …. static web page!</p>
</blockquote>

<p>This means that a &#8220;simple&#8221; static HTML page (which is easily served by Apache) makes browser do most of the work (i.e. server doesn&#8217;t have to generate the pages) which frees up server to respond only to AJAX initiated requests.</p>

<p><a href="http://www.sproutcore.com" title="SproutCore - Javascript Framework written in Ruby">SproutCore</a> is written in Ruby, but once you build the app it will generate a set of HTML, JS and CSS files, so you don&#8217;t need to know Ruby in order to use it. As the site says:</p>

<blockquote>
<p>The code you write with SproutCore will resemble a desktop app written in Cocoa more than it will a web application written in Rails.</p>
</blockquote>

<p><img class="alignright size-full wp-image-6" title="SproutCore Photos Demo" src="http://icebergist.com/wp-content/uploads/2008/07/sprout-photos-demo.jpg" alt="SproutCore Photos Demo Screenshot" width="500" height="236" />
Another great thing about SproutCore is that it can be hooked up with any backend as long as it can communicate with it using HTTP. It can be anything: Rails, PHP, Perl, Java, ASP&#8230;</p>

<p>Actions speak louder than words, so take a look at the SproutCore demos which shows you exactly what it&#8217;s all about.</p>

<ul>
<li><a href="http://www.sproutcore.com/static/photos/" title="SproutCore demo photo gallery">SproutCore based photo gallery</a> &#8211; iPhoto anyone? <img src='http://icebergist.com/wp-includes/images/smilies/icon_smile.gif' alt=':)' class='wp-smiley' /></li>
<li><a href="http://www.sproutcore.com/static/sample_controls/" title="SproutCore demo sample controls">SproutCore sample controls</a> &#8211; demonstrates what kind of controls are already available in SproutCore.</li>
</ul>

<p>In next few days I will try to build a sample application powered by SproutCore and Rails to see how it goes. I will post my impressions here. After all if it&#8217;s something Apple used for Mobile.me &#8211; well, it can&#8217;t be that bad. <img src='http://icebergist.com/wp-includes/images/smilies/icon_wink.gif' alt=';)' class='wp-smiley' /></p>

        
          <h1><a href="http://blog.orangeiceberg.com/posts/so-it-begins">So it begins&amp;#8230;</a></h1>
          <h2>Tue, Jun 24, 2008</h2>
          <p>Welcome to an icebergist blog. The Icebergist will be a blog about both technical and business stuff I deal with daily. From Ruby on Rails programming to time organizing, everything that’s important in my daily work as a freelance developer.</p>

<p>As you can see I just setup the Icebergist blog, so at the moment it&#8217;s content-free. While I write some posts you can checkout <a href="http://www.google.com/search?hl=en&amp;rlz=1B3GGGL_enYU233YU234&amp;q=%22Posted+by+Slobodan+Kovacevic%22+site%3Aarraystudio.com+inurl%3Ahtml&amp;btnG=Search" title="Slobodan Kovacevic's blog posts in AS Workshop">my posts from my previous blog AS Workshop</a>.</p>

<p>Also I maintain a tumble log called &ldquo;<a href="http://tumblelog.slobodankovacevic.com/" title="Tumblelog by Slobodan Kovacevic">this should be interesting</a>&rdquo; where I post small bits of information which I find useful or interesting.</p>

<p>If that&#8217;s not enough for you then check out my <a href="http://twitter.com/thebasti" title="Slobodan Kovacevic's Twitter feed">Twitter feed</a> where I ramble daily (unless I am to lazy or too busy to do so).</p>

        
      </div>
    </div>
  </div>
  <nav class="navbar navbar-default" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <h1>
              <a href="http://blog.orangeiceberg.com//">Icebergist</a>
              
                <small>Exploring hidden depths of web development</small>
              
            </h1>
        </div>

        <div class="navbar-collapse collapse">
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a class="subscribe-rss" href="http://feeds.feedburner.com/icebergist" title="subscribe via RSS">
                        <span class="visible-xs">RSS</span>
                        <img class="hidden-xs" src="http://blog.orangeiceberg.com//images/rss.png" alt="RSS">
                    </a>
                </li>
                
            </ul>
            
                <form class="search navbar-form navbar-right" action="http://google.com/search" method="GET">
                    <input type="hidden" name="q" value="site:http://blog.orangeiceberg.com/">
                    <div class="form-group">
                        <input class="form-control" type="text" name="q" placeholder="Search">
                    </div>
                </form>
            
        </div>
    </div>
</nav>

  
    <h1><a href="http://blog.orangeiceberg.com/posts/rake-dbschemaload-vs-rake-dbmigrate">rake db:schema:load vs rake db:migrate</a></h1>
    

<p>Sooner or later every new Ruby developer needs to understand  differences between this two common rake tasks. Basically, these simple definition tells us everything we need to know:</p>

<ul>
<li><code>rake db:migrate</code> runs migrations that have not run yet</li>
<li><code>rake db:schema:load</code> loads the schema.db file into database.</li>
</ul>

<p>but the real question is when to use one or the other.</p>

<p><strong>Advice:</strong> <a id="advice"></a> when you are adding a new migration to an existing app then you need to run <code>rake db:migrate</code>, but when you join to existing application (<em>especially some old application</em>), or when you drop your applications database and you need to create it again, always run <code>rake db:schema:load</code> to load schema.</p>

<h3 id="example:bb0863f1c1f426893f44d7c5e616b367">Example</h3>

<p>I am working on application which use <a href="https://github.com/globalize/globalize">globalize gem</a> for ActiveRecord model/data translations. Globalize work this way:</p>

<ul>
<li>first specify attributes which need to be translatable</li>
</ul>

<pre><code class="language-ruby">class Post &lt; ActiveRecord::Base
  translates :title, :text
end
</code></pre>

<ul>
<li>then create translation tables</li>
</ul>

<pre><code>class CreatePosts &lt; ActiveRecord::Migration
  def up
    create_table :posts do |t|
      t.timestamps
    end
    Post.create_translation_table! title: :string, text: :text
  end
  def down
    drop_table :posts
    Post.drop_translation_table!
  end
end
</code></pre>

<p><strong>Note</strong> <em>that the ActiveRecord model Post must already exist and have listed attributes for translations</em>.</p>

<ul>
<li>and run <code>rake db:migrate</code> .</li>
</ul>

<p>Problem comes when you change your mind and decide to leave title to be untranslatable.</p>

<ul>
<li>remove title from post translations table</li>
</ul>

<pre><code>class RemoveTitleFromPostTranslations &lt; ActiveRecord::Migration
  def up
    remove_column :post_translations, :title, :string
  end

  def down
    Entry.add_translation_fields! title: :string
  end
end
</code></pre>

<ul>
<li>add title to posts table</li>
</ul>

<pre><code>class AddTitleToPosts &lt; ActiveRecord::Migration
  def change
    add_column :posts, :title, :string
  end
end
</code></pre>

<ul>
<li>remove title attribute from model translations</li>
</ul>

<pre><code>class Post &lt; ActiveRecord::Base
  translates :text
end
</code></pre>

<ul>
<li>and run <code>rake db:migrate</code>.</li>
</ul>

<p>Everything looking good, so where is the problem?</p>

<p>Here it is! If you decide to delete your database and create it again you need to use:</p>

<ul>
<li><code>rake db:drop</code></li>
<li><code>rake db:create</code></li>
<li><code>rake db:schema:load</code></li>
</ul>

<p>Because, if you try to use <code>rake db:migrate</code> instead of <code>rake db:schema:load</code> you will get <strong>BIG ERROR!</strong>, because for your first migration &ldquo;create_posts&rdquo; it is necessary that you have defined translatable attributes :title and :text in Post model, but you removed :title from Post model translations.</p>

<p>So just follow <a href="#advice">advice</a> above, and good luck.</p>

  
    <h1><a href="http://blog.orangeiceberg.com/posts/headless-firefox-in-ubuntu-on-virtualbox-for-cucumber-testing">Headless Firefox in Ubuntu on VirtualBox for Cucumber testing</a></h1>
    

<p>If you use <a href="http://www.vagrantup.com/downloads.html">Vagrant</a>, <a href="https://www.virtualbox.org/">VirtualBox</a> and Ubuntu to build your Rails apps and you want to test it with Cucumber scenarios, this is the right post for you. By default Vagrant and VirtualBox use Ubuntu without an X server and GUI.</p>

<p>Everything goes well until you need <code>@javascript</code> flag for your cucumber scenario. <code>@javascript</code> uses a javascript-aware system to process web requests (e.g. Selenium) instead of the default (non-javascript-aware) webrat browser.</p>

<h3 id="install-mozilla-firefox:e440c2a4f60085f5f973ab25c52a888b">Install Mozilla Firefox</h3>

<p>Selenium WebDriver is flexible and lets you run selenium headless in servers with no display. But in order to run, Selenium needs to launch a browser. If there is no display to the machine, the browsers are not launched. So in order to use selenium, you need to fake a display and let selenium and the browser think they are running in a machine with a display.</p>

<p>Install latest version of Mozilla Firefox:</p>

<p><code>sudo apt-get install firefox</code></p>

<p>Since Ubuntu is running without a X server Selenium cannot start Firefox because it requires an X server.</p>

<h3 id="setting-up-virtual-x-server:e440c2a4f60085f5f973ab25c52a888b">Setting up virtual X server</h3>

<p>Virtual X server is required to make browsers run normally by making them believe there is a display available, although it doesn&rsquo;t create any visible windows.</p>

<p>Xvfb (X Virtual FrameBuffer) works fine for this. Xvfb lets you run X-Server in machines with no display devices.</p>

<p>Install xvfb on ubuntu:</p>

<p><code>sudo apt-get install xvfb</code></p>

<p>Lets run the Xvfb service in a display number which is less likely to clash even if you add a display at a later stage. Display 10 will do fine.</p>

<p><code>sudo Xvfb :10 -ac</code></p>

<p>The parameter -ac makes xvfb run with access control off. The server should be running now.</p>

<h3 id="headless-firefox:e440c2a4f60085f5f973ab25c52a888b">Headless Firefox</h3>

<p>Before you can run a browser, you need to set the environment variable DISPLAY with the display number at which xvfb is running.</p>

<p>Open new tab in terminal and set the DISPLAY variable:</p>

<p><code>export DISPLAY=:10</code></p>

<p>and start mozilla firefox:</p>

<p><code>firefox</code></p>

<p>Now you run firefox headlessly in Ubuntu, and you can run your cucumber scenarios with <code>@javascript</code> flag.</p>

<h3 id="start-virtual-x-server-automatically:e440c2a4f60085f5f973ab25c52a888b">Start virtual X server automatically</h3>

<p>To run your X server automatically, after installing Xvfb, you will need to:</p>

<ul>
<li>put content of <a href="https://gist.github.com/basti/2db0b71e893ee4d6d015">this gist</a> in <code>/etc/init.d/xvfb</code> (hint use <code>sudo wget</code> command to do that)</li>
<li>make it executable <code>sudo chmod a+x /etc/init.d/xvfb</code></li>
<li>start xvfb on display number 10 <code>export DISPLAY=:10</code></li>
<li>run X server <code>sudo /etc/init.d/xvfb start</code></li>
<li>when you want to stop X server <code>sudo /etc/init.d/xvfb stop</code></li>
</ul>

<p>This is my way to run firefox headlessly in Virtual box Ubuntu, and to run cucumber scenarios with <code>@javascript</code> flag.</p>

<p>References:</p>

<ul>
<li><a href="http://www.installationpage.com/selenium/how-to-run-selenium-headless-firefox-in-ubuntu/">Selenium Headless Automated Testing in Ubuntu</a></li>
<li><a href="https://gist.github.com/jterrace/2911875">Xvfb init script for Ubuntu</a></li>
</ul>

  
    <h1><a href="http://blog.orangeiceberg.com/posts/import-and-export-mysql-dump">Import and export MySQL dump</a></h1>
    <p>Another simple task that&rsquo;s often hard for beginners is importing and exporting MySQL dumps. Here is quick rundown on how to do it.</p>

<p>To export data you need to use <code>mysqldump</code>:</p>

<pre><code class="language-sh">mysqldump -u db_user -p db_name &gt; dump_name.sql
</code></pre>

<p>Options given to <code>mysqldump</code> are:</p>

<ul>
<li><code>-u db_user</code> - connect as user <code>db_user</code> to database</li>
<li><code>-p</code> - use password, it will ask you to enter your password</li>
<li><code>db_name</code> is the name of MySQL database you want to dump</li>
<li><code>&gt; dump_name.sql</code> - by default <code>mysqldump</code> will print out the dump to terminal, but simple output redirect with <code>&gt;</code> will instead write it to given filename, in this case <code>dump_name.sql</code></li>
</ul>

<p>Now that you have <code>dump_name.sql</code> file with all SQL queries needed to replicate your database you can import it using general-purpose <code>mysql</code> client:</p>

<pre><code class="language-sh">mysql -u db_user -p db_name &lt; dump_name.sql
</code></pre>

<p>User, password, and database name options are the same as for <code>mysqldump</code>. Since <code>mysql</code> reads input from terminal this time we can use <code>&lt;</code> to read input from given file instead.</p>

<p>As always for more information you can consult manual using <code>man mysqldump</code> and <code>man mysql</code>.</p>

  
    <h1><a href="http://blog.orangeiceberg.com/posts/create-and-extract-archives-using-tar-and-gzip">Create and extract archives using tar and gzip</a></h1>
    <p>One of the simplest tasks is creating and extracting files using <code>tar</code> and <code>gzip</code>. Yet for most new developers this is a daunting task. These days <code>tar</code> is mostly used to simply combine a few files into a single file and then <code>gzip</code> is used to compress that file.</p>

<p>Here is a quick overview how to use <code>tar</code> and <code>gzip</code> to create and compress an archive:</p>

<pre><code class="language-sh"># archive individual files
tar -cvzf myarchive.tar.gz /path/to/file1 /path/to/file2

# archive whole directory
tar -cvzf myarchive.tar.gz /path/to/dir

# archive whole directory but don't store full path
tar -cvzf myarchive.tar.gz -C /path/to/dir ./
</code></pre>

<p>Options give to tar are: <code>c</code> to create new archive, <code>v</code> to be verbose, <code>z</code> to compress resulting archive with <code>gzip</code>, and <code>f</code> to write the archive to specified file. After options you can list files and dirs you want to archive.</p>

<p>In all examples we provide a full path to a file or dir we want to archive. In this case <code>tar</code> will store files in the archive using the full path. This means once you extract the files you&rsquo;ll have a complete directory structure from root dir onwards.</p>

<p>The way to avoid this is either to manually <code>cd</code> to dir in which files are stored, or to tell <code>tar</code> using <code>C</code> option to change dir before archiving files.</p>

<p>Finally to extract an archive:</p>

<pre><code class="language-sh">tar -xvzf myarchive.tar.gz
</code></pre>

<p>The <code>x</code> option tells <code>tar</code> to extract the archive into current directory.</p>

<p>For more information you can consult manual using <code>man tar</code>.</p>

  
    <h1><a href="http://blog.orangeiceberg.com/posts/creating-and-publishing-a-ruby-gem">Creating and publishing a ruby gem</a></h1>
    

<p>A gem is a simple way to distribute functionality, it can be a small plugin, a Ruby library or sometimes a whole program. Thanks to RubyGems, a gem hosting service, developers have a wide range of gems at their disposal allowing them to easily add functionality to their applications.</p>

<p>But what if there is no gem available that will suit the functionality you need, and you find yourself writing the same code over and over again for different projects? Well, in that case you should consider making your own gem.</p>

<p>It&rsquo;s considered a good practice to extract a gem out of an existing application, since that way you will have a better understanding of all the requirements as well as how the gem will be used. This blog post will illustrate just that on a real life example, and will take you through the process of creating a slug_converter gem.</p>

<h3 id="slug-converter-gem:26b86b95592661b7092ab782e8d51bcd">Slug converter gem</h3>

<p>Source code for slug_converter gem was developed while working on a link shortener application, in order to generate a string consisting of predefined characters, based on a given id number of a link. As it will be described in this blog post, this code was easily extracted from the application into an independent gem that was released on  RubyGems.</p>

<p>Although it may seem like a complex task at first, creating a gem is not that difficult, if you have RubyGems and Bundler installed you are good to go. We already know what RubyGems is, and Bundler is a package manager that determines a full set of direct dependencies needed by your application.</p>

<p>Now let&rsquo;s build a gem!</p>

<h3 id="creating-a-gem:26b86b95592661b7092ab782e8d51bcd">Creating a gem</h3>

<p>First step is to make sure that bundler gem is installed.</p>

<pre><code class="language-sh">$ gem install bundler
</code></pre>

<p>once bundler is installed creating a structure for your new gem is easy,</p>

<pre><code class="language-sh">	$ bundle gem slug_converter
</code></pre>

<p>The first time you use bundler to create a gem you will be prompted to answer a couple of questions:</p>

<pre><code class="language-sh">	Do you want to include code of conduct in your gems you generate?
	Do you want to licence your code permissively under the MIT licence?
	Do you want to generate tests with your gem? 
	Type rspec or minitest to generate those tests files now and in the future:
</code></pre>

<p>Answering these questions will help bundler configure and setup files that are being generated now and in the future. Here we answered yes to first 4 qestions and choose rspec for testing.</p>

<p>Running <code>$ bundle gem slug_converter</code> command resulted with &ldquo;slug_converter&rdquo; directory with essential gem file structure being created, and git repository initialized, assuming that you are using git for version management (as you should).</p>

<pre><code class="language-sh">Creating gem 'slug_converter'...
 create  slug_converter/Gemfile
 create  slug_converter/.gitignore
 create  slug_converter/lib/slug_converter.rb
 create  slug_converter/lib/slug_converter/version.rb
 create  slug_converter/slug_converter.gemspec
 create  slug_converter/Rakefile
 create  slug_converter/README.md
 create  slug_converter/bin/console
 create  slug_converter/bin/setup
 create  slug_converter/LICENSE.txt
 create  slug_converter/.travis.yml
 create  slug_converter/.rspec
 create  slug_converter/spec/spec_helper.rb
 create  slug_converter/spec/slug_converter_spec.rb
</code></pre>

<p>Let&rsquo;s go through files that bundler generated for us, .gemspec file is the &ldquo;heart&rdquo; of your gem so lets start with <code>slug_converter.gemspec</code></p>

<pre><code class="language-ruby">lib = File.expand_path('../lib', __FILE__)
$LOAD_PATH.unshift(lib) unless $LOAD_PATH.include?(lib)
require 'slug_converter/version'

Gem::Specification.new do |spec|
  spec.name         = &quot;slug_converter&quot;
  spec.version      = SlugConverter::VERSION
  spec.authors      = [&quot;Your Name&quot;]
  spec.email        = [&quot;youremail@example.com&quot;]

  # if spec.respond_to?(:metadata)
  #   spec.metadata['allowed_push_host'] = &quot;TODO: Set to 'http://mygemserver.com' to prevent pushes to rubygems.org, or delete to allow pushes to any server.&quot;
  # end

  spec.summary      = %q{Number &lt;-&gt; Slug converter}
  spec.description  = %q{Generates a slug based on the given number and the other way around}
  spec.homepage     = &quot;https://github.com/orangeiceberg/slug_converter&quot;
  spec.license      = &quot;MIT&quot;

  spec.files        = `git ls-files -z`.split(&quot;\x0&quot;).reject { |f| f.match(%r{^(test|spec|features)/}) }
  spec.bindir       = &quot;exe&quot;
  spec.executables  = spec.files.grep(%r{^exe/}) { |f| File.basename(f) }
  spec.require_paths= [&quot;lib&quot;]

  spec.add_development_dependency &quot;bundler&quot;, &quot;~&gt; 1.8&quot;
  spec.add_development_dependency &quot;rake&quot;, &quot;~&gt; 10.0&quot;
end
</code></pre>

<p>This file contains metadata about your gem and it can be populated directly, so here you can enter all the data such as name, description, licence&hellip; This file also contains information about what files should be packaged in your gem, as well as the load path to include the gem directory when the gem is first loaded. Most of these default settings will work for the majority of gems but you can always edit them if you want different behavior. At the bottom of the file add any gem dependencies that are required.</p>

<p>The version number of the gem is set in <code>SlugConverter::VERSION</code> constant which is kept in a separate version.rb file, and you can change it there for every new version of your gem.</p>

<pre><code>lib
 |--slug_converter
         |--version.rb
</code></pre>

<p>A very important part of every gem is the <code>README</code> file, where you can describe how to install and use the gem, and the <code>LICENCE</code> file where you can define the terms and conditions under which the gem can be used.</p>

<p>In the lib directory there is a file which has the same name as your gem (recommended), and that file will be loaded when someone requires your gem. If the gem you are writing is simple all the code can be placed in this single file, or in case of more complex gems all the other files from the lib directory are required in this file.</p>

<p>There is also a <code>Gemfile</code> generated, but this file doesn&rsquo;t have to be managed directly since all it does is look in <code>.gemspec</code> for required dependencies and then loads them through bundler. All the dependencies required by the gem should be specified in the <code>.gemspec</code> file.</p>

<p>Another file that is generated by the bundler is <code>Rakefile</code> which just adds some gem tasks from bundler, and we can see those tasks with explanation by running</p>

<pre><code class="language-sh">	rake -T
	rake build    # Build slug_converter-0.0.1.gem into the pkg directory
	rake install  # Build and install slug_converter-0.0.1.gem into system gems
	rake release  # Create tag v0.0.1 and build and push slug_converter-0.1.0.gem to Rubygems
</code></pre>

<h3 id="writing-tests:26b86b95592661b7092ab782e8d51bcd">Writing tests</h3>

<p>If you are following the principles of Test Driven Development you will probably like to start by writing tests for you gem, for that purpose I would suggest using RSpec.
To do that you will need to add rspec as a development dependency to you gemspec file:
    spec.add_development_dependency &lsquo;rspec&rsquo;</p>

<p>As mentioned in the beginning, when running bundle gem for the first time, bundler will asks if you would like to generate test files for your gem and to choose if you want to use rspec or minitest. If you answer with yes, and choose rspec, bundler will generate a spec directory with two files:</p>

<pre><code>|-- spec
      |-- slug_converter_spec.rb
      |-- spec_helper.rb
</code></pre>

<p>In the <code>spec_helper.rb</code> file you can reference any test globals or configuration.</p>

<p>Since we are extracting code from an existing application we already have all the tests written so we just need to copy them into the generated <code>spec/slug_converter_spec.rb</code> file.</p>

<pre><code class="language-ruby">require 'spec_helper'
describe SlugConverter do
  it 'has a version number' do
    expect(SlugConverter::VERSION).not_to be nil
  end
  describe &quot;.number&quot; do
  
    it &quot;returns number when number is set&quot; do
      converted_slug= SlugConverter.new(111)
      expect(converted_slug.number).to eq(111)
    end
    
    it &quot;returns decoded number for existing slug&quot; do
      converted_slug = SlugConverter.new(&quot;vg&quot;)
      expect(converted_slug.number).to eq(363)
    end
    
  end
  
  describe &quot;.number&quot; do
  
    it &quot;sets number to given value&quot; do
      converted_slug = SlugConverter.new(211)
      expect(converted_slug.number=210).to eq(210)
    end
    
    it &quot;sets slug to encoded value of number&quot; do
      converted_slug = SlugConverter.new(211)
      converted_slug.number=210
      expect(converted_slug.slug).to eq(&quot;pb&quot;)
    end
    
    it &quot;sets number to integer value of given number passed as string&quot; do
      converted_slug = SlugConverter.new(&quot;210&quot;)
      expect(converted_slug.number).to eq(210)
    end
    
    it &quot;sets slug to encoded value of given number passed as string&quot; do
      converted_slug = SlugConverter.new(&quot;210&quot;)
      expect(converted_slug.slug).to eq(&quot;pb&quot;)
    end
    
    it &quot;sets number to integer value of argument that starts with a number but also contains letters&quot; do
      converted_slug = SlugConverter.new(&quot;210jj&quot;)
      expect(converted_slug.number).to eq(210)
    end
    
    it &quot;sets slug to encoded value of argument that starts with a number but also contains letters&quot; do
      converted_slug = SlugConverter.new(&quot;210jj&quot;)
      expect(converted_slug.slug).to eq(&quot;pb&quot;)
    end
    
  end
  
  describe &quot;.slug&quot; do
  
     it &quot;returns slug when slug is set&quot; do
        converted_slug = SlugConverter.new(&quot;hy&quot;)
        expect(converted_slug.slug).to eq(&quot;hy&quot;)
     end
     
     it &quot;returns encoded slug when link id is set&quot; do
        converted_id = SlugConverter.new(113)
        expect(converted_id.slug).to eq(&quot;hy&quot;)
     end
     
  end
  
  describe &quot;.slug&quot; do
  
    it &quot;sets slug to given value&quot; do
      converted_slug = SlugConverter.new(&quot;ezk&quot;)
      expect(converted_slug.slug=(&quot;ebk&quot;)).to eq(&quot;ebk&quot;)
    end
    
    it &quot;sets number to decoded value of slug&quot; do
      converted_slug = SlugConverter.new(&quot;pb&quot;)
      converted_slug.slug=(&quot;ezk&quot;)
      expect(converted_slug.number).to eq(1483)
    end
    
    it &quot;raises Arrgument Error exception if given value is an empty string&quot; do
      expect { SlugConverter.new(&quot;&quot;) }.to raise_error(ArgumentError)
    end
    
    it &quot;raises Arrgument Error exception if given value is nil&quot; do
      expect { SlugConverter.new(nil) }.to raise_error(ArgumentError)
    end
    
    it &quot;raises Arrgument Error exception if given value contains unpermitted letters&quot; do
      expect { SlugConverter.new(&quot;iiii&quot;) }.to raise_error(ArgumentError)
    end
    
    it &quot;raises Arrgument Error exception if given value starts with letter but contains numbers&quot; do
      expect { SlugConverter.new(&quot;bb12&quot;) }.to raise_error(ArgumentError)
    end
    
  end
end
</code></pre>

<p>To make rspec rake task available we will setup tasks folder where we&rsquo;ll place our <code>rspec.rake</code> file containing only 2 lines:</p>

<pre><code class="language-ruby">	require 'rspec/core/rake_task'
	RSpec::Core::RakeTask.new(:spec)
</code></pre>

<p>and then we will import this file in our Rakefile that bundler provided automatically:</p>

<pre><code class="language-ruby">	Dir.glob('tasks/**/*.rake').each(&amp;method(:import))
</code></pre>

<p>Now run:</p>

<pre><code class="language-sh">bundle exec rake spec 
</code></pre>

<p>And watch your tests fail. :)</p>

<h3 id="add-gem-functionality:26b86b95592661b7092ab782e8d51bcd">Add gem functionality</h3>

<p>Now we need to make those test go green. To do that we will again copy the existing code from our application in the main gem file <code>lib/slug_converter.rb</code>:</p>

<pre><code class="language-ruby">require &quot;slug_converter/version&quot;
require 'set'
require 'gem_config'

class SlugConverter
  include GemConfig::Base
  with_configuration do
    has :alphabet, default: &quot;qjeghxtrpnfmdzwvsybkuoca&quot;
  end

  def initialize(number_or_slug)
     @alphabet = SlugConverter.configuration.alphabet.split(//)
    if number_or_slug.to_i != 0
      @number = number_or_slug.to_i
    elsif validate_string(number_or_slug)
      @slug = number_or_slug.downcase
    else
      raise ArgumentError, 'Argument must be integer value or non-empty string consisting of predefined letters'
    end
  end
  
  def number
    if @number.nil?
      @number = bijective_decode
    else
      @number
    end
  end
  
  def number=(new_number)
    @number = new_number
    @slug = bijective_encode
    @number
  end
  
  def slug
    if @slug.nil?
      @slug = bijective_encode
    else
      @slug
    end
  end
  
  def slug=(new_slug)
    @slug = new_slug
    @number = bijective_decode
    @slug
  end

  private
  
    def bijective_encode
      id = @number
      return @alphabet[0] if id == 0
      s = ''
      base = @alphabet.length
      while id &gt; 0
        s &lt;&lt; @alphabet[id.modulo(base)]
        id /= base
      end
      s.reverse
    end
    
    def bijective_decode
      i = 0
      base = @alphabet.length
      @slug.each_char { |c| i = i * base + @alphabet.index(c) }
      i
    end
    
    def validate_string(slug)
      unless slug.nil?
        alphabet = Set.new @alphabet
        slug_letters = Set.new slug.downcase().split(//)
        slug != &quot;&quot; &amp;&amp; (slug_letters.subset? alphabet)
      end
    end
end
</code></pre>

<p>Now when we run the tests again, they should all pass.</p>

<p>###Making your gem configurabile</p>

<p>In order to allow users to set their own alphabet that will be used by the SlugConverter, we needed to make our gem configurabile. To do this we used <a href="https://github.com/krautcomputing/gem_config">https://github.com/krautcomputing/gem_config</a> gem.</p>

<p>You will notice this code at the begining of the SlugConverter class:</p>

<pre><code class="language-ruby">class SlugConverter
  include GemConfig::Base
  
  with_configuration do
    has :alphabet, default: &quot;qjeghxtrpnfmdzwvsybkuoca&quot;
  end

  def initialize(number_or_slug)
     @alphabet = SlugConverter.configuration.alphabet.split(//)
     # ...
  end	  
  
  # rest of the code omitted    
end
</code></pre>

<p>this code along with <code>spec.add_runtime_dependency 'gem_config'</code> added as a dependency in <code>slug_converter.gemspec</code> file, alows us to make the gem configureabile.</p>

<p>Custom aphabet can than be defined by adding <code>config/initializers/slug_converter.rb</code> to your application, and defining the alphabet like this:</p>

<pre><code class="language-ruby">SlugConverter.configuration.alphabet = &quot;your_custom_alphabet_here&quot;
</code></pre>

<h3 id="releasing-your-gem:26b86b95592661b7092ab782e8d51bcd">Releasing your gem</h3>

<p>Now that we have the test passing and all the code in place it&rsquo;s time to make the gem available for everyone to use by releasing it on RubyGems, to do that you will need to have a RubyGems account. If this is the first time you release a gem you will be prompted to enter your RubyGems username and password. You will also need to have your repository setup on Github.</p>

<p>Then with just one comand:</p>

<pre><code class="language-sh">	$ bundle exec rake release
</code></pre>

<ul>
<li>your code will be pushed to your Github repository,</li>
<li>your git repository will be tagged with the version number using a name like &ldquo;v1.0.0&rdquo;.</li>
<li>your gem released on RubyGems.</li>
</ul>

<p>The ruby gem described in this blog post can be found here <a href="https://rubygems.org/gems/slug_converter">https://rubygems.org/gems/slug_converter</a>, and all the code is in this GitHub repository <a href="https://github.com/orangeiceberg/slug_converter">https://github.com/orangeiceberg/slug_converter</a> .</p>

  
    <h1><a href="http://blog.orangeiceberg.com/posts/changing-database-starting-id">changing database starting id</a></h1>
    <p>For our new project it was necessary to modify the starting id of our database. This can be handled through migration for creating table but we decided to create a rake task that handled this for us.</p>

<p>The rake task that we created detects what database is being used and executes appropriate changes according to that.</p>

<p>You can create a rake task using rails generate command for rake task:</p>

<pre><code>rails g task namespace task_name
</code></pre>

<p>This will create your task in lib/tasks with chosen namespace and task name.</p>

<p>Here is our task and an explanation that follows.</p>

<pre><code class="language-ruby">namespace :database do
  desc &quot;Detect database that's being used and then increment its id&quot;
  task autoincrement: :environment do
  
    db_name_downcase = ActiveRecord::Base.connection.adapter_name.downcase

    if Link.maximum(:id).to_i &lt; 1000
      if db_name_downcase.start_with? &quot;mysql&quot;
        ActiveRecord::Base.connection.execute(&quot;ALTER TABLE links AUTO_INCREMENT = 1000&quot;)
      end
      if db_name_downcase.start_with? &quot;postgres&quot;
        ActiveRecord::Base.connection.execute(&quot;ALTER SEQUENCE links_id_seq START with 1000 RESTART;&quot;)
      end
      if db_name_downcase.start_with? &quot;sqlite&quot;
        ActiveRecord::Base.connection.execute(&quot;insert into sqlite_sequence(name,seq) values('links', 1000)&quot;)
      end
    else
      puts &quot;To perform this task your database shouldn't have records with id number higher than 1000&quot;
    end
    
  end
end
</code></pre>

<p>We need to change the starting id of our database to 1000 so we check that we don&rsquo;t have a record with id higher than 1000. Link is our Active Record model and links is the name of our table.</p>

<p>ActiveRecord::Base.connection returns the connection currently associated with the class. We use it to detect the name of database and execute appropriate changes.
###MySQL
For MySQL we need to set AUTO_INCREMENT value to 1000, Auto-increment allows a unique number to be generated when a new record is inserted into a table. When first record is created it sets its primary key to 1 by default  and it will auto increment by 1 for each new record.
###PostgreSQL
For Postgres we have to explain what a sequence is. A sequence is a special kind of a database object designed for generating unique numeric identifiers. It is typically used to generate artificial primary keys. Sequences are similar to the Auto-increment concept in MySQL.
###SQLite
For SQlite we altered sqlite_sequence table, which is an internal table used to implement AUTOINCREMENT. It is created automatically whenever any ordinary table with an AUTOINCREMENT integer primary key is created.</p>

<p>You can check <a href="http://stackoverflow.com/questions/2075331/change-starting-id-number">this Stack Overflow discussion</a> that was very helpful to me.</p>

  
    <h1><a href="http://blog.orangeiceberg.com/posts/customize-devise-permitted-parameters">Customize Devise permitted parameters</a></h1>
    <p>If you are using Devise gem for authentication and you have been adding custom fields to your model you’ll get in trouble when you try to create a new instance or update an existing one. All your added fields will be treated as unpermitted. The solution for this problem is to customise Devise’s configure_permited_parameters action. All you need to do is to add this action to your Application controller and push parameters that need to be permitted to devise_paremeter_sanitizer array. So let’s say you have a User Model and you have added company_name and website fields to your user’s table, to permit this parameters on sign_up you need to add this to your Application controller:</p>

<pre><code>def configure_permitted_parameters
  devise_parameter_sanitizer.for(:sign_up).push(:company_name, :website)
end
</code></pre>

<p>It is the same principle for the :sign_in and :edit_account. You can see what are <a href="https://github.com/plataformatec/devise/blob/master/lib/devise/parameter_sanitizer.rb#L83">default permitted parameters here</a>.</p>

  
    <h1><a href="http://blog.orangeiceberg.com/posts/how-to-skip-devise-trackable-updates">How to skip Devise trackable updates</a></h1>
    <p>Devise has a very useful Trackable module used to track user&rsquo;s sign in count, timestamps and IP address. There are some occasions when you need to disable tracking. For example for API requests where user signs in on every request; for instances where admin might sign in as an user; and similar.</p>

<p>To disable Devise Trackable module you need to set <code>request.env[&quot;devise.skip_trackable&quot;] = true</code>. You have to do that before trying to authenticate user, so you&rsquo;ll want to put it in a before_filter, or even better prepend_before_filter to make sure it&rsquo;s before authentication.</p>

<p>Add this to your controller in which you want to disable tracking:</p>

<pre><code>prepend_before_filter :disable_devise_trackable

protected
  def disable_devise_trackable
    request.env[&quot;devise.skip_trackable&quot;] = true
  end
</code></pre>

  
    <h1><a href="http://blog.orangeiceberg.com/posts/upgrade-ubuntu-8.04-lts-server">Upgrade Ubuntu 8.04 LTS server</a></h1>
    <p>Note to self: here is how to upgrade Ubuntu 8.04 LTS (or any other release that is no longer supported) to newer Ubuntu release.</p>

<p>When you are upgrading unsupported release of Ubuntu if you try to do the usual <code>sudo apt-get update</code> it will most likely fail because&hellip; well, it&rsquo;s unsupported. The simple fix for this is to change your <code>/etc/apt/sources.list</code> and replace repository URLs from something like <code>us.archive.ubuntu.com</code> to <code>old-releases.ubuntu.com</code>.</p>

<p>After that you should be able follow normal upgrade procedure (use sudo if you are not root):</p>

<pre><code class="language-sh">apt-get update
apt-get install update-manager-core
do-release-upgrade
</code></pre>

<p>References:</p>

<ul>
<li><a href="http://rimuhosting.com/knowledgebase/linux/distros/ubuntu" title="Rimuhosting's page on upgrading Ubuntu">Rimuhosting&rsquo;s page on upgrading Ubuntu</a></li>
<li><a href="http://askubuntu.com/questions/91815/how-to-install-software-or-upgrade-from-old-unsupported-release" title="Discussion on upgrading unsupported Ubuntu release">Discussion on upgrading unsupported Ubuntu release</a></li>
</ul>

  
    <h1><a href="http://blog.orangeiceberg.com/posts/quick-virtualbox/vagrant-setup-with-heroku-like-box">Quick VirtualBox/Vagrant setup with Heroku-like box</a></h1>
    <p>Here is a quick way to setup VirtualBox using Vagrant with Heroku-like box on Mac.</p>

<ol>
<li><p>Install VirtualBox from <a href="https://www.virtualbox.org/wiki/Downloads" target="_blank"><a href="https://www.virtualbox.org/wiki/Downloads">https://www.virtualbox.org/wiki/Downloads</a></a></p></li>

<li><p>Install Vagrant from <a href="http://downloads.vagrantup.com/" target="_blank"><a href="http://downloads.vagrantup.com/">http://downloads.vagrantup.com/</a></a></p></li>

<li><p>Create Vagrantfile for Heroku-like box (based on <a href="https://github.com/ejholmes/vagrant-heroku" target="_blank"><a href="https://github.com/ejholmes/vagrant-heroku">https://github.com/ejholmes/vagrant-heroku</a></a>) that looks something like:</p></li>
</ol>

<pre><code class="language-ruby">        Vagrant.configure(&quot;2&quot;) do |config|        
	        config.vm.box = &quot;heroku&quot;
	        config.vm.box_url = &quot;https://dl.dropboxusercontent.com/s/rnc0p8zl91borei/heroku.box&quot;
          config.vm.synced_folder &quot;.&quot;, &quot;/vagrant&quot;, :nfs =&gt; true
	        config.vm.network :private_network, ip: &quot;192.168.1.42&quot;  # required for NFS
        end
</code></pre>

<p>Beside telling Vagrant to use Heroku-like box from <a href="https://github.com/ejholmes/vagrant-heroku" target="_blank"><a href="https://github.com/ejholmes/vagrant-heroku">https://github.com/ejholmes/vagrant-heroku</a></a> it also sets up shared dir between host and VM machine. It will mount Vagrantfile dir (.) to /vagrant in VM.</p>

<p><code>vagrant up</code> will setup the VM and start it up.</p>

<p>Now you can use <code>vagrant ssh</code> to login to VM.</p>

<p>Vagrant Heroku-like box comes with Postgresql, but if you want you can easily setup sqlite:</p>

<pre><code class="language-sh">sudo apt-get install libsqlite3-dev
</code></pre>

<p><strong>Bonus tip</strong>: when you are working on multiple projects sometimes you can forget which VMs are running. You can list all running VMs using:</p>

<pre><code class="language-sh">VBoxManage list runningvms
</code></pre>

<p>Further reading:</p>

<ul>
<li><a href="http://docs.vagrantup.com/v2/" target="_blank">Vagrant docs</a></li>
<li><a href="https://github.com/ejholmes/vagrant-heroku" target="_blank">Vagrant Heroku-like box</a> which can be easily customized.</li>
<li><a href="http://loudcoding.com/posts/how-to-use-vagrant-to-run-celadon-cedar-stack-on-heroku/" target="_blank">Another Vagrant setup tutorial</a></li>
<li><a href="https://www.stackmachine.com/blog/web-development-on-a-vm-is-it-slower" target="_blank">VM speed benchmarks</a> in case you doubt in VM speed.</li>
</ul>

  
    <h1><a href="http://blog.orangeiceberg.com/posts/railsdiff">RailsDiff</a></h1>
    <p><a title="RailsDiff - compare Rails default app" href="http://railsdiff.org/" target="_blank">RailsDiff</a>
is a very useful site when upgrading Rails versions (for example, from Rails 3.2 to Rails 4). It will generate default Rails app using two different Rails versions and it will compare them. The result is that you can see all the configuration changes (like in application.rb) and all other changes &#8211; which is really useful when upgrading to new Rails version.</p>

  
    <h1><a href="http://blog.orangeiceberg.com/posts/rspec-and-factorygirl-setup-for-testing-carrierwave-uploaders">RSpec and FactoryGirl setup for testing Carrierwave uploaders</a></h1>
    

<p>Assume that you have the usual setup with model (MyFile) using simple Carrierwave uploader (MyFileUploader):</p>

<pre># app/models/my_file.rb
class MyFile &lt; ActiveRecord::Base
  mount_uploader :file, MyFileUploader
end</pre>

<p>To be able to test Carrierwave uploaders with RSpec using FactoryGirl factories you need:</p>

<ul>
<li><span style="line-height: 13px;">define factory with uploaded file</span></li>
<li>modify test environment storage so test file uploads are separated from other uploads</li>
<li>turn off image processing to speed up tests</li>
<li>perform cleanup after each test</li>
</ul>

<h2 id="define-factory:f55ec0979c7942ed3400c6817da421f3">Define factory</h2>

<pre># spec/factories/my_files.rb
FactoryGirl.define do
 factory :my_file do
   photo Rack::Test::UploadedFile.new(File.open(File.join(Rails.root, '/spec/fixtures/myfiles/myfile.jpg')))
 end
end</pre>

<h2 id="setup-carrierwave:f55ec0979c7942ed3400c6817da421f3">Setup Carrierwave</h2>

<p>First we need to make sure Carrierwave is using local file system for storage and to disable file processing for testing environments. Disabling file processing will speed up tests considerably. We can do that by adding following to Carrierwave initializer:</p>

<pre>if Rails.env.test? || Rails.env.cucumber?
  CarrierWave.configure do |config|
    config.storage = :file
    config.enable_processing = false
  end
end</pre>

<p>Next we should separate test uploads from any other uploads. We can do that by modifying cache_dir and store_dir methods for all Carrierwave models (i.e. all models that are descendants of CarrierWave::Uploader::Base). So the whole Carrierwave initializer looks something like:</p>

<pre># config/initializers/carrierwave.rb
if Rails.env.test? || Rails.env.cucumber?
  CarrierWave.configure do |config|
    config.storage = :file
    config.enable_processing = false
  end

  # make sure our uploader is auto-loaded
  MyFileUploader

  # use different dirs when testing
  CarrierWave::Uploader::Base.descendants.each do |klass|
    next if klass.anonymous?
    klass.class_eval do
      def cache_dir
        "#{Rails.root}/spec/support/uploads/tmp"
      end

      def store_dir
        "#{Rails.root}/spec/support/uploads/#{model.class.to_s.underscore}/#{mounted_as}/#{model.id}"
      end
    end
  end
end</pre>

<h2 id="clean-up-uploaded-files:f55ec0979c7942ed3400c6817da421f3">Clean up uploaded files</h2>

<p>Using factory defined above will create uploaded files in cache_dir and store_dir. These are just temporary files and should be removed after each test, so each of them has a clean slate. By adding after :each hook in RSpec configuration block we can remove these files simply by deleting spec/support/uploads dir.</p>

<pre># spec_helper.rb
RSpec.configure do |config|
  config.after(:each) do
    if Rails.env.test? || Rails.env.cucumber?
      FileUtils.rm_rf(Dir["#{Rails.root}/spec/support/uploads"])
    end 
  end
end</pre>

  
    <h1><a href="http://blog.orangeiceberg.com/posts/random-rails-tips">Random Rails tips</a></h1>
    <p>Here are some random Rails tips I&#8217;ve found useful:</p>

<ul>
<li><strong>rails console sandbox</strong> &#8211; if you open console like this it will rollback all database changes once you exit. Pretty useful for playing around without making any changes to database.</li>
<li><strong>rake db:migrate:status</strong> &#8211; useful when you want to see the status of current database. It will show the status of all migrations.</li>
<li><strong>User.pluck(:email)</strong> &#8211; since Rails 3.2.1 you can use [pluck][1] method to get an array of values in one particular column. It&#8217;s the equvivalent of doing User.select(:email).map(&amp;:email)</li>
</ul>

<p>[1]: <a href="http://apidock.com/rails/ActiveRecord/Calculations/pluck">http://apidock.com/rails/ActiveRecord/Calculations/pluck</a></p>

  
    <h1><a href="http://blog.orangeiceberg.com/posts/paperclip-heroku-and-amazon-s3-credentials">Paperclip, Heroku and Amazon S3 credentials</a></h1>
    <p>Setting up Paperclip to use Amazon&#8217;s S3 is as simple as setting :storage =&gt; :s3 and providing right credentials to Paperclip by setting :s3_credentials option. Best way to provide S3 credentials is to use an YML file (usually config/s3.yml) which allows you to set different credentials for each environment. For example:</p>

<pre># config/s3.yml
development:
  access_key_id: XYZXYZXYZ
  secret_access_key: XYZXYZXYZ
  bucket: mygreatapp-development
production:
  access_key_id: XYZXYZXYZ
  secret_access_key: XYZXYZXYZ
  bucket: mygreatapp-production
</pre>

<p>Of course you want to treat s3.yml same as database.yml &#8211; i.e. you don&#8217;t want to track it with git and you want for each person/server to have it&#8217;s own.</p>

<p>However, consider this: you are working on Open Source app in a public git repository and you are deploying it on Heroku. Heroku doesn&#8217;t allow you to create files (unless they are in git repository) and you can&#8217;t commit s3.yml with your credentials to public repository.</p>

<p>One solution is to define different :s3_credentials hash in one of the environment files or to load different YML file for each environment and generate hash from it. Downside is that you need to have a separate YML file for each environment and/or you need to convert YML to hash. Other solution could be to have separate local branch from which you will push to Heroku. Problem with this is that you have to have a local branch for deploying. This means if there are multiple developers who deploy to production each should have separate local branch.</p>

<p>Much simpler way to deploy Paperclip with different S3 credentials for each environment (with one of the environment being deployed on Heroku; and repository being public) is to create s3.yml file as usual (and don&#8217;t commit it to git), but define values only for local environment.</p>

<p>For production deployment on Heroku you can write initializer which will set :s3_credentials from ENV variables.</p>

<pre># initializers/s3.rb
if Rails.env == "production"
  # set credentials from ENV hash
  S3_CREDENTIALS = { :access_key_id => ENV['S3_KEY'], :secret_access_key => ENV['S3_SECRET'], :bucket => "sharedearth-production"}
else
  # get credentials from YML file
  S3_CREDENTIALS = Rails.root.join("config/s3.yml")
end

# in your model
has_attached_file :photo, :storage => :s3, :s3_credentials => S3_CREDENTIALS
</pre>

<p>and you can easily set persistant ENV vars on Heroku with:</p>

<pre>$ heroku config:add S3_KEY=XYZXYZ S3_SECRET=XYZXYZ
</pre>

<p>(<a href="http://docs.heroku.com/config-vars#quick-example">according to Heroku docs</a>)</p>

  
    <h1><a href="http://blog.orangeiceberg.com/posts/rails-3-reading-list">Rails 3 reading list</a></h1>
    <p>I&#8217;ve been planning to catchup with all the new Rails 3 stuff. To get me started I&#8217;ve compiled a small Rails 3 related reading list.</p>

<ol>
<li><a href="http://guides.rails.info/3_0_release_notes.html">Ruby on Rails 3.0 Release Notes</a></li>
<li><a href="http://m.onkey.org/2010/1/22/active-record-query-interface">Active Record Query Interface 3.0</a></li>
<li><a href="http://edgerails.info/articles/what-s-new-in-edge-rails/2010/02/23/the-skinny-on-scopes-formerly-named-scope/">The Skinny on Scopes (Formerly named_scope)</a></li>
<li><a href="http://blog.envylabs.com/2010/02/rails-3-beautiful-code/">Rails 3 Beautiful Code</a></li>
<li><a href="http://railscasts.com/tags/27">Railscasts &#8211; rails-3.0 episodes</a></li>
<li><a href="http://joshhuckabee.com/jquery-rails-3">jQuery with Rails 3</a></li>
<li><a href="http://litanyagainstfear.com/blog/2010/02/03/the-rails-module/">The Rails Module (in Rails 3)</a></li>
</ol>

<p>Once I&#8217;m done with it I plan to get even more from:</p>

<ul>
<li><a href="http://edgerails.info/articles/what-s-new-in-edge-rails/2010/02/10/rails-3-resources/">Rails 3 Resources</a></li>
<li><a href="http://www.rubyinside.com/rails-3-0-beta-links-2966.html">Rails 3.0 Beta: 36 Links and Resources To Get You Going</a></li>
</ul>

  
    <h1><a href="http://blog.orangeiceberg.com/posts/expected-x.rb-to-define-x-loaderror">Expected x.rb to define X (LoadError)</a></h1>
    <p>I have been working on extending Rails&#8217; I18n Simple backend to make it work with Serbian grammar (post on that will follow soon), but I kept getting an error:</p>

<p><code>Expected ./lib/serbian_simple.rb to define SerbianSimple (LoadError)</code></p>

<p>I&#8217;ve just spent an hour trying to figure out why this keeps happening and I found that there&#8217;s a lot of people with similar problem.</p>

<p>It seems that the problem appears when Rails tries to autoload files. In my case there was a simple solution &#8211; I just added require &#8216;serbian_simple.rb&#8217; in environment.rb to manually load the file.</p>

  
    <h1><a href="http://blog.orangeiceberg.com/posts/simple-password-protected-administration-with-codeigniter">Simple password protected administration with CodeIgniter</a></h1>
    <p>Last week I&#8217;ve taken a break from Ruby/Rails development and I&#8217;ve worked on a site that uses PHP with <a href="http://codeigniter.com/">CodeIgniter</a> framework.</p>

<p>Despite the fact that CodeIgniter has a very nice documentation I found it very difficult to find a way to do some simple things, that are more or less obvious, but which can be a problem for someone who hasn&#8217;t worked with CodeIgniter before. (for example, I found myself more than once looking at CI code to figure out how it works, so I can use it)</p>

<p>I had to make a simple password protected administration section. One admin user, one password, no user registrations, no roles &#8211; simple as possible. As I was using CI framework I decided to find a plugin/library that does this. Unfortunately most CI authorization plugins/libraries are very bloated and too complicated for this simple task. I tried to find some examples how to handle this simple use case, but nothing came up.</p>

<p>Finally I&#8217;ve found a small authorization plugin: <a href="http://codeigniter.com/wiki/Erkana/">Erkanaauth</a>.</p>

<p>First you need a user table (must be named &#8216;users&#8217;) which only needs to have an id field and all other fields are optional because you will manually specify what other columns will be used. I opted for simple id, username, password:</p>

<pre>CREATE TABLE IF NOT EXISTS `users` (
  `id` int(11) NOT NULL auto_increment,
  `username` varchar(255) NOT NULL,
  `password` varchar(255) NOT NULL,
  PRIMARY KEY  (`id`)
);</pre>

<p>We will need to &#8220;install&#8221; ErkanaAuth library. You should <a href="http://codeigniter.com/wiki/File:erkanaauth.zip/">download it</a> and unzip it.</p>

<p>Next we should create an Admin controller which will handle all administration tasks (remember I&#8217;m making simple admin here, so I don&#8217;t need to protect multiple controllers).</p>

<pre>&lt;?php
class Admin extends Controller {
  function Admin()
  {
    parent::Controller();   
    $this->load->database();
    $this->load->helper(array('url', 'form', 'date'));
    $this->load->library(array('form_validation', 'upload', 'Erkanaauth', 'session'));
  }
}
?&gt;</pre>

<p>Constructor just connects to database and loads some standard helpers and libraries (including Erkanaauth) that are usually used.</p>

<p>Next step is to add a function which we can call to verify if user is logged in:</p>

<pre>private
  function authorize()
  {
      if($this->erkanaauth->try_session_login())
          return true;
  
      redirect('admin/login');
  }
</pre>

<p>Function uses Erkanaauth&#8217;s try_session_login which checks if user is already logged in (checks session for user id). If user isn&#8217;t logged in we&#8217;ll redirect him to our login page:</p>

<pre>function login()
  {
    $username = $this->input->post('username', true);
    $password = $this->input->post('password', true);
    if($username || $password)
    {
      if($this->erkanaauth->try_login(array('username' => $username, 'password' => $password)))
        redirect('admin');
    }
    
    $this->load->view('admin_login');
  }

  function logout()
  {
    $this->erkanaauth->logout();
    redirect('admin');
  }
</pre>

<p>Key command here is try_login in login function which tries to find an entry in users table that fulfills given conditions. If you have different users table than the one I made this is the place where you should enter your column names.</p>

<p>Logout function is has just a simple call to Erkana&#8217;s logout function. Nothing special there.</p>

<p>Of course we also need a login page template which should contain a simple user/pass form. It&#8217;s pretty basic and you can see it if you get the complete code (see at the end).</p>

<p>Finally we have everything needed to protect any page in Admin controller. In order to protect a page all you need to do is to add a call to authorize function to any function you want to protect. Like this:</p>

<pre>function index()
  {
    $this->authorize();
    echo "Do something useful... For now just display logout link: ";
    echo anchor('admin/logout', "Logout");
  }
</pre>

<p>That&#8217;s it. Now you have fully functional administration section which requires username and password authorization.</p>

<p>You can get the complete sample application from <a href="http://github.com/basti/ci-admin-section/tree/master">Github repository</a>. Feel free to expand on it or use it any way you like.</p>

  
    <h1><a href="http://blog.orangeiceberg.com/posts/restoring-superblock-on-ubutnu">Restoring superblock on Ubutnu</a></h1>
    <p>Recently I had a problem on my Torrent box (an old PC that I use as dedicated torrent client) that runs Ubuntu. For some reason my root partition was being mounted as read-only. Everything else seemed to work (all other partitions were mounted properly), but I couldn&#8217;t change any of my config or do anything on root partition.</p>

<p>I did the usual stuff:</p>

<ul>
<li>Run fsck checks and it said that everything is fine</li>
<li>Used Ubuntu&#8217;s live CD to boot, which got me read-write access to root partition. I changed some things in fstab, tried to get it to be rw permanently. No matter what I did as soon as I rebooted the root partition was once again read-only.</li>
<li>I tried booting from some repair disks I have, but all checks passed and no problem was detected. <img src='http://icebergist.com/wp-includes/images/smilies/icon_sad.gif' alt=':(' class='wp-smiley' /></li>
</ul>

<p>Finally, I read somewhere that a similar problem was caused by faulty superblock on hard drive. Fortunately Ubuntu stores superblock backups in different places around disk, so I decided to try to restore it from one of those backups.</p>

<p>It turned out that all I needed was a single command (this <a href="http://ubuntuforums.org/showpost.php?s=72da065bbe1506b27f41a8cfc252c732&amp;p=1424786&amp;postcount=5" title="Bad superblock">Ubuntu forum post helped</a>) to restore superblock:</p>

<p><code>e2fsck -b 32768 /dev/hdc1</code></p>

<p>After that my root partition was back to read-write mode. <img src='http://icebergist.com/wp-includes/images/smilies/icon_smile.gif' alt=':)' class='wp-smiley' /></p>

<p>Before you do stuff like that to your computer I suggest that you read man pages for <a href="http://linux.die.net/man/8/mke2fs" title="mke2fs">mke2fs</a> and <a href="http://linux.die.net/man/8/e2fsck" title="e2fsck">e2fsck</a>. It will prevent you from doing something foolish like deleting your whole hard drive. <img src='http://icebergist.com/wp-includes/images/smilies/icon_smile.gif' alt=':)' class='wp-smiley' /></p>

  
    <h1><a href="http://blog.orangeiceberg.com/posts/mosso-hosting-cloud">Mosso hosting cloud</a></h1>
    <p><a class="external" href="http://www.mosso.com/">Mosso&#8217;s hosting cloud</a>
at $100 / month seems like a good solution to get a scalable server. However one thing bugs me, actually two things&#8230;</p>

<p>First one: they offer <strong>FTP only access</strong>. Meaning you cannot deploy sites directly from code repositories (i.e. git or svn). That sucks.</p>

<p>Second thing that bugs me: for $100 you get quite a lot of computing power which can be used to run multiple sites &#8211; but <strong>you are only allowed to have one Rails app running</strong>. Only one. If you want additional Rails apps (for example to have a test server) you need to pay an extra fee.</p>

<p>I know it&#8217;s cloud computing and that you have to be able to run it with any additional configuration (that&#8217;s why I think it&#8217;s ok that you have to freeze your gems in Rails apps, because you cannot install any gems yourself)&#8230; but not being able to checkout my code from repository and having to upload the whole app each time you make changes <strong>is really annoying</strong>.</p>

<p>In their defense, the support guy said that they are working on it, but he could give me an ETA when they&#8217;ll allow something like that.</p>

  
    <h1><a href="http://blog.orangeiceberg.com/posts/restful-admin-namespaced-controller-using-scaffolding">RESTful admin namespaced controller using scaffolding</a></h1>
    <p>Most of my clients prefer to have a separate admin section. In turn, I like to have separate controllers for admin section and front-end in my Rails app. This is not as straightforward as it might seem, especially if you like to use scaffolding for admin controller.</p>

<p>The goal is to get 2 separate RESTful controllers, admin &amp; front-end controller, one model and for admin pages to have scaffolding.</p>

<p>Here is the easiest way I found so far to accomplish this. This example generates categories model and controllers for it.</p>

<p><code>./script/generate controller admin/categories&lt;br /&gt;
./script/generate scaffold category name:string</code></p>

<p>This will generate an empty controller in admin namespace and a scaffolded resource for front-end controller.</p>

<p>Now we have everything generated we just need to make it work with admin controller and not with front-end.</p>

<ul>
<li>move all templates from app/views/categories to app/views/<strong>admin</strong>/categories</li>
<li>copy all functions from categories_controller.rb to admin/categories_controller.rb</li>
<li>add namespace for admin controller in routes.rb:<code>map.namespace :admin do |admin|&lt;br /&gt;
admin.resources :categories&lt;br /&gt;
end</code></li>
<li>in admin/categories_controller.rb replace in 3 places redirect_to calls to work with admin namespace. It will have something like redirect_to(@category), but to work with namespace it needs to have redirect_to([:admin, @category])</li>
<li>make similar changes in all templates, i.e. make it work within an admin namespace. You need to make following changes:

<ul>
<li>form_for(@category) =&gt; <strong>form_for([:admin, @category])</strong></li>
<li>&lt;%= link_to &#8216;Show&#8217;, @category %&gt; =&gt; <strong>&lt;%= link_to &#8216;Show&#8217;, [:admin, @category] %&gt;</strong></li>
<li>categories_path =&gt; <strong>admin_categories_path</strong></li>
<li>edit_category_path(@category) =&gt; <strong>edit_admin_category_path(@category)</strong></li>
<li>new_category_path =&gt; <strong>new_admin_category_path</strong></li>
</ul></li>
</ul>

<p>That&#8217;s it. Now you&#8217;ll have /admin/categories for all administrative tasks and you have a free controller for front-end actions.</p>

<p>You might wonder why not just generate scaffold for admin/categories&#8230; The reason is that you&#8217;ll also get a model that is namespaced in admin (i.e. model would be Admin::Category). Scaffolded views also wouldn&#8217;t work as it seems that generator doesn&#8217;t take into account the fact that you are using a namespace.</p>

  
    <h1><a href="http://blog.orangeiceberg.com/posts/innodb-per-table-tablespaces-">InnoDB per-table tablespaces &amp;#8211; split ibdata1 to smaller chunks</a></h1>
    <p>Today I had to import 3GB of InnoDB tables in MySQL. Unfortunately, while importing the server run out of disk space &#8211; which caused whole server to grind to a halt. Naively I tried to delete imported data to free up space&#8230; I was in for an unpleasant surprise.</p>

<p>By default when MySQL uses InnoDB engine it stores most of the information in single file called ibdata1. One downside is that once ibdata1 file grows it cannot shrink &#8211; even if you delete all InnoDB tables. For some reason MySQL is set to use single file instead of per-table tablespaces similar to MyISAM.</p>

<p>Enabling per-table tablespaces is easy just add <a href="http://dev.mysql.com/doc/refman/5.0/en/multiple-tablespaces.html" title="InnoDB Per-table tablespaces">innodb_file_per_table</a> to my.cnf file. Problem is that <strong>all newly created tables</strong>, only new tables, will be in separate files. It seems that there&#8217;s no easy way to convert old tables and reclaim the space taken by ibdata1.</p>

<p>There are 3 ways and two are basically export-drop-delete-import type of solutions:</p>

<ol>
<li>Convert all InnoDB tables to MyISAM</li>
<li>Export only InnoDB tables, drop them, delete ibdata1 and import InnoDB tables.</li>
<li>Export all databases, delete ibdata1 and import everything back.</li>
</ol>

<p>I choose option 2 because I luckily had only 40 InnoDB tables and much more using MyISAM. For details on how to apply each solution and down/up sides of each read <a href="http://vdachev.net/blog/2007/02/22/mysql-reducing-ibdata1/en/" title="MySQL Reducing ibdata1">MySQL: Reducing ibdata1</a>.</p>

  
    <h1><a href="http://blog.orangeiceberg.com/posts/this-should-be-interesting-weekly-">This should be interesting weekly &amp;#8211; week 28</a></h1>
    <ul>
<li>What&#8217;s New in Edge Rails: <a href="http://tumblelog.slobodankovacevic.com/post/41430445/whats-new-in-edge-rails-easy-join-table-conditions">Easy Join Table Conditions.</a></li>
<li><a href="http://tumblelog.slobodankovacevic.com/post/41483353/faces-of-millions">Faces of Millions</a> &#8211; Art project which aims to gather one million photos of people faces and create 10m x 10m photo mosaic.</li>
<li><a href="http://tumblelog.slobodankovacevic.com/post/41727168/uni-form">Uni-Form</a> is an attempt to standardize form markup (xhtml) and css.</li>
<li><a href="http://tumblelog.slobodankovacevic.com/post/41886839/mac-fullscreen-quicklook-a-k-a-slideshow">Mac OS X full screen QuickLook shortcut.</a></li>
<li>A guide to <a href="http://tumblelog.slobodankovacevic.com/post/41978415/a-guide-to-css-support-in-email">CSS support in Email</a>.</li>
</ul>

<p>condensed from &lsquo;<a href="http://tumblelog.slobodankovacevic.com/">this should be interesting</a>&rsquo; tumblelog</p>

  
    <h1><a href="http://blog.orangeiceberg.com/posts/collection-partial-variable-naming-">Collection partial variable naming &amp;#8211; new in edge rails</a></h1>
    <p>One thing that always annoyed me when rendering collection partials is that a local var in partial is named same as a partial template name. So, to go around this I always created another local variable in partial and gave it a more meaningful name.</p>

<p>No longer&#8230; As the <a href="http://ryandaigle.com/articles/2008/7/7/what-s-new-in-edge-rails-collection-partial-variable-naming" title="What's New in Edge Rails: Collection Partial Variable Naming ">Ryan says</a> from now on in the Edge Rails you can specify the name of the local variable in which each collection element will be exposed within a partial. You will can do this:</p>

<pre>render :partial =&gt; 'employees', :collection =&gt; @workers, :as =&gt; :person</pre>

<p>It&#8217;s a simple thing, but it&#8217;s just one of the things that bugged me. I am glad it&#8217;s gone now.</p>

  
    <h1><a href="http://blog.orangeiceberg.com/posts/this-should-be-interesting-weekly-">This should be interesting weekly &amp;#8211; week 27</a></h1>
    <p>This is the first weekly condensed edition of my <a href="http://tumblelog.slobodankovacevic.com/" title="Tumblelog by Slobodan Kovacevic">&#8220;This should be interesting&#8221; tumblelog</a>. Every Sunday I will re-post most interesting posts here on the Icebergist.</p>

<ul>
<li><a href="http://tumblelog.slobodankovacevic.com/post/40966961/new-free-book-ruby-on-rails-2-1-whats-new" title="Free Book: &quot;Ruby on Rails 2.1 - What’s new&quot;">Free Book: &#8220;Ruby on Rails 2.1 &#8211; What’s new&#8221;</a></li>
<li><a href="http://tumblelog.slobodankovacevic.com/post/40888615/better-blockquotes-blockquotes-examples" title="Better Blockquotes - Blockquotes examples">Better Blockquotes</a> &#8211; blockquotes CSS styling examples</li>
<li><a href="http://tumblelog.slobodankovacevic.com/post/39785793/slife-free-automatic-time-tracking-for-mac" title="Slife - free automatic time tracking for Mac">Slife</a> &#8211; free automatic time tracking for Mac</li>
<li><a href="http://tumblelog.slobodankovacevic.com/post/39263529/unfocus-history-keeper-back-button-enabling-deep" title="unfocus-history-keeper">unfocus-history-keeper</a> &#8211; back button enabling, deep linking, event driven Javascrpt/DHTML/Ajax Library (works for Flash too)</li>
</ul>

  
    <h1><a href="http://blog.orangeiceberg.com/posts/mac-os-x-problems-upgrading-from-10.5.3-to-10.5.4">Mac OS X problems upgrading from 10.5.3 to 10.5.4</a></h1>
    <p>Today I tried to upgrade my Mac from 10.5.3 to 10.5.4 using normal Software Update. That didn&#8217;t go as planned as installation hanged at &#8220;Configuring Installation&#8221; and only thing I could do is shutdown the computer.</p>

<p>After some research and few unsuccessful retries I have finally managed to solve the upgrade problem by downloading standalone 10.5.4 update from <a href="http://www.apple.com/support/downloads/" title="Download Apple Mac OS X update">Apple download section</a>; booting in safe mode (hold shift key when booting) and then installing the update.</p>

  
    <h1><a href="http://blog.orangeiceberg.com/posts/sproutcore-">SproutCore &amp;#8211; a javascript framework</a></h1>
    <p><a href="http://www.sproutcore.com" title="SproutCore - Javascript Framework">SproutCore</a> is a javascript framework which tries to enable developers to build web apps that look and act more like a desktop apps.</p>

<p>It steps away from a classic web app model by moving a lot of app into the browser itself, which then interacts with server via AJAX. As it says on the <a href="http://www.sproutcore.com/about/" title="About SproutCore">SproutCore site</a>:</p>

<blockquote>
<p>After lots of testing, we have found that the most efficient way to server a SproutCore application is as a …. static web page!</p>
</blockquote>

<p>This means that a &#8220;simple&#8221; static HTML page (which is easily served by Apache) makes browser do most of the work (i.e. server doesn&#8217;t have to generate the pages) which frees up server to respond only to AJAX initiated requests.</p>

<p><a href="http://www.sproutcore.com" title="SproutCore - Javascript Framework written in Ruby">SproutCore</a> is written in Ruby, but once you build the app it will generate a set of HTML, JS and CSS files, so you don&#8217;t need to know Ruby in order to use it. As the site says:</p>

<blockquote>
<p>The code you write with SproutCore will resemble a desktop app written in Cocoa more than it will a web application written in Rails.</p>
</blockquote>

<p><img class="alignright size-full wp-image-6" title="SproutCore Photos Demo" src="http://icebergist.com/wp-content/uploads/2008/07/sprout-photos-demo.jpg" alt="SproutCore Photos Demo Screenshot" width="500" height="236" />
Another great thing about SproutCore is that it can be hooked up with any backend as long as it can communicate with it using HTTP. It can be anything: Rails, PHP, Perl, Java, ASP&#8230;</p>

<p>Actions speak louder than words, so take a look at the SproutCore demos which shows you exactly what it&#8217;s all about.</p>

<ul>
<li><a href="http://www.sproutcore.com/static/photos/" title="SproutCore demo photo gallery">SproutCore based photo gallery</a> &#8211; iPhoto anyone? <img src='http://icebergist.com/wp-includes/images/smilies/icon_smile.gif' alt=':)' class='wp-smiley' /></li>
<li><a href="http://www.sproutcore.com/static/sample_controls/" title="SproutCore demo sample controls">SproutCore sample controls</a> &#8211; demonstrates what kind of controls are already available in SproutCore.</li>
</ul>

<p>In next few days I will try to build a sample application powered by SproutCore and Rails to see how it goes. I will post my impressions here. After all if it&#8217;s something Apple used for Mobile.me &#8211; well, it can&#8217;t be that bad. <img src='http://icebergist.com/wp-includes/images/smilies/icon_wink.gif' alt=';)' class='wp-smiley' /></p>

  
    <h1><a href="http://blog.orangeiceberg.com/posts/so-it-begins">So it begins&amp;#8230;</a></h1>
    <p>Welcome to an icebergist blog. The Icebergist will be a blog about both technical and business stuff I deal with daily. From Ruby on Rails programming to time organizing, everything that’s important in my daily work as a freelance developer.</p>

<p>As you can see I just setup the Icebergist blog, so at the moment it&#8217;s content-free. While I write some posts you can checkout <a href="http://www.google.com/search?hl=en&amp;rlz=1B3GGGL_enYU233YU234&amp;q=%22Posted+by+Slobodan+Kovacevic%22+site%3Aarraystudio.com+inurl%3Ahtml&amp;btnG=Search" title="Slobodan Kovacevic's blog posts in AS Workshop">my posts from my previous blog AS Workshop</a>.</p>

<p>Also I maintain a tumble log called &ldquo;<a href="http://tumblelog.slobodankovacevic.com/" title="Tumblelog by Slobodan Kovacevic">this should be interesting</a>&rdquo; where I post small bits of information which I find useful or interesting.</p>

<p>If that&#8217;s not enough for you then check out my <a href="http://twitter.com/thebasti" title="Slobodan Kovacevic's Twitter feed">Twitter feed</a> where I ramble daily (unless I am to lazy or too busy to do so).</p>

  
  <p><a href="http://blog.orangeiceberg.com/">Home</a></p>

</body>
</html>
