<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Creating and publishing a ruby gem - Icebergist</title>
  <meta name="author" content="Orange Iceberg">

  
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://icebergist.com/posts/creating-and-publishing-a-ruby-gem">
  <link href="/favicon.png" type="image/png" rel="icon">
  <link href="http://feeds.feedburner.com/icebergist" rel="alternate" title="Icebergist" type="application/atom+xml">

  <link href="/assets/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" type="text/css">
<link href="/assets/bootstrap/dist/css/bootstrap-theme.min.css" rel="stylesheet" type="text/css">
<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">


  <script src="/javascripts/libs/jquery/jquery-2.0.3.min.js"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-4735545-2']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

  <body   >
    <div id="wrap">
      <header role="banner">
        <nav class="navbar navbar-default" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <h1>
              <a href="/">Icebergist</a>
              
                <small>Exploring hidden depths of web development</small>
              
            </h1>
        </div>

        <div class="navbar-collapse collapse">
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a class="subscribe-rss" href="http://feeds.feedburner.com/icebergist" title="subscribe via RSS">
                        <span class="visible-xs">RSS</span>
                        <img class="hidden-xs" src="/images/rss.png" alt="RSS">
                    </a>
                </li>
                
            </ul>
            
                <form class="search navbar-form navbar-right" action="http://google.com/search" method="GET">
                    <input type="hidden" name="q" value="site:icebergist.com">
                    <div class="form-group">
                        <input class="form-control" type="text" name="q" placeholder="Search">
                    </div>
                </form>
            
        </div>
    </div>
</nav>


      </header>
      <div id="main" class="container">
        <div id="content">
          <div class="row">
  <div class="page-content col-md-9">
    <article class="hentry" role="article">
      
  <header class="page-header">
    
      <p class="meta text-muted">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2015-06-08T09:12:04+02:00" pubdate data-updated="true">Jun 8<span>th</span>, 2015</time>
        | 
  


  <span class="glyphicon glyphicon-user"></span>
  <span class="byline author vcard">Posted by
    <span class="fn">
      
        <a href="http://orangeiceberg.com/about/">Jovana Dačić</a>
      
    </span>
  </span>


        
           | <a href="#disqus_thread"
             data-disqus-identifier="http://icebergist.com">Comments</a>
        
      </p>
    
    
    <h1 class="entry-title">
        Creating and Publishing a Ruby Gem
        
    </h1>
    
  </header>


<div class="entry-content clearfix"><p>A gem is a simple way to distribute functionality, it can be a small plugin, a Ruby library or sometimes a whole program. Thanks to RubyGems, a gem hosting service, developers have a wide range of gems at their disposal allowing them to easily add functionality to their applications.</p>

<p>But what if there is no gem available that will suit the functionality you need, and you find yourself writing the same code over and over again for different projects? Well, in that case you should consider making your own gem.</p>

<p>It&rsquo;s considered a good practice to extract a gem out of an existing application, since that way you will have a better understanding of all the requirements as well as how the gem will be used. This blog post will illustrate just that on a real life example, and will take you through the process of creating a slug_converter gem.</p>

<h3>Slug converter gem</h3>

<p>Source code for slug_converter gem was developed while working on a link shortener application, in order to generate a string consisting of predefined characters, based on a given id number of a link. As it will be described in this blog post, this code was easily extracted from the application into an independent gem that was released on  RubyGems.</p>

<p>Although it may seem like a complex task at first, creating a gem is not that difficult, if you have RubyGems and Bundler installed you are good to go. We already know what RubyGems is, and Bundler is a package manager that determines a full set of direct dependencies needed by your application.</p>

<p>Now let&rsquo;s build a gem!</p>

<h3>Creating a gem</h3>

<p>First step is to make sure that bundler gem is installed.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>gem install bundler
</span></code></pre></td></tr></table></div></figure>


<p>once bundler is installed creating a structure for your new gem is easy,</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>bundle gem slug_converter
</span></code></pre></td></tr></table></div></figure>


<p>The first time you use bundler to create a gem you will be prompted to answer a couple of questions:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>Do you want to include code of conduct in your gems you generate?
</span><span class='line'>Do you want to licence your code permissively under the MIT licence?
</span><span class='line'>Do you want to generate tests with your gem?
</span><span class='line'>Type rspec or minitest to generate those tests files now and in the future:
</span></code></pre></td></tr></table></div></figure>


<p>Answering these questions will help bundler configure and setup files that are being generated now and in the future. Here we answered yes to first 4 qestions and choose rspec for testing.</p>

<p>Running <code>$ bundle gem slug_converter</code> command resulted with &ldquo;slug_converter&rdquo; directory with essential gem file structure being created, and git repository initialized, assuming that you are using git for version management (as you should).</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>Creating gem <span class="s1">&#39;slug_converter&#39;</span>...
</span><span class='line'> create  slug_converter/Gemfile
</span><span class='line'> create  slug_converter/.gitignore
</span><span class='line'> create  slug_converter/lib/slug_converter.rb
</span><span class='line'> create  slug_converter/lib/slug_converter/version.rb
</span><span class='line'> create  slug_converter/slug_converter.gemspec
</span><span class='line'> create  slug_converter/Rakefile
</span><span class='line'> create  slug_converter/README.md
</span><span class='line'> create  slug_converter/bin/console
</span><span class='line'> create  slug_converter/bin/setup
</span><span class='line'> create  slug_converter/LICENSE.txt
</span><span class='line'> create  slug_converter/.travis.yml
</span><span class='line'> create  slug_converter/.rspec
</span><span class='line'> create  slug_converter/spec/spec_helper.rb
</span><span class='line'> create  slug_converter/spec/slug_converter_spec.rb
</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s go through files that bundler generated for us, .gemspec file is the &ldquo;heart&rdquo; of your gem so lets start with <code>slug_converter.gemspec</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">lib</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">expand_path</span><span class="p">(</span><span class="s1">&#39;../lib&#39;</span><span class="p">,</span> <span class="bp">__FILE__</span><span class="p">)</span>
</span><span class='line'><span class="vg">$LOAD_PATH</span><span class="o">.</span><span class="n">unshift</span><span class="p">(</span><span class="n">lib</span><span class="p">)</span> <span class="k">unless</span> <span class="vg">$LOAD_PATH</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="n">lib</span><span class="p">)</span>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;slug_converter/version&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="ss">Gem</span><span class="p">:</span><span class="ss">:Specification</span><span class="o">.</span><span class="n">new</span> <span class="k">do</span> <span class="o">|</span><span class="n">spec</span><span class="o">|</span>
</span><span class='line'>  <span class="n">spec</span><span class="o">.</span><span class="n">name</span>         <span class="o">=</span> <span class="s2">&quot;slug_converter&quot;</span>
</span><span class='line'>  <span class="n">spec</span><span class="o">.</span><span class="n">version</span>      <span class="o">=</span> <span class="ss">SlugConverter</span><span class="p">:</span><span class="ss">:VERSION</span>
</span><span class='line'>  <span class="n">spec</span><span class="o">.</span><span class="n">authors</span>      <span class="o">=</span> <span class="o">[</span><span class="s2">&quot;Your Name&quot;</span><span class="o">]</span>
</span><span class='line'>  <span class="n">spec</span><span class="o">.</span><span class="n">email</span>        <span class="o">=</span> <span class="o">[</span><span class="s2">&quot;youremail@example.com&quot;</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># if spec.respond_to?(:metadata)</span>
</span><span class='line'>  <span class="c1">#   spec.metadata[&#39;allowed_push_host&#39;] = &quot;TODO: Set to &#39;http://mygemserver.com&#39; to prevent pushes to rubygems.org, or delete to allow pushes to any server.&quot;</span>
</span><span class='line'>  <span class="c1"># end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">spec</span><span class="o">.</span><span class="n">summary</span>      <span class="o">=</span> <span class="sx">%q{Number &lt;-&gt; Slug converter}</span>
</span><span class='line'>  <span class="n">spec</span><span class="o">.</span><span class="n">description</span>  <span class="o">=</span> <span class="sx">%q{Generates a slug based on the given number and the other way around}</span>
</span><span class='line'>  <span class="n">spec</span><span class="o">.</span><span class="n">homepage</span>     <span class="o">=</span> <span class="s2">&quot;https://github.com/orangeiceberg/slug_converter&quot;</span>
</span><span class='line'>  <span class="n">spec</span><span class="o">.</span><span class="n">license</span>      <span class="o">=</span> <span class="s2">&quot;MIT&quot;</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">spec</span><span class="o">.</span><span class="n">files</span>        <span class="o">=</span> <span class="sb">`git ls-files -z`</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\x0</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">reject</span> <span class="p">{</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="n">f</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sr">%r{^(test|spec|features)/}</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'>  <span class="n">spec</span><span class="o">.</span><span class="n">bindir</span>       <span class="o">=</span> <span class="s2">&quot;exe&quot;</span>
</span><span class='line'>  <span class="n">spec</span><span class="o">.</span><span class="n">executables</span>  <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">files</span><span class="o">.</span><span class="n">grep</span><span class="p">(</span><span class="sr">%r{^exe/}</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="no">File</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'>  <span class="n">spec</span><span class="o">.</span><span class="n">require_paths</span><span class="o">=</span> <span class="o">[</span><span class="s2">&quot;lib&quot;</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">spec</span><span class="o">.</span><span class="n">add_development_dependency</span> <span class="s2">&quot;bundler&quot;</span><span class="p">,</span> <span class="s2">&quot;~&gt; 1.8&quot;</span>
</span><span class='line'>  <span class="n">spec</span><span class="o">.</span><span class="n">add_development_dependency</span> <span class="s2">&quot;rake&quot;</span><span class="p">,</span> <span class="s2">&quot;~&gt; 10.0&quot;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>This file contains metadata about your gem and it can be populated directly, so here you can enter all the data such as name, description, licence&hellip; This file also contains information about what files should be packaged in your gem, as well as the load path to include the gem directory when the gem is first loaded. Most of these default settings will work for the majority of gems but you can always edit them if you want different behavior. At the bottom of the file add any gem dependencies that are required.</p>

<p>The version number of the gem is set in <code>SlugConverter::VERSION</code> constant which is kept in a separate version.rb file, and you can change it there for every new version of your gem.</p>

<pre><code>lib
 |--slug_converter
         |--version.rb
</code></pre>

<p>A very important part of every gem is the <code>README</code> file, where you can describe how to install and use the gem, and the <code>LICENCE</code> file where you can define the terms and conditions under which the gem can be used.</p>

<p>In the lib directory there is a file which has the same name as your gem (recommended), and that file will be loaded when someone requires your gem. If the gem you are writing is simple all the code can be placed in this single file, or in case of more complex gems all the other files from the lib directory are required in this file.</p>

<p>There is also a <code>Gemfile</code> generated, but this file doesn&rsquo;t have to be managed directly since all it does is look in <code>.gemspec</code> for required dependencies and then loads them through bundler. All the dependencies required by the gem should be specified in the <code>.gemspec</code> file.</p>

<p>Another file that is generated by the bundler is <code>Rakefile</code> which just adds some gem tasks from bundler, and we can see those tasks with explanation by running</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>rake -T
</span><span class='line'>rake build    <span class="c"># Build slug_converter-0.0.1.gem into the pkg directory</span>
</span><span class='line'>rake install  <span class="c"># Build and install slug_converter-0.0.1.gem into system gems</span>
</span><span class='line'>rake release  <span class="c"># Create tag v0.0.1 and build and push slug_converter-0.1.0.gem to Rubygems</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Writing tests</h3>

<p>If you are following the principles of Test Driven Development you will probably like to start by writing tests for you gem, for that purpose I would suggest using RSpec.
To do that you will need to add rspec as a development dependency to you gemspec file:</p>

<pre><code>spec.add_development_dependency 'rspec'
</code></pre>

<p>As mentioned in the beginning, when running bundle gem for the first time, bundler will asks if you would like to generate test files for your gem and to choose if you want to use rspec or minitest. If you answer with yes, and choose rspec, bundler will generate a spec directory with two files:</p>

<pre><code>|-- spec
      |-- slug_converter_spec.rb
      |-- spec_helper.rb
</code></pre>

<p>In the <code>spec_helper.rb</code> file you can reference any test globals or configuration.</p>

<p>Since we are extracting code from an existing application we already have all the tests written so we just need to copy them into the generated <code>spec/slug_converter_spec.rb</code> file.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;spec_helper&#39;</span>
</span><span class='line'><span class="n">describe</span> <span class="no">SlugConverter</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">it</span> <span class="s1">&#39;has a version number&#39;</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">expect</span><span class="p">(</span><span class="ss">SlugConverter</span><span class="p">:</span><span class="ss">:VERSION</span><span class="p">)</span><span class="o">.</span><span class="n">not_to</span> <span class="n">be</span> <span class="kp">nil</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>  <span class="n">describe</span> <span class="s2">&quot;.number&quot;</span> <span class="k">do</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">it</span> <span class="s2">&quot;returns number when number is set&quot;</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">converted_slug</span><span class="o">=</span> <span class="no">SlugConverter</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
</span><span class='line'>      <span class="n">expect</span><span class="p">(</span><span class="n">converted_slug</span><span class="o">.</span><span class="n">number</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eq</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">it</span> <span class="s2">&quot;returns decoded number for existing slug&quot;</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">converted_slug</span> <span class="o">=</span> <span class="no">SlugConverter</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;vg&quot;</span><span class="p">)</span>
</span><span class='line'>      <span class="n">expect</span><span class="p">(</span><span class="n">converted_slug</span><span class="o">.</span><span class="n">number</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eq</span><span class="p">(</span><span class="mi">363</span><span class="p">)</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">describe</span> <span class="s2">&quot;.number&quot;</span> <span class="k">do</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">it</span> <span class="s2">&quot;sets number to given value&quot;</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">converted_slug</span> <span class="o">=</span> <span class="no">SlugConverter</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="mi">211</span><span class="p">)</span>
</span><span class='line'>      <span class="n">expect</span><span class="p">(</span><span class="n">converted_slug</span><span class="o">.</span><span class="n">number</span><span class="o">=</span><span class="mi">210</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eq</span><span class="p">(</span><span class="mi">210</span><span class="p">)</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">it</span> <span class="s2">&quot;sets slug to encoded value of number&quot;</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">converted_slug</span> <span class="o">=</span> <span class="no">SlugConverter</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="mi">211</span><span class="p">)</span>
</span><span class='line'>      <span class="n">converted_slug</span><span class="o">.</span><span class="n">number</span><span class="o">=</span><span class="mi">210</span>
</span><span class='line'>      <span class="n">expect</span><span class="p">(</span><span class="n">converted_slug</span><span class="o">.</span><span class="n">slug</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eq</span><span class="p">(</span><span class="s2">&quot;pb&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">it</span> <span class="s2">&quot;sets number to integer value of given number passed as string&quot;</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">converted_slug</span> <span class="o">=</span> <span class="no">SlugConverter</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;210&quot;</span><span class="p">)</span>
</span><span class='line'>      <span class="n">expect</span><span class="p">(</span><span class="n">converted_slug</span><span class="o">.</span><span class="n">number</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eq</span><span class="p">(</span><span class="mi">210</span><span class="p">)</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">it</span> <span class="s2">&quot;sets slug to encoded value of given number passed as string&quot;</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">converted_slug</span> <span class="o">=</span> <span class="no">SlugConverter</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;210&quot;</span><span class="p">)</span>
</span><span class='line'>      <span class="n">expect</span><span class="p">(</span><span class="n">converted_slug</span><span class="o">.</span><span class="n">slug</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eq</span><span class="p">(</span><span class="s2">&quot;pb&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">it</span> <span class="s2">&quot;sets number to integer value of argument that starts with a number but also contains letters&quot;</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">converted_slug</span> <span class="o">=</span> <span class="no">SlugConverter</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;210jj&quot;</span><span class="p">)</span>
</span><span class='line'>      <span class="n">expect</span><span class="p">(</span><span class="n">converted_slug</span><span class="o">.</span><span class="n">number</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eq</span><span class="p">(</span><span class="mi">210</span><span class="p">)</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">it</span> <span class="s2">&quot;sets slug to encoded value of argument that starts with a number but also contains letters&quot;</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">converted_slug</span> <span class="o">=</span> <span class="no">SlugConverter</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;210jj&quot;</span><span class="p">)</span>
</span><span class='line'>      <span class="n">expect</span><span class="p">(</span><span class="n">converted_slug</span><span class="o">.</span><span class="n">slug</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eq</span><span class="p">(</span><span class="s2">&quot;pb&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">describe</span> <span class="s2">&quot;.slug&quot;</span> <span class="k">do</span>
</span><span class='line'>
</span><span class='line'>     <span class="n">it</span> <span class="s2">&quot;returns slug when slug is set&quot;</span> <span class="k">do</span>
</span><span class='line'>        <span class="n">converted_slug</span> <span class="o">=</span> <span class="no">SlugConverter</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;hy&quot;</span><span class="p">)</span>
</span><span class='line'>        <span class="n">expect</span><span class="p">(</span><span class="n">converted_slug</span><span class="o">.</span><span class="n">slug</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eq</span><span class="p">(</span><span class="s2">&quot;hy&quot;</span><span class="p">)</span>
</span><span class='line'>     <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>     <span class="n">it</span> <span class="s2">&quot;returns encoded slug when link id is set&quot;</span> <span class="k">do</span>
</span><span class='line'>        <span class="n">converted_id</span> <span class="o">=</span> <span class="no">SlugConverter</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="mi">113</span><span class="p">)</span>
</span><span class='line'>        <span class="n">expect</span><span class="p">(</span><span class="n">converted_id</span><span class="o">.</span><span class="n">slug</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eq</span><span class="p">(</span><span class="s2">&quot;hy&quot;</span><span class="p">)</span>
</span><span class='line'>     <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">describe</span> <span class="s2">&quot;.slug&quot;</span> <span class="k">do</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">it</span> <span class="s2">&quot;sets slug to given value&quot;</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">converted_slug</span> <span class="o">=</span> <span class="no">SlugConverter</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;ezk&quot;</span><span class="p">)</span>
</span><span class='line'>      <span class="n">expect</span><span class="p">(</span><span class="n">converted_slug</span><span class="o">.</span><span class="n">slug</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;ebk&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">to</span> <span class="n">eq</span><span class="p">(</span><span class="s2">&quot;ebk&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">it</span> <span class="s2">&quot;sets number to decoded value of slug&quot;</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">converted_slug</span> <span class="o">=</span> <span class="no">SlugConverter</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;pb&quot;</span><span class="p">)</span>
</span><span class='line'>      <span class="n">converted_slug</span><span class="o">.</span><span class="n">slug</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;ezk&quot;</span><span class="p">)</span>
</span><span class='line'>      <span class="n">expect</span><span class="p">(</span><span class="n">converted_slug</span><span class="o">.</span><span class="n">number</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eq</span><span class="p">(</span><span class="mi">1483</span><span class="p">)</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">it</span> <span class="s2">&quot;raises Arrgument Error exception if given value is an empty string&quot;</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">expect</span> <span class="p">{</span> <span class="no">SlugConverter</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="p">}</span><span class="o">.</span><span class="n">to</span> <span class="n">raise_error</span><span class="p">(</span><span class="no">ArgumentError</span><span class="p">)</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">it</span> <span class="s2">&quot;raises Arrgument Error exception if given value is nil&quot;</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">expect</span> <span class="p">{</span> <span class="no">SlugConverter</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="kp">nil</span><span class="p">)</span> <span class="p">}</span><span class="o">.</span><span class="n">to</span> <span class="n">raise_error</span><span class="p">(</span><span class="no">ArgumentError</span><span class="p">)</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">it</span> <span class="s2">&quot;raises Arrgument Error exception if given value contains unpermitted letters&quot;</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">expect</span> <span class="p">{</span> <span class="no">SlugConverter</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;iiii&quot;</span><span class="p">)</span> <span class="p">}</span><span class="o">.</span><span class="n">to</span> <span class="n">raise_error</span><span class="p">(</span><span class="no">ArgumentError</span><span class="p">)</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">it</span> <span class="s2">&quot;raises Arrgument Error exception if given value starts with letter but contains numbers&quot;</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">expect</span> <span class="p">{</span> <span class="no">SlugConverter</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;bb12&quot;</span><span class="p">)</span> <span class="p">}</span><span class="o">.</span><span class="n">to</span> <span class="n">raise_error</span><span class="p">(</span><span class="no">ArgumentError</span><span class="p">)</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>To make rspec rake task available we will setup tasks folder where we&rsquo;ll place our <code>rspec.rake</code> file containing only 2 lines:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;rspec/core/rake_task&#39;</span>
</span><span class='line'><span class="ss">RSpec</span><span class="p">:</span><span class="ss">:Core</span><span class="o">::</span><span class="no">RakeTask</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:spec</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>and then we will import this file in our Rakefile that bundler provided automatically:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Dir</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;tasks/**/*.rake&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">each</span><span class="p">(</span><span class="o">&amp;</span><span class="nb">method</span><span class="p">(</span><span class="ss">:import</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now run:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>bundle <span class="nb">exec </span>rake spec
</span></code></pre></td></tr></table></div></figure>


<p>And watch your tests fail. :)</p>

<h3>Add gem functionality</h3>

<p>Now we need to make those test go green. To do that we will again copy the existing code from our application in the main gem file <code>lib/slug_converter.rb</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s2">&quot;slug_converter/version&quot;</span>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;set&#39;</span>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;gem_config&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">SlugConverter</span>
</span><span class='line'>  <span class="kp">include</span> <span class="ss">GemConfig</span><span class="p">:</span><span class="ss">:Base</span>
</span><span class='line'>  <span class="n">with_configuration</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">has</span> <span class="ss">:alphabet</span><span class="p">,</span> <span class="ss">default</span><span class="p">:</span> <span class="s2">&quot;qjeghxtrpnfmdzwvsybkuoca&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">number_or_slug</span><span class="p">)</span>
</span><span class='line'>     <span class="vi">@alphabet</span> <span class="o">=</span> <span class="no">SlugConverter</span><span class="o">.</span><span class="n">configuration</span><span class="o">.</span><span class="n">alphabet</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sr">//</span><span class="p">)</span>
</span><span class='line'>    <span class="k">if</span> <span class="n">number_or_slug</span><span class="o">.</span><span class="n">to_i</span> <span class="o">!=</span> <span class="mi">0</span>
</span><span class='line'>      <span class="vi">@number</span> <span class="o">=</span> <span class="n">number_or_slug</span><span class="o">.</span><span class="n">to_i</span>
</span><span class='line'>    <span class="k">elsif</span> <span class="n">validate_string</span><span class="p">(</span><span class="n">number_or_slug</span><span class="p">)</span>
</span><span class='line'>      <span class="vi">@slug</span> <span class="o">=</span> <span class="n">number_or_slug</span><span class="o">.</span><span class="n">downcase</span>
</span><span class='line'>    <span class="k">else</span>
</span><span class='line'>      <span class="k">raise</span> <span class="no">ArgumentError</span><span class="p">,</span> <span class="s1">&#39;Argument must be integer value or non-empty string consisting of predefined letters&#39;</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">number</span>
</span><span class='line'>    <span class="k">if</span> <span class="vi">@number</span><span class="o">.</span><span class="n">nil?</span>
</span><span class='line'>      <span class="vi">@number</span> <span class="o">=</span> <span class="n">bijective_decode</span>
</span><span class='line'>    <span class="k">else</span>
</span><span class='line'>      <span class="vi">@number</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">number</span><span class="o">=</span><span class="p">(</span><span class="n">new_number</span><span class="p">)</span>
</span><span class='line'>    <span class="vi">@number</span> <span class="o">=</span> <span class="n">new_number</span>
</span><span class='line'>    <span class="vi">@slug</span> <span class="o">=</span> <span class="n">bijective_encode</span>
</span><span class='line'>    <span class="vi">@number</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">slug</span>
</span><span class='line'>    <span class="k">if</span> <span class="vi">@slug</span><span class="o">.</span><span class="n">nil?</span>
</span><span class='line'>      <span class="vi">@slug</span> <span class="o">=</span> <span class="n">bijective_encode</span>
</span><span class='line'>    <span class="k">else</span>
</span><span class='line'>      <span class="vi">@slug</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">slug</span><span class="o">=</span><span class="p">(</span><span class="n">new_slug</span><span class="p">)</span>
</span><span class='line'>    <span class="vi">@slug</span> <span class="o">=</span> <span class="n">new_slug</span>
</span><span class='line'>    <span class="vi">@number</span> <span class="o">=</span> <span class="n">bijective_decode</span>
</span><span class='line'>    <span class="vi">@slug</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="kp">private</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">bijective_encode</span>
</span><span class='line'>      <span class="nb">id</span> <span class="o">=</span> <span class="vi">@number</span>
</span><span class='line'>      <span class="k">return</span> <span class="vi">@alphabet</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="k">if</span> <span class="nb">id</span> <span class="o">==</span> <span class="mi">0</span>
</span><span class='line'>      <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span class='line'>      <span class="n">base</span> <span class="o">=</span> <span class="vi">@alphabet</span><span class="o">.</span><span class="n">length</span>
</span><span class='line'>      <span class="k">while</span> <span class="nb">id</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span class='line'>        <span class="n">s</span> <span class="o">&lt;&lt;</span> <span class="vi">@alphabet</span><span class="o">[</span><span class="nb">id</span><span class="o">.</span><span class="n">modulo</span><span class="p">(</span><span class="n">base</span><span class="p">)</span><span class="o">]</span>
</span><span class='line'>        <span class="nb">id</span> <span class="o">/=</span> <span class="n">base</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>      <span class="n">s</span><span class="o">.</span><span class="n">reverse</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">bijective_decode</span>
</span><span class='line'>      <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>      <span class="n">base</span> <span class="o">=</span> <span class="vi">@alphabet</span><span class="o">.</span><span class="n">length</span>
</span><span class='line'>      <span class="vi">@slug</span><span class="o">.</span><span class="n">each_char</span> <span class="p">{</span> <span class="o">|</span><span class="n">c</span><span class="o">|</span> <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="n">base</span> <span class="o">+</span> <span class="vi">@alphabet</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'>      <span class="n">i</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">validate_string</span><span class="p">(</span><span class="n">slug</span><span class="p">)</span>
</span><span class='line'>      <span class="k">unless</span> <span class="n">slug</span><span class="o">.</span><span class="n">nil?</span>
</span><span class='line'>        <span class="n">alphabet</span> <span class="o">=</span> <span class="no">Set</span><span class="o">.</span><span class="n">new</span> <span class="vi">@alphabet</span>
</span><span class='line'>        <span class="n">slug_letters</span> <span class="o">=</span> <span class="no">Set</span><span class="o">.</span><span class="n">new</span> <span class="n">slug</span><span class="o">.</span><span class="n">downcase</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sr">//</span><span class="p">)</span>
</span><span class='line'>        <span class="n">slug</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">slug_letters</span><span class="o">.</span><span class="n">subset?</span> <span class="n">alphabet</span><span class="p">)</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now when we run the tests again, they should all pass.</p>

<h3>Making your gem configurabile</h3>

<p>In order to allow users to set their own alphabet that will be used by the SlugConverter, we needed to make our gem configurabile. To do this we used <a href="https://github.com/krautcomputing/gem_config">https://github.com/krautcomputing/gem_config</a> gem.</p>

<p>You will notice this code at the begining of the SlugConverter class:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">SlugConverter</span>
</span><span class='line'>  <span class="kp">include</span> <span class="ss">GemConfig</span><span class="p">:</span><span class="ss">:Base</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">with_configuration</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">has</span> <span class="ss">:alphabet</span><span class="p">,</span> <span class="ss">default</span><span class="p">:</span> <span class="s2">&quot;qjeghxtrpnfmdzwvsybkuoca&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">number_or_slug</span><span class="p">)</span>
</span><span class='line'>     <span class="vi">@alphabet</span> <span class="o">=</span> <span class="no">SlugConverter</span><span class="o">.</span><span class="n">configuration</span><span class="o">.</span><span class="n">alphabet</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sr">//</span><span class="p">)</span>
</span><span class='line'>     <span class="c1"># ...</span>
</span><span class='line'>  <span class="k">end</span>  
</span><span class='line'>
</span><span class='line'>  <span class="c1"># rest of the code omitted    </span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>this code along with <code>spec.add_runtime_dependency 'gem_config'</code> added as a dependency in <code>slug_converter.gemspec</code> file, alows us to make the gem configureabile.</p>

<p>Custom aphabet can than be defined by adding <code>config/initializers/slug_converter.rb</code> to your application, and defining the alphabet like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">SlugConverter</span><span class="o">.</span><span class="n">configuration</span><span class="o">.</span><span class="n">alphabet</span> <span class="o">=</span> <span class="s2">&quot;your_custom_alphabet_here&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Releasing your gem</h3>

<p>Now that we have the test passing and all the code in place it&rsquo;s time to make the gem available for everyone to use by releasing it on RubyGems, to do that you will need to have a RubyGems account. If this is the first time you release a gem you will be prompted to enter your RubyGems username and password. You will also need to have your repository setup on Github.</p>

<p>Then with just one comand:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>bundle <span class="nb">exec </span>rake release
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>your code will be pushed to your Github repository,</li>
<li>your git repository will be tagged with the version number using a name like &ldquo;v1.0.0&rdquo;.</li>
<li>your gem released on RubyGems.</li>
</ul>


<p>The ruby gem described in this blog post can be found here <a href="https://rubygems.org/gems/slug_converter,">https://rubygems.org/gems/slug_converter,</a> and all the code is in this GitHub repository <a href="https://github.com/orangeiceberg/slug_converter">https://github.com/orangeiceberg/slug_converter</a> .</p>
</div>


      <footer>
        <p class="meta text-muted">
          
  


  <span class="glyphicon glyphicon-user"></span>
  <span class="byline author vcard">Posted by
    <span class="fn">
      
        <a href="http://orangeiceberg.com/about/">Jovana Dačić</a>
      
    </span>
  </span>


          












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2015-06-08T09:12:04+02:00" pubdate data-updated="true">Jun 8<span>th</span>, 2015</time>
          

<span class="glyphicon glyphicon-tags"></span>&nbsp;
<span class="categories">
  
    <a class='category' href='/category/ruby-and-rails/'>Ruby and Rails</a>
  
</span>


          

<span class="tags">
  
    Tags:
  
  
    <a class='tag' href='/tag/rails/'>rails</a>, <a class='tag' href='/tag/ruby/'>ruby</a>
  
</span>


        </p>
        
          <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://icebergist.com/posts/creating-and-publishing-a-ruby-gem/" data-via="icebergist" data-counturl="http://icebergist.com/posts/creating-and-publishing-a-ruby-gem/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

        
        
          <ul class="meta text-muted pager">
            
            <li class="previous"><a href="/posts/changing-database-starting-id/" title="Previous Post: changing database starting id">&laquo; changing database starting id</a></li>
            
            
          </ul>
        
      </footer>
    </article>
    
      <section>
        <h1>Comments</h1>
        <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
      </section>
    
  </div>

  
  <aside class="sidebar col-md-3">
    
      <section>
  <h2>About us</h2>
  <div>
    <a href="http://orangeiceberg.com">
      <img src="http://orangeiceberg.com/images/oi-logo-footer.png" class="sidebar_avatar" alt="Orange Iceberg web development consultancy" />
    </a>
  </div>
  <div id="sidebar-about">
    <p>
      Hello!
      We are <a href="http://orangeiceberg.com">Orange Iceberg</a> a team of Ruby developers.
    </p>
    <p>
      <strong>Icebergist</strong> is a place where we write about technical challenges we face.
      We build Ruby on Rails web applications, so it's mainly about Ruby and Ruby on Rails.
    </p>
    <p class="hire-us-box">
      <strong>We are available for hire.</strong>
      <br />
      <a href="http://orangeiceberg.com/contact">Find out how we can help you.</a>
    </p>
  </div>
</section>
<section class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">Recent Posts</h3>
  </div>
  
  <div id="recent_posts" class="list-group">
    
    <a class="list-group-item active" href="/posts/creating-and-publishing-a-ruby-gem/">Creating and Publishing a Ruby Gem</a>
    
    <a class="list-group-item " href="/posts/changing-database-starting-id/">Changing Database Starting Id</a>
    
    <a class="list-group-item " href="/posts/customize-devise-permitted-parameters/">Customize Devise Permitted Parameters</a>
    
    <a class="list-group-item " href="/posts/how-to-skip-devise-trackable-updates/">How to Skip Devise Trackable Updates</a>
    
    <a class="list-group-item " href="/posts/upgrade-ubuntu-8-dot-04-lts-server/">Upgrade Ubuntu 8.04 LTS Server</a>
    
  </div>
  <div class="panel-heading">
    <a href="/blog/archives/">See more posts</a>
  </div>
</section>
<section class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">Categories</h3>
  </div>
  <div class="list-group">
    
    
    <a class="list-group-item " href="/category/misc/index.html">
        <span class="badge">9</span>
        Misc
      </a>
    
    
    <a class="list-group-item " href="/category/javascript/index.html">
        <span class="badge">1</span>
        Javascript
      </a>
    
    
    <a class="list-group-item " href="/category/ruby-and-rails/index.html">
        <span class="badge">15</span>
        Ruby and Rails
      </a>
    
    
    <a class="list-group-item " href="/category/this-should-be-interesting---weekly/index.html">
        <span class="badge">2</span>
        This should be interesting - weekly
      </a>
    
    
    <a class="list-group-item " href="/category/php/index.html">
        <span class="badge">1</span>
        PHP
      </a>
    
    
    <a class="list-group-item " href="/category/testing/index.html">
        <span class="badge">1</span>
        Testing
      </a>
    
  </div>
</section>
<section class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">Tags</h3>
  </div>
  <div class="tag-cloud">
    <span class='rank-5'><a href='/tag/rest'>rest</a></span> <span class='rank-5'><a href='/tag/erkanaauth'>erkanaauth</a></span> <span class='rank-4'><a href='/tag/links'>links</a></span> <span class='rank-5'><a href='/tag/rspec'>rspec</a></span> <span class='rank-5'><a href='/tag/restful'>restful</a></span> <span class='rank-4'><a href='/tag/hosting'>hosting</a></span> <span class='rank-5'><a href='/tag/scaffold'>scaffold</a></span> <span class='rank-5'><a href='/tag/factorygirl'>factorygirl</a></span> <span class='rank-5'><a href='/tag/mysql'>mysql</a></span> <span class='rank-5'><a href='/tag/paperclip'>paperclip</a></span> <span class='rank-5'><a href='/tag/codeigniter'>codeigniter</a></span> <span class='rank-5'><a href='/tag/cloud-computing'>cloud computing</a></span> <span class='rank-2'><a href='/tag/ruby'>ruby</a></span> <span class='rank-5'><a href='/tag/rails4'>rails4</a></span> <span class='rank-4'><a href='/tag/resources'>resources</a></span> <span class='rank-5'><a href='/tag/tdd'>tdd</a></span> <span class='rank-5'><a href='/tag/amazon-s3'>amazon s3</a></span> <span class='rank-4'><a href='/tag/devise'>devise</a></span> <span class='rank-5'><a href='/tag/css'>css</a></span> <span class='rank-5'><a href='/tag/edge'>edge</a></span> <span class='rank-4'><a href='/tag/heroku'>heroku</a></span> <span class='rank-4'><a href='/tag/ubuntu'>ubuntu</a></span> <span class='rank-5'><a href='/tag/mac'>mac</a></span> <span class='rank-4'><a href='/tag/tutorial'>tutorial</a></span> <span class='rank-5'><a href='/tag/admin'>admin</a></span> <span class='rank-5'><a href='/tag/password-protected'>password protected</a></span> <span class='rank-3'><a href='/tag/howto'>howto</a></span> <span class='rank-5'><a href='/tag/postgres'>postgres</a></span> <span class='rank-5'><a href='/tag/carrierwave'>carrierwave</a></span> <span class='rank-5'><a href='/tag/factory-girl'>factory_girl</a></span> <span class='rank-4'><a href='/tag/weekly'>weekly</a></span> <span class='rank-5'><a href='/tag/Javascript'>Javascript</a></span> <span class='rank-1'><a href='/tag/rails'>rails</a></span> <span class='rank-5'><a href='/tag/PHP'>PHP</a></span> <span class='rank-5'><a href='/tag/vagrant'>vagrant</a></span> <span class='rank-5'><a href='/tag/linux'>linux</a></span> <span class='rank-5'><a href='/tag/virtualbox'>virtualbox</a></span> <span class='rank-4'><a href='/tag/rails3'>rails3</a></span> <span class='rank-5'><a href='/tag/sqlite'>sqlite</a></span> <span class='rank-3'><a href='/tag/tips'>tips</a></span> 
  </div>
</section>


    
  </aside>
  
</div>

        </div>
      </div>
    </div>
    <footer role="contentinfo"><div class="container">
    <p class="text-muted credits">
  <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/">
    <img alt="Creative Commons License" style="border-width:0;float:left;padding-right:5px;" src="http://i.creativecommons.org/l/by-sa/3.0/88x31.png" />
  </a>
  <span xmlns:dc="http://purl.org/dc/elements/1.1/">icebergist.com</span> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons Attribution-Share Alike 3.0 Unported License</a>.

  <!-- Copyright &copy; 2015 - Orange Iceberg<br> -->
  <br />
  <small>
      <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>,
      <span class="credit">customized with <a href="https://github.com/kAworu/octostrap3">octostrap3</a></span>.
  </small>
</p>

</div>
</footer>
    <script src="/assets/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="/javascripts/modernizr-2.0.js"></script>


<script type="text/javascript">
      var disqus_shortname = 'icebergist';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://icebergist.com/posts/creating-and-publishing-a-ruby-gem/';
        var disqus_url = 'http://icebergist.com/posts/creating-and-publishing-a-ruby-gem/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





  </body>
</html>
